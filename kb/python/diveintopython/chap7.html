
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Regular Expression &mdash; Zeyuan Hu&#39;s World</title>
    
    <link rel="stylesheet" href="../../../_static/zeyuan.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="top" title="Zeyuan Hu&#39;s World" href="../../../index.html" />
    <link rel="up" title="Dive into Python Study Notes" href="diveintopython.html" />
    <link rel="next" title="Unit Testing" href="chap13.html" />
    <link rel="prev" title="Exceptions and File Handling" href="chap6.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo2.png" border="0" alt="Logo of Zeyuan's personal website"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="chap13.html" title="Unit Testing"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="chap6.html" title="Exceptions and File Handling"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../pj.html">projects</a>|&nbsp;</li>
        
        

          <li class="nav-item nav-item-1"><a href="../../../kb.html" >Knowledge Base</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="diveintopython.html" accesskey="U">Dive into Python Study Notes</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Regular Expression</a><ul>
<li><a class="reference internal" href="#diving-in">7.1. Diving In</a><ul>
<li><a class="reference internal" href="#limitation-of-string-methods">7.1.1 Limitation of String Methods</a></li>
<li><a class="reference internal" href="#when-to-use-regular-expressions">7.1.2 When to Use Regular Expressions</a></li>
<li><a class="reference internal" href="#python-and-regular-expressions">7.1.3 Python and Regular Expressions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-street-addresses">7.2. Case Study: Street Addresses</a><ul>
<li><a class="reference internal" href="#and">7.1.1 <code class="docutils literal"><span class="pre">^</span></code> and <code class="docutils literal"><span class="pre">$</span></code></a></li>
<li><a class="reference internal" href="#b-and-r">7.1.2 <code class="docutils literal"><span class="pre">\b</span></code> and <code class="docutils literal"><span class="pre">r</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#case-study-roman-numerals">7.3. Case Study: Roman Numerals</a><ul>
<li><a class="reference internal" href="#introduction-to-roman-numerals">7.3.0 Introduction to Roman Numerals</a><ul>
<li><a class="reference internal" href="#rules-in-roman-numerals">7.3.0.0 Rules in Roman Numerals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validating-roman-numeral">7.3.1 Validating Roman Numeral</a><ul>
<li><a class="reference internal" href="#checing-for-thousands">7.3.1.0 Checing for Thousands <code class="docutils literal"><span class="pre">?</span></code></a></li>
<li><a class="reference internal" href="#checking-for-hundreds-a-b-c">7.3.1.1 Checking for Hundreds <code class="docutils literal"><span class="pre">(a|b|c)</span></code></a></li>
<li><a class="reference internal" href="#using-the-n-m-syntax">7.3.1.2 Using the <code class="docutils literal"><span class="pre">{n.m}</span></code> Syntax</a></li>
<li><a class="reference internal" href="#checking-for-tens-and-ones">7.3.1.3 Checking for Tens and Ones</a></li>
<li><a class="reference internal" href="#final-pattern-for-roman-numeral">7.3.1.4 Final Pattern for Roman Numeral</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#verbose-regular-expressions">7.4. Verbose Regular Expressions</a></li>
<li><a class="reference internal" href="#case-study-parsing-phone-numbers">7.5. Case Study: Parsing Phone Numbers</a></li>
<li><a class="reference internal" href="#further-reading">7.6. Further Reading</a></li>
</ul>
</li>
</ul>

    <h3>About this site</h3>
        <ul class="this-page-menu">
            <li><a class="reference external" 
                   href="../../../todo.html" >About</a></li>
        </ul>
<div id="searchbox" style="display: none">
  <h3>search this site</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="regular-expression">
<span id="chap7-rst"></span><h1>Regular Expression<a class="headerlink" href="#regular-expression" title="Permalink to this headline">¶</a></h1>
<div class="admonition-usage admonition">
<p class="first admonition-title">usage</p>
<p class="last">Regular expressions are a powerful and standardized way of searching, replacing, and
parsing text with complex patterns of characters.</p>
</div>
<p>&#8220;Some people, when confronted with a problem, think &#8220;I know, I&#8217;ll use regular expressions.&#8221;
Now they have two problems.&#8221;</p>
<p>&#8211; <strong>Jamie Zawinski</strong>, in <a class="reference external" href="http://groups.google.com/groups?selm=33F0C496.370D7C45%40netscape.com">comp.emacs.xemacs</a></p>
<p><strong>Goal</strong>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">^</span></code> matches the beginning of a string.</li>
<li><code class="docutils literal"><span class="pre">$</span></code> matches the end of a string.</li>
<li><code class="docutils literal"><span class="pre">\b</span></code> matches a word boundary.</li>
<li><code class="docutils literal"><span class="pre">\d</span></code> matches any numeric digit.</li>
<li><code class="docutils literal"><span class="pre">\D</span></code> matches any non-numeric character.</li>
<li><code class="docutils literal"><span class="pre">x?</span></code> matches an <em>optional</em> <code class="docutils literal"><span class="pre">x</span></code> character (in other words, it matches an <code class="docutils literal"><span class="pre">x</span></code> zero or <em>one</em> times).</li>
<li><code class="docutils literal"><span class="pre">x*</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> zero or <em>more</em> times.</li>
<li><code class="docutils literal"><span class="pre">x+</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> one or more times.</li>
<li><code class="docutils literal"><span class="pre">x{n,m}</span></code> matches an <code class="docutils literal"><span class="pre">x</span></code> character at least <code class="docutils literal"><span class="pre">n</span></code> times, but not more than <code class="docutils literal"><span class="pre">m</span></code> times.</li>
<li><code class="docutils literal"><span class="pre">(a|b|c)</span></code> matches either <code class="docutils literal"><span class="pre">a</span></code> or <code class="docutils literal"><span class="pre">b</span></code> or <code class="docutils literal"><span class="pre">c</span></code>.</li>
<li><code class="docutils literal"><span class="pre">(x)</span></code> in general is a <em>remembered group</em>. You can get the value of what matched by using the <code class="docutils literal"><span class="pre">groups()</span></code>
method of the object returned by <code class="docutils literal"><span class="pre">re.search</span></code>.</li>
</ul>
<div class="section" id="diving-in">
<span id="diving-in7"></span><h2>7.1. Diving In<a class="headerlink" href="#diving-in" title="Permalink to this headline">¶</a></h2>
<div class="section" id="limitation-of-string-methods">
<h3>7.1.1 Limitation of String Methods<a class="headerlink" href="#limitation-of-string-methods" title="Permalink to this headline">¶</a></h3>
<p>String have methods of searching (<code class="docutils literal"><span class="pre">index</span></code>, <code class="docutils literal"><span class="pre">find</span></code>, and <code class="docutils literal"><span class="pre">count</span></code>), replacing (<code class="docutils literal"><span class="pre">replace</span></code>), and
parsing (<code class="docutils literal"><span class="pre">split</span></code>), but they are limited to the simplest of cases:</p>
<blockquote>
<div>The search methods look for <em>a single, hard-coded substring</em>, and they are always <em>case-sensitive</em>.
Those limitations are also true for replacing method and parsing method.</div></blockquote>
</div>
<div class="section" id="when-to-use-regular-expressions">
<h3>7.1.2 When to Use Regular Expressions<a class="headerlink" href="#when-to-use-regular-expressions" title="Permalink to this headline">¶</a></h3>
<p>If what you&#8217;re trying to do can be accomplished with string functions, you should use them.
They&#8217;re fast and simple and easy to read.</p>
<p>But if you find yourself using a lot of different string functions with <code class="docutils literal"><span class="pre">if</span></code> statements to handle
special cases, or if you&#8217;re combining them with <code class="docutils literal"><span class="pre">split</span></code> and <code class="docutils literal"><span class="pre">join</span></code> and list comprehensions in
weird unreadable ways, you may need to move up to regular expressions.</p>
</div>
<div class="section" id="python-and-regular-expressions">
<h3>7.1.3 Python and Regular Expressions<a class="headerlink" href="#python-and-regular-expressions" title="Permalink to this headline">¶</a></h3>
<p>Regular expressions are supported by <code class="docutils literal"><span class="pre">re</span></code> module. You can get an overview of the available functions
and their arguments by just reading the summary of the <a class="reference external" href="http://www.python.org/doc/current/lib/module-re.html">re</a> module.</p>
</div>
</div>
<div class="section" id="case-study-street-addresses">
<span id="case-study-street"></span><h2>7.2. Case Study: Street Addresses<a class="headerlink" href="#case-study-street-addresses" title="Permalink to this headline">¶</a></h2>
<p>This series of examples was inspired by a real-life problem I had in my day job several years ago,
when I needed to scrub and standardize street addresses exported from a legacy system before importing
them into a newer system.</p>
<div class="section" id="and">
<h3>7.1.1 <code class="docutils literal"><span class="pre">^</span></code> and <code class="docutils literal"><span class="pre">$</span></code><a class="headerlink" href="#and" title="Permalink to this headline">¶</a></h3>
<p>Example 7.1 Matching at the End of a String</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">^</span></code> matches the beginning of a string.</li>
<li><code class="docutils literal"><span class="pre">$</span></code> matches the end of a string.</li>
</ul>
</div>
<div class="admonition-key-func admonition">
<p class="first admonition-title">Key Func</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [1]: s = &#39;100 NORTH MAIN ROAD&#39;

In [2]: s.replace(&#39;ROAD&#39;, &#39;RD.&#39;)
Out[2]: &#39;100 NORTH MAIN RD.&#39;

In [3]: s = &#39;100 NORTH BROAD ROAD&#39;

In [4]: s.replace(&#39;ROAD&#39;, &#39;RD.&#39;)
Out[4]: &#39;100 NORTH BRD. RD.&#39;

In [5]: s[:-4] + s[-4:].replace(&#39;ROAD&#39;,&#39;RD.&#39;)
Out[5]: &#39;100 NORTH BROAD RD.&#39;

<span class="hll">In [6]: import re
</span>
<span class="hll">In [7]: re.sub(&#39;ROAD$&#39;, &#39;RD.&#39;, s)
</span>Out[7]: &#39;100 NORTH BROAD RD.&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>[2]:</dt>
<dd>My goal is to standardize a street address so that <code class="docutils literal"><span class="pre">'ROAD'</span></code> is always abbreviated as <code class="docutils literal"><span class="pre">'RD.'</span></code>.
At first glance, I thought this was simple enough that I could just use the string method <code class="docutils literal"><span class="pre">replace</span></code>.</dd>
<dt>[4]:</dt>
<dd>Life, unfortunately, is full of counterexamples, and this is the one. The problem here is that <code class="docutils literal"><span class="pre">'ROAD'</span></code>
appears twice in the address, once as part of the street name <code class="docutils literal"><span class="pre">'BROAD'</span></code> and once as its own word.
The <code class="docutils literal"><span class="pre">replace</span></code> method sees these two occurrences and blindly replaces both of them; addresses getting destroyed.</dd>
<dt>[5]:</dt>
<dd><p class="first">To solve the problem of addresses with more than one <code class="docutils literal"><span class="pre">'ROAD'</span></code> substring, you could resort to something like this:</p>
<blockquote class="last">
<div><blockquote>
<div>only search and replace <code class="docutils literal"><span class="pre">'ROAD'</span></code> in the last four characters of the address (<code class="docutils literal"><span class="pre">s[-4:]</span></code>), and leave the string
alone (<code class="docutils literal"><span class="pre">s[:-4]</span></code>).</div></blockquote>
<p>But you can see that this is not a general approach:</p>
<blockquote>
<div>for example, the pattern is dependent on the length of the string you&#8217;re replacing (if you were replacing
<code class="docutils literal"><span class="pre">'STREET'</span></code> with <code class="docutils literal"><span class="pre">'ST.'</span></code>, you would need to use <code class="docutils literal"><span class="pre">s[:-6]</span></code> and <code class="docutils literal"><span class="pre">s[-6:].replace(...)</span></code>).</div></blockquote>
</div></blockquote>
</dd>
<dt>[6]:</dt>
<dd>It&#8217;s time to move up to regular expressions.
In Python, all functionality related to regular expressions is contained in the <code class="docutils literal"><span class="pre">re</span></code> module.</dd>
<dt>[7]:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">'ROAD$'</span></code>:</dt>
<dd><ul class="first last simple">
<li>This is a simple regular expression that matches <code class="docutils literal"><span class="pre">'ROAD'</span></code> only when it occurs at the end of a string.</li>
<li>The <code class="docutils literal"><span class="pre">$</span></code> means &#8220;end of the string&#8221;. (the corresponding character, <code class="docutils literal"><span class="pre">^</span></code>, which means &#8220;beginning of the string&#8221;)</li>
</ul>
</dd>
</dl>
</li>
<li><div class="first highlight-default"><div class="highlight"><pre><span></span><span class="c1"># you search the string &#39;s&#39; for the regular expression &#39;ROAD$&#39; and replace it with &#39;RD.&#39;</span>
<span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">repl</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">This matches the <code class="docutils literal"><span class="pre">ROAD</span></code> at the end of the string <code class="docutils literal"><span class="pre">s</span></code>, but does <em>not</em> match the <code class="docutils literal"><span class="pre">ROAD</span></code> that&#8217;s part of the word
<code class="docutils literal"><span class="pre">BROAD</span></code>, because tha&#8217;s in the middle of <code class="docutils literal"><span class="pre">s</span></code></p>
</li>
</ul>
</dd>
</dl>
<div class="admonition-problem admonition">
<p class="first admonition-title">problem</p>
<p class="last">Not all addresses included a street designation at all; some just ended with the street name. If the street name was
<code class="docutils literal"><span class="pre">'BROAD'</span></code>, then the regular expression would match <code class="docutils literal"><span class="pre">'ROAD'</span></code> at the end of the string as part of the word
<code class="docutils literal"><span class="pre">'BROAD'</span></code>. which is not what I wanted.</p>
</div>
</div>
<div class="section" id="b-and-r">
<h3>7.1.2 <code class="docutils literal"><span class="pre">\b</span></code> and <code class="docutils literal"><span class="pre">r</span></code><a class="headerlink" href="#b-and-r" title="Permalink to this headline">¶</a></h3>
<p>Example 7.2 Matching Whole Words</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">\b</span></code> matches a word boundary</li>
<li>raw string: prefix the string with the letter <code class="docutils literal"><span class="pre">r</span></code>.</li>
</ul>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [13]: s = &#39;100 BROAD&#39;

In [14]: re.sub(&#39;ROAD$&#39;, &#39;RD.&#39;, s)
Out[14]: &#39;100 BRD.&#39;

In [15]: re.sub(&#39;\\bROAD$&#39;, &#39;RD.&#39;, s)
Out[15]: &#39;100 BROAD&#39;

<span class="hll">In [16]: re.sub(r&#39;\bROAD$&#39;, &#39;RD.&#39;, s)
</span>Out[16]: &#39;100 BROAD&#39;

In [17]: s = &#39;100 BROAD ROAD APT.3&#39;

In [18]: re.sub(r&#39;\bROAD$&#39;, &#39;RD.&#39;, s)
Out[18]: &#39;100 BROAD ROAD APT.3&#39;

<span class="hll">In [19]: re.sub(r&#39;\bROAD\b&#39;, &#39;RD.&#39;, s)
</span>Out[19]: &#39;100 BROAD RD. APT.3&#39;
</pre></div>
</div>
<dl class="docutils">
<dt>[14]:</dt>
<dd>problem in the previous approach</dd>
<dt>[15]:</dt>
<dd><ul class="first last">
<li><p class="first">What I really want was to match <code class="docutils literal"><span class="pre">'ROAD'</span></code> when it was at the end of the string and
it was its own whole word, not a part of some larger word.</p>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">\b</span></code>:</dt>
<dd><ul class="first last simple">
<li>means &#8220;a word boundary must occur right here.&#8221;</li>
<li>In Python, this is complicated by the fact that the <code class="docutils literal"><span class="pre">'\'</span></code> character in a string must itself be escaped.
(this is called <em>backslash plague</em>)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">r</span></code>:</dt>
<dd><ul class="first last">
<li><p class="first">to work around the backslash plague, you can use what is called a raw string,
by prefixing the string with the letter <code class="docutils literal"><span class="pre">r</span></code>.</p>
</li>
<li><p class="first">this tells Python that nothing in this string should be escaped.</p>
</li>
<li><p class="first">ie. <code class="docutils literal"><span class="pre">'\t'</span></code> is a tab character, but <code class="docutils literal"><span class="pre">r'\t'</span></code> is really the backslash character <code class="docutils literal"><span class="pre">\</span></code> followed by the
letter <code class="docutils literal"><span class="pre">t</span></code>.</p>
</li>
<li><div class="admonition-tip first admonition">
<p class="first admonition-title">Tip</p>
<p class="last">Always using raw strings when dealing with regular expressions.</p>
</div>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>[18]:</dt>
<dd><div class="admonition-problem first last admonition">
<p class="first admonition-title">problem</p>
<p class="last">I soon found more cases that contradicted my logic.
In this case, the street address contained the word <code class="docutils literal"><span class="pre">'ROAD'</span></code> as a whole word by itself, but it
wasn&#8217;t at the end, because the address had an apartment number after the street designation.
Because <code class="docutils literal"><span class="pre">'ROAD'</span></code> isn&#8217;t at the very end of the string, it doesn&#8217;t match, so the entire call to
<code class="docutils literal"><span class="pre">re.sub</span></code> ends up replacing nothing at all, and you get the original string back, which is
not what you want.</p>
</div>
</dd>
<dt>[19]:</dt>
<dd><p class="first">To Solve this problem, I removed the <code class="docutils literal"><span class="pre">$</span></code> character and added another <code class="docutils literal"><span class="pre">\b</span></code>.</p>
<p class="last">Now the regular expression reads &#8220;match <code class="docutils literal"><span class="pre">'ROAD'</span></code> when it&#8217;s whole word by itself anywhere in the string,&#8221;
whether at the end, the beginning, or somewhere in the middle.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="case-study-roman-numerals">
<span id="case-study-roman"></span><h2>7.3. Case Study: Roman Numerals<a class="headerlink" href="#case-study-roman-numerals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction-to-roman-numerals">
<h3>7.3.0 Introduction to Roman Numerals<a class="headerlink" href="#introduction-to-roman-numerals" title="Permalink to this headline">¶</a></h3>
<p>You&#8217;ve most likely seen Roman numerals, even if you didn&#8217;t recognize them. You may have seen them in the copyrights of
old movies and television shows (&#8220;Copyright <code class="docutils literal"><span class="pre">MCMXLVI</span></code>&#8221; instead of &#8220;Copyright <code class="docutils literal"><span class="pre">1946</span></code>&#8221;), or on the dedication walls of
libraries or universities (&#8220;established <code class="docutils literal"><span class="pre">MDCCCLXXXVIII</span></code>&#8221; instead of &#8220;established <code class="docutils literal"><span class="pre">1888</span></code>&#8221;). You may also have seen them
in outlines and bibliographical references. It&#8217;s a system of representing numbers that really does date back to the
ancient Roman empire.</p>
<div class="section" id="rules-in-roman-numerals">
<h4>7.3.0.0 Rules in Roman Numerals<a class="headerlink" href="#rules-in-roman-numerals" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt>there are seven characters that are repeated and combined in various ways to represent numbers:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">I</span></code> = 1</li>
<li><code class="docutils literal"><span class="pre">V</span></code> = 5</li>
<li><code class="docutils literal"><span class="pre">X</span></code> = 10</li>
<li><code class="docutils literal"><span class="pre">L</span></code> = 50</li>
<li><code class="docutils literal"><span class="pre">C</span></code> = 100</li>
<li><code class="docutils literal"><span class="pre">D</span></code> = 500</li>
<li><code class="docutils literal"><span class="pre">M</span></code> = 1000</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Characters are additive:</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">I</span></code> is <code class="docutils literal"><span class="pre">1</span></code>, <code class="docutils literal"><span class="pre">II</span></code> is 2, and <code class="docutils literal"><span class="pre">III</span></code> is 3. <code class="docutils literal"><span class="pre">VI</span></code> is <code class="docutils literal"><span class="pre">6</span></code> (literally, &#8220;5 and 1&#8221;), <code class="docutils literal"><span class="pre">VII</span></code> is <code class="docutils literal"><span class="pre">7</span></code>, and
<code class="docutils literal"><span class="pre">VIII</span></code> is <code class="docutils literal"><span class="pre">8</span></code>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Subtraction rule:</dt>
<dd><ul class="first last">
<li><dl class="first docutils">
<dt>A smaller number in front of a larger number means subtraction, all else means addition:</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">IV</span></code> means <code class="docutils literal"><span class="pre">4</span></code>, <code class="docutils literal"><span class="pre">VI</span></code> means <code class="docutils literal"><span class="pre">6</span></code></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>You would not put more than one smaller number in front of a larger number to subtract:</dt>
<dd><p class="first last"><code class="docutils literal"><span class="pre">IIV</span></code> would not mean <code class="docutils literal"><span class="pre">3</span></code>, and it is not even a valid Roman numeral.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>You must separates ones, tens, hundreds, and thousands as separate items:</dt>
<dd><ul class="first last simple">
<li>That means that <code class="docutils literal"><span class="pre">99</span></code> is <code class="docutils literal"><span class="pre">XCIX</span></code> (&#8220;90 plus 9&#8221;), but never should be written as <code class="docutils literal"><span class="pre">IC</span></code>.</li>
<li>Similarly, <code class="docutils literal"><span class="pre">999</span></code> cannot be <code class="docutils literal"><span class="pre">IM</span></code> and <code class="docutils literal"><span class="pre">1999</span></code> cannot be <code class="docutils literal"><span class="pre">MIM</span></code></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The tens characters (<code class="docutils literal"><span class="pre">I</span></code>, <code class="docutils literal"><span class="pre">X</span></code>, <code class="docutils literal"><span class="pre">C</span></code>, and <code class="docutils literal"><span class="pre">M</span></code>) can be repeated up to three times: (except <code class="docutils literal"><span class="pre">M</span></code>, which could be repeated up to <em>four</em> times)</dt>
<dd><ul class="first last simple">
<li>At <code class="docutils literal"><span class="pre">4</span></code>, cannot represent it as <code class="docutils literal"><span class="pre">IIII</span></code>; instead, it is represented as <code class="docutils literal"><span class="pre">IV</span></code> ( &#8220;1 less than 5&#8221;)</li>
<li>Number <code class="docutils literal"><span class="pre">40</span></code> is written as <code class="docutils literal"><span class="pre">XL</span></code> (10 less than 50), <code class="docutils literal"><span class="pre">41</span></code> as <code class="docutils literal"><span class="pre">XLI</span></code>, <code class="docutils literal"><span class="pre">42</span></code> as <code class="docutils literal"><span class="pre">XLII</span></code>, <code class="docutils literal"><span class="pre">43</span></code> as <code class="docutils literal"><span class="pre">XLIII</span></code>,
and then <code class="docutils literal"><span class="pre">44</span></code> as <code class="docutils literal"><span class="pre">XLIV</span></code> (10 less than 50, then 1 less than 5).</li>
<li>Similarly, at <code class="docutils literal"><span class="pre">9</span></code>, you need to subtract from the next highest tens character: <code class="docutils literal"><span class="pre">8</span></code> is <code class="docutils literal"><span class="pre">VIII</span></code>, but <code class="docutils literal"><span class="pre">9</span></code> is <code class="docutils literal"><span class="pre">IX</span></code>
(1 less than 10), not <code class="docutils literal"><span class="pre">VIIII</span></code>. The number <code class="docutils literal"><span class="pre">90</span></code> is <code class="docutils literal"><span class="pre">XC</span></code>, <code class="docutils literal"><span class="pre">900</span></code> is <code class="docutils literal"><span class="pre">CM</span></code>.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The fives characters cannot be repeated:</dt>
<dd><ul class="first last simple">
<li>Number <code class="docutils literal"><span class="pre">10</span></code> is always represented as <code class="docutils literal"><span class="pre">X</span></code>, never as <code class="docutils literal"><span class="pre">VV</span></code>.</li>
<li>Number <code class="docutils literal"><span class="pre">100</span></code> is always <code class="docutils literal"><span class="pre">C</span></code>, never <code class="docutils literal"><span class="pre">LL</span></code>.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Roman numerals are always written highest to lowest, and read left to right, so the order of characters matters very much:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal"><span class="pre">DC</span></code> is <code class="docutils literal"><span class="pre">600</span></code>; <code class="docutils literal"><span class="pre">CD</span></code> is a completely different number(<code class="docutils literal"><span class="pre">400</span></code>, 100 less than 500).</li>
<li><code class="docutils literal"><span class="pre">CI</span></code> is <code class="docutils literal"><span class="pre">101</span></code>; <code class="docutils literal"><span class="pre">IC</span></code> is not even a valid Roman numeral (because you cannot subtract 1 directly from 100; you
would need to write it as <code class="docutils literal"><span class="pre">XCIX</span></code>, for 10 less than 100, then 1 less than 10).</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="validating-roman-numeral">
<h3>7.3.1 Validating Roman Numeral<a class="headerlink" href="#validating-roman-numeral" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>Goal:</dt>
<dd>Validating that an arbitrary string is a valid Roman numeral.</dd>
<dt>Approach:</dt>
<dd>One digit at a time</dd>
</dl>
<div class="section" id="checing-for-thousands">
<h4>7.3.1.0 Checing for Thousands <code class="docutils literal"><span class="pre">?</span></code><a class="headerlink" href="#checing-for-thousands" title="Permalink to this headline">¶</a></h4>
<p>Since Roman numerals are always written highest to lowest, let&#8217;s start with the highest: the thousands place.</p>
<p>For numbers 1000 and higher, the thousands are represented by a series of <code class="docutils literal"><span class="pre">M</span></code> characters.</p>
<p>Example 7.3 Checking for Thousands</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">x?</span></code> matches an <em>optional</em> <code class="docutils literal"><span class="pre">x</span></code> character (in other words, it matches an <code class="docutils literal"><span class="pre">x</span></code> zero or <em>one</em> times).</p>
</div>
<div class="admonition-key-func admonition">
<p class="first admonition-title">Key Func</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [20]: import re

<span class="hll">In [21]: pattern = &#39;^M?M?M?M?$&#39;
</span>
<span class="hll">In [22]: re.search(pattern, &#39;M&#39;)
</span>Out[22]: &lt;_sre.SRE_Match at 0x92c5b48&gt;

In [23]: re.search(pattern, &#39;MM&#39;)
Out[23]: &lt;_sre.SRE_Match at 0x92c5bf0&gt;
In [24]: re.search(pattern,&#39;MMM&#39;)
Out[24]: &lt;_sre.SRE_Match at 0x92c5d08&gt;

In [25]: re.search(pattern,&#39;MMMMM&#39;)

In [26]: re.search(pattern,&#39;&#39;)
Out[26]: &lt;_sre.SRE_Match at 0x92c5e58&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>[21]:</dt>
<dd><p class="first">This pattern has three parts:</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">^</span></code> to match what following only at the beginning of the string. If this were not specified, the pattern
would match no matter where the <code class="docutils literal"><span class="pre">M</span></code> characters were, which is not what you want. You want to make sure
that the <code class="docutils literal"><span class="pre">M</span></code> characters, if they&#8217;re there, are at the beginning of the string.</li>
<li><code class="docutils literal"><span class="pre">M?</span></code> to optionally match a single <code class="docutils literal"><span class="pre">M</span></code> character. Since this is repeated three times, you&#8217;re matching
anywhere from zero to three <code class="docutils literal"><span class="pre">M</span></code> characters in a row.</li>
<li><code class="docutils literal"><span class="pre">$</span></code> to match what precedes only at the end of the string. When combined with the <code class="docutils literal"><span class="pre">^</span></code> character at the
beginning, this means that the pattern must match the entire string, with no other characters before or
after the <code class="docutils literal"><span class="pre">M</span></code> characters.</li>
</ul>
</div></blockquote>
</dd>
<dt>[22]:</dt>
<dd><ul class="first last">
<li><p class="first">re.search:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># takes a regular expression (pattern) and a string (M) to try to match against the regular expression.</span>
<span class="c1"># If a match is found, search returns an object which has various methods to describe the match</span>
<span class="c1"># If no match is found, search returns None, the Python null value.</span>
<span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">'M'</span></code> matches, because the first optional <code class="docutils literal"><span class="pre">M</span></code> matches and the second and third optional <code class="docutils literal"><span class="pre">M</span></code> characters are ignored.</p>
</li>
</ul>
</dd>
<dt>[25]:</dt>
<dd><code class="docutils literal"><span class="pre">'MMMM'</span></code> does not match. All four <code class="docutils literal"><span class="pre">M</span></code> characters match, but then the regular expression insisits on the string
ending (because of the <code class="docutils literal"><span class="pre">$</span></code> character), and the string doesn&#8217;t end yet (because of the fourth <code class="docutils literal"><span class="pre">M</span></code>). So <code class="docutils literal"><span class="pre">search</span></code>
returns <code class="docutils literal"><span class="pre">None</span></code>.</dd>
<dt>[26]:</dt>
<dd>Interestingly, an empty string also matches this regular expression, since all the <code class="docutils literal"><span class="pre">M</span></code> characters are optional.</dd>
</dl>
</div>
<div class="section" id="checking-for-hundreds-a-b-c">
<h4>7.3.1.1 Checking for Hundreds <code class="docutils literal"><span class="pre">(a|b|c)</span></code><a class="headerlink" href="#checking-for-hundreds-a-b-c" title="Permalink to this headline">¶</a></h4>
<p>The hundreds place is more difficult than the thousands, because there are several mutually exclusive ways it would be
expressed, depending on its value.</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">100</span></code> = <code class="docutils literal"><span class="pre">C</span></code></li>
<li><code class="docutils literal"><span class="pre">200</span></code> = <code class="docutils literal"><span class="pre">CC</span></code></li>
<li><code class="docutils literal"><span class="pre">300</span></code> = <code class="docutils literal"><span class="pre">CCC</span></code></li>
<li><code class="docutils literal"><span class="pre">400</span></code> = <code class="docutils literal"><span class="pre">CD</span></code></li>
<li><code class="docutils literal"><span class="pre">500</span></code> = <code class="docutils literal"><span class="pre">D</span></code></li>
<li><code class="docutils literal"><span class="pre">600</span></code> = <code class="docutils literal"><span class="pre">DC</span></code></li>
<li><code class="docutils literal"><span class="pre">700</span></code> = <code class="docutils literal"><span class="pre">DCC</span></code></li>
<li><code class="docutils literal"><span class="pre">800</span></code> = <code class="docutils literal"><span class="pre">DCCC</span></code></li>
<li><code class="docutils literal"><span class="pre">900</span></code> = <code class="docutils literal"><span class="pre">CM</span></code></li>
</ul>
</div></blockquote>
<p>So there are three possible patterns:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">CM</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">CD</span></code></p>
</li>
<li><p class="first">an optional <code class="docutils literal"><span class="pre">D</span></code>, followed by zero to three <code class="docutils literal"><span class="pre">C</span></code> characters:</p>
<blockquote>
<div><ul class="simple">
<li>Zero to three <code class="docutils literal"><span class="pre">C</span></code> characters (zero if the hundreds place is 0)</li>
<li><code class="docutils literal"><span class="pre">D</span></code>, followed by zero to three <code class="docutils literal"><span class="pre">C</span></code> characters.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>Example 7.4. Checking for Hundreds</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">(a|b|c)</span></code> matches either <code class="docutils literal"><span class="pre">a</span></code> or <code class="docutils literal"><span class="pre">b</span></code> or <code class="docutils literal"><span class="pre">c</span></code>.</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [27]: import re

<span class="hll">In [28]: pattern = &#39;^M?M?M?M?(CM|CD|D?C?C?C?)$&#39;
</span>
In [29]: re.search(pattern,&#39;MCM&#39;)
Out[29]: &lt;_sre.SRE_Match at 0x9248820&gt;

In [30]: re.search(pattern,&#39;MD&#39;)
Out[30]: &lt;_sre.SRE_Match at 0x92487a0&gt;

In [31]: re.search(pattern,&#39;MMMCCC&#39;)
Out[31]: &lt;_sre.SRE_Match at 0x9248760&gt;

In [32]: re.search(pattern,&#39;MCMC&#39;)

In [33]: re.search(pattern,&#39;&#39;)
Out[33]: &lt;_sre.SRE_Match at 0x92488e0&gt;
</pre></div>
</div>
<dl class="docutils">
<dt>[28]:</dt>
<dd>This pattern starts out the same as the previous one, checking for the beginning of the string (<code class="docutils literal"><span class="pre">^</span></code>),
then the thousands place (<code class="docutils literal"><span class="pre">M?M?M?M?</span></code>). Then it has the new part, in parentheses, which defines a set of
three mutually exclusive patterns, separated by vertical bars: <code class="docutils literal"><span class="pre">CM</span></code>, <code class="docutils literal"><span class="pre">CD</span></code>,and <code class="docutils literal"><span class="pre">D?C?C?C?</span></code>. The
regular expression parser checks for each of these patterns in order( from left to right),
takes the first one that matches, and ignores the rest.</dd>
<dt>[29]:</dt>
<dd><code class="docutils literal"><span class="pre">'MCM'</span></code> (<code class="docutils literal"><span class="pre">1900</span></code>) matches because the first <code class="docutils literal"><span class="pre">M</span></code> matches, the second and third <code class="docutils literal"><span class="pre">M</span></code> characters are ignored,
and the <code class="docutils literal"><span class="pre">CM</span></code> matches (so the <code class="docutils literal"><span class="pre">CD</span></code> and <code class="docutils literal"><span class="pre">D?C?C?C?</span></code> patterns are never considered).</dd>
<dt>[30]:</dt>
<dd><code class="docutils literal"><span class="pre">'MD'</span></code> (<code class="docutils literal"><span class="pre">1500</span></code>) matches because the first <code class="docutils literal"><span class="pre">M</span></code> matches, the second and third <code class="docutils literal"><span class="pre">M</span></code> characters are ignored, and the
<code class="docutils literal"><span class="pre">D?C?C?C?</span></code> pattern matches <code class="docutils literal"><span class="pre">D</span></code> (each of the three <code class="docutils literal"><span class="pre">C</span></code> characters are optional and are ignored).</dd>
<dt>[31]:</dt>
<dd><code class="docutils literal"><span class="pre">'MMMCCC'&quot;</span></code> (<code class="docutils literal"><span class="pre">3300</span></code>) matches because all three <code class="docutils literal"><span class="pre">M</span></code> characters match, and the <code class="docutils literal"><span class="pre">D?C?C?C?</span></code> pattern matches <code class="docutils literal"><span class="pre">CCC</span></code>.</dd>
<dt>[33]:</dt>
<dd><code class="docutils literal"><span class="pre">'MCMC'</span></code> does not match. The first <code class="docutils literal"><span class="pre">M</span></code> matches, the second and third <code class="docutils literal"><span class="pre">M</span></code> characters are ignored, and the
<code class="docutils literal"><span class="pre">'CM'</span></code> matches, but then the <code class="docutils literal"><span class="pre">$</span></code> does not match because you&#8217;re not at the end of the string yet (you still have
and unmatched <code class="docutils literal"><span class="pre">C</span></code> character). The <code class="docutils literal"><span class="pre">C</span></code> does <em>not</em> match as part of the <code class="docutils literal"><span class="pre">D?C?C?C?</span></code> pattern, because the
mutually exclusive <code class="docutils literal"><span class="pre">CM</span></code> pattern has already matched.</dd>
</dl>
</div>
<div class="section" id="using-the-n-m-syntax">
<h4>7.3.1.2 Using the <code class="docutils literal"><span class="pre">{n.m}</span></code> Syntax<a class="headerlink" href="#using-the-n-m-syntax" title="Permalink to this headline">¶</a></h4>
<p>In the previous section, you were dealing with a pattern where the same character could be repeated up to three times.
There is another way to express this in regular expression.</p>
<p>Example 7.5 The New Way: From <code class="docutils literal"><span class="pre">n</span></code> to <code class="docutils literal"><span class="pre">m</span></code></p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">x{n,m}</span></code> matches an <code class="docutils literal"><span class="pre">x</span></code> character [n,m] times</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [34]: import re

In [35]: old_pattern = &#39;^M?M?M?M?$&#39;

In [36]: re.search(old_pattern, &#39;M&#39;)
Out[36]: &lt;_sre.SRE_Match at 0x92d4528&gt;

In [37]: re.search(old_pattern, &#39;MM&#39;)
Out[37]: &lt;_sre.SRE_Match at 0x92d4608&gt;

In [38]: re.search(old_pattern, &#39;MMM&#39;)
Out[38]: &lt;_sre.SRE_Match at 0x92d4720&gt;

In [39]: re.search(old_pattern, &#39;MMMMM&#39;)

<span class="hll">In [40]: new_pattern = &#39;^M{0,4}$&#39;
</span>
In [41]: re.search(new_pattern, &#39;M&#39;)
Out[41]: &lt;_sre.SRE_Match at 0x92d4988&gt;

In [42]: re.search(new_pattern, &#39;MM&#39;)
Out[42]: &lt;_sre.SRE_Match at 0x92d4aa0&gt;

In [43]: re.search(new_pattern, &#39;MMM&#39;)
Out[43]: &lt;_sre.SRE_Match at 0x92d4bb8&gt;

In [44]: re.search(new_pattern, &#39;MMMMM&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[40]:</dt>
<dd>This patterns says: &#8220;Match the start of the string, then anywhere from zero to three <code class="docutils literal"><span class="pre">M</span></code> characters,
then the end of the string.&#8221; The <code class="docutils literal"><span class="pre">0</span></code> and <code class="docutils literal"><span class="pre">3</span></code> can be any numbers; if you want to match at least one
but no more than three <code class="docutils literal"><span class="pre">M</span></code> characters, you could say <code class="docutils literal"><span class="pre">M{1,3}</span></code>.</dd>
</dl>
</div>
<div class="section" id="checking-for-tens-and-ones">
<h4>7.3.1.3 Checking for Tens and Ones<a class="headerlink" href="#checking-for-tens-and-ones" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Tens place</th>
<th class="head">Ones place</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">10</span></code> = <code class="docutils literal"><span class="pre">X</span></code></td>
<td><code class="docutils literal"><span class="pre">1</span></code> = <code class="docutils literal"><span class="pre">I</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">20</span></code> = <code class="docutils literal"><span class="pre">XX</span></code></td>
<td><code class="docutils literal"><span class="pre">2</span></code> = <code class="docutils literal"><span class="pre">II</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">30</span></code> = <code class="docutils literal"><span class="pre">XXX</span></code></td>
<td><code class="docutils literal"><span class="pre">3</span></code> = <code class="docutils literal"><span class="pre">III</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">40</span></code> = <code class="docutils literal"><span class="pre">XL</span></code></td>
<td><code class="docutils literal"><span class="pre">4</span></code> = <code class="docutils literal"><span class="pre">IV</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">50</span></code> = <code class="docutils literal"><span class="pre">L</span></code></td>
<td><code class="docutils literal"><span class="pre">5</span></code> = <code class="docutils literal"><span class="pre">V</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">60</span></code> = <code class="docutils literal"><span class="pre">LX</span></code></td>
<td><code class="docutils literal"><span class="pre">6</span></code> = <code class="docutils literal"><span class="pre">VI</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">70</span></code> = <code class="docutils literal"><span class="pre">LXX</span></code></td>
<td><code class="docutils literal"><span class="pre">7</span></code> = <code class="docutils literal"><span class="pre">VII</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">80</span></code> = <code class="docutils literal"><span class="pre">LXXX</span></code></td>
<td><code class="docutils literal"><span class="pre">8</span></code> = <code class="docutils literal"><span class="pre">VIII</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">90</span></code> = <code class="docutils literal"><span class="pre">XC</span></code></td>
<td><code class="docutils literal"><span class="pre">9</span></code> = <code class="docutils literal"><span class="pre">IX</span></code></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Example 7.6 Checking for Tens</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [45]: pattern = &#39;^M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)$&#39;

In [46]: re.search(pattern, &#39;MCMXL&#39;)  # 1940
Out[46]: &lt;_sre.SRE_Match at 0x92440b0&gt;

In [47]: re.search(pattern, &#39;MCML&#39;) # 1950
Out[47]: &lt;_sre.SRE_Match at 0x9244e30&gt;

In [48]: re.search(pattern, &#39;MCMLX&#39;) # 1960
Out[48]: &lt;_sre.SRE_Match at 0x9244608&gt;

In [49]: re.search(pattern, &#39;MCMLXXX&#39;) # 1980
Out[49]: &lt;_sre.SRE_Match at 0x92b1020&gt;

In [50]: re.search(pattern, &#39;MCMLXXXX&#39;) # invalid
</pre></div>
</div>
</div>
<div class="section" id="final-pattern-for-roman-numeral">
<h4>7.3.1.4 Final Pattern for Roman Numeral<a class="headerlink" href="#final-pattern-for-roman-numeral" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;^M?M?M?M?(CM|CD|D?C?C?C?)(XC|XL|L?X?X?X?)(IX|IV|V?I?I?I?)$&#39;</span>

<span class="c1"># using the altenate {n,m} syntax</span>
<span class="n">alt_pattern</span> <span class="o">=</span> <span class="s1">&#39;^M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="verbose-regular-expressions">
<span id="verbose-re"></span><h2>7.4. Verbose Regular Expressions<a class="headerlink" href="#verbose-regular-expressions" title="Permalink to this headline">¶</a></h2>
<div class="admonition-usage admonition">
<p class="first admonition-title">usage</p>
<p class="last">Writing documentation inside the regular expression.</p>
</div>
<p>A <em>verbose regular expression</em> is different from a compact regular expression in two ways:</p>
<blockquote>
<div><ul class="simple">
<li>Whitespace is ignored. Spaces, tabs, and carriage returns are not matched as spaces, tabs, and carriage returns.
They&#8217;re not matched at all. (If you want to match a space in a verbose regular expression, you&#8217;ll need to escape it by
putting a backslash in front of it.)</li>
<li>Comments are ignored.</li>
</ul>
</div></blockquote>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [51]: pattern = &quot;&quot;&quot;
    ...:    ^                 # beginning of string
    ...:    M{0,4}            # thousands - 0 to 4 M&#39;s
    ...:    (CM|CD|D?C{0,3})  # hundreds - 900 (CM), 400 (CD), 0-300 (0 to 3 C&#39;s),
    ...:                      #            or 500-800 (D, followed by 0 to 3 C&#39;s)
    ...:    (XC|XL|L?X{0,3})  # tens - 90 (XC), 40 (XL), 0-30 (0 to 3 X&#39;s),
    ...:                      #        or 50-80 (L, followed by 0 to 3 X&#39;s)
    ...:    (IX|IV|V?I{0,3})  # ones - 9 (IX), 4 (IV), 0-3 (0 to 3 I&#39;s),
    ...:                      #        or 5-8 (V, followed by 0 to 3 I&#39;s)
    ...:    $                 # end of string
    ...:    &quot;&quot;&quot;

<span class="hll">In [52]: re.search(pattern, &#39;M&#39;,re.VERBOSE)
</span>Out[52]: &lt;_sre.SRE_Match at 0x92d71e0&gt;

In [53]: re.search(pattern, &#39;MCMLXXXX&#39;, re.VERBOSE)

In [54]: re.search(pattern, &#39;MCMLXXXIX&#39;, re.VERBOSE)
Out[54]: &lt;_sre.SRE_Match at 0x9241bb0&gt;

In [55]: re.search(pattern, &#39;MMMMDCCCLXXXVIII&#39;, re.VERBOSE)
Out[55]: &lt;_sre.SRE_Match at 0x9241b60&gt;

In [56]: re.search(pattern, &#39;M&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[52]:</dt>
<dd>The most important thing to remember when using verbose regular expressions is that
you need to pass an extra argument when working with them: <code class="docutils literal"><span class="pre">re.VERBOSE</span></code> is a
constant defined in the <code class="docutils literal"><span class="pre">re</span></code> module that signals that the pattern should be treated
as a verbose regular expression.</dd>
<dt>[56]:</dt>
<dd><code class="docutils literal"><span class="pre">re.VERBOSE</span></code> flag is missing. Python assumes every regular expression is compact unless
you explicitly state that it is verbose.</dd>
</dl>
</div>
<div class="section" id="case-study-parsing-phone-numbers">
<span id="case-stuy-phone"></span><h2>7.5. Case Study: Parsing Phone Numbers<a class="headerlink" href="#case-study-parsing-phone-numbers" title="Permalink to this headline">¶</a></h2>
<p>When a regular expression <em>does</em> match, you can pick out specific pieces of it. You can find out what matched where.</p>
<p>The problem:</p>
<blockquote>
<div>parsing an American phone number. The client wanted to be able to enter the number free-form (in a single field),
but then wanted to store the area code, trunk, number, and optionally an extension separately in the company&#8217;s database.</div></blockquote>
<p>Here are the possible forms of phone numbers:</p>
<blockquote>
<div><ul class="simple">
<li>800-555-1212</li>
<li>800 555 1212</li>
<li>800.555.1212</li>
<li><ol class="first arabic" start="800">
<li>555-1212</li>
</ol>
</li>
<li>1-800-555-1212</li>
<li>800-555-1212-1234</li>
<li>800-555-1212x1234</li>
<li>800-555-1212 ext. 1234</li>
<li>work 1-(800) 555.1212 #1234</li>
</ul>
</div></blockquote>
<p>In each of these case, I need to know that the area code was <code class="docutils literal"><span class="pre">800</span></code>, the trunk was <code class="docutils literal"><span class="pre">555</span></code>, and the rest of the phone number was <code class="docutils literal"><span class="pre">1212</span></code>.
For those with an extension, I need to know that the extension was <code class="docutils literal"><span class="pre">1234</span></code>.</p>
<p>Example 7.10 Finding Numbers</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">\d</span></code> means &#8220;any numeric digit&#8221; (0 through 9).</p>
</div>
<div class="admonition-key-func admonition">
<p class="first admonition-title">Key Func</p>
<p>patternObj = re.compile(pattern)</p>
<p class="last">patternObj.search(string).groups()</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [1]: import re

<span class="hll">In [2]: phonePattern = re.compile(r&#39;^(\d{3})-(\d{3})-(\d{4})$&#39;)
</span>
In [3]: type(phonePattern)
Out[3]: _sre.SRE_Pattern

<span class="hll">In [4]: phonePattern.search(&#39;800-555-1212&#39;).groups()
</span>Out[4]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;)

In [5]: phonePattern.search(&#39;800-555-1212-1234&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[2]:</dt>
<dd><ul class="first last">
<li><p class="first">re.complie:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># compile a regular expression pattern into a regular expression object,</span>
<span class="c1"># which can be used for matching using its match() and search() methods</span>
<span class="n">patternObj</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">\d</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">{3}</span></code> means &#8220;match exactly three numeric digits&#8221; (a variation on the <code class="docutils literal"><span class="pre">{n,m}</span> <span class="pre">syntax</span></code>)</li>
<li><code class="docutils literal"><span class="pre">\d</span></code> means &#8220;any numeric digit&#8221; (0 through 9)</li>
<li><code class="docutils literal"><span class="pre">(\d{3})</span></code> means &#8220;match exactly three numeric digits, and <em>then remember them as a group that I can ask for later</em>&#8220;</li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
<dt>[4]:</dt>
<dd><ul class="first last">
<li><p class="first">groups():</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># to get access to the groups that the regular expression parser remembered along the way</span>
<span class="c1"># it will return a tuple of however many groups were defined in the regular expression.</span>
<span class="n">patternObj</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first">In this case, you defined three groups, one with three digits, one with three digits, and one with four digits.</p>
</li>
</ul>
</dd>
<dt>[5]:</dt>
<dd><div class="admonition-problem first last admonition">
<p class="first admonition-title">problem</p>
<p class="last">This regular expression doesn&#8217;t handle a phone number with an extension on the end.</p>
</div>
</dd>
</dl>
<p>Example 7.11 Finding the Extension</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">x+</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> one or more times</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [6]: phonePattern = re.compile(r&#39;^(\d{3})-(\d{3})-(\d{4})-(\d+)$&#39;)

In [7]: phonePattern.search(&#39;800-555-1212-1234&#39;).groups()
Out[7]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

<span class="hll">In [8]: phonePattern.search(&#39;800 555 1212 1234&#39;)
</span>
In [9]: phonePattern.search(&#39;800-555-1212&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[6]:</dt>
<dd><ul class="first last">
<li><p class="first"><code class="docutils literal"><span class="pre">\d+</span></code>:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">x+</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> one or more times.</li>
<li><code class="docutils literal"><span class="pre">\d+</span></code> means &#8220;match one or more numeric digits&#8221;</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">This regular expression is almost identical to the previous one:
you match the beginning of the string, then a remembered group of three digits,
then a hyphen, then a remembered group of three digits, then a hyphen, then
a remembered group of four digits,then match another hyphen, and
a remembered group of one or more digits, then the end of the string.</p>
</li>
</ul>
</dd>
<dt>[8]&amp;[9]:</dt>
<dd><div class="admonition-problem first last admonition">
<p class="first admonition-title">problem</p>
<ul class="last simple">
<li>it assumes that the different parts of the phone number are separated by hyphens.
What if they&#8217;re separated by spaces, or commas, or dots?</li>
<li>You cannot parse phone numbers without and extension.</li>
</ul>
</div>
</dd>
</dl>
<p>Example 7.12 Handling Different Separators</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">\D</span></code> matches any non-numeric character.</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="hll">In [10]: phonePattern = re.compile(r&#39;^(\d{3})\D+(\d{3})\D+(\d{4})\D+(\d+)$&#39;)
</span>
In [11]: phonePattern.search(&#39;800 555 1212 1234&#39;).groups()
Out[11]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [12]: phonePattern.search(&#39;800-555-1212-1234&#39;).groups()
Out[12]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [13]: phonePattern.search(&#39;8005551212&#39;)

In [14]: phonePattern.search(&#39;800-555-1212&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[10]:</dt>
<dd><p class="first"><code class="docutils literal"><span class="pre">\D</span></code>:</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">\D</span></code> matches any character <em>except</em> a numeric digit.</li>
<li><code class="docutils literal"><span class="pre">\D+</span></code> matchs one or more characters that are not digits. (this is how you try to match different separators)</li>
</ul>
</div></blockquote>
</dd>
<dt>[13]&amp;[14]:</dt>
<dd><div class="admonition-problem first last admonition">
<p class="first admonition-title">problem</p>
<ul class="last simple">
<li>it assumes that there is a separator at all. What if the phone number is entered without any spaces or hyphens?</li>
<li>extensions are still required.</li>
</ul>
</div>
</dd>
</dl>
<p>Example 7.13 Handling Numbers Without Separators</p>
<div class="admonition-key-expression admonition">
<p class="first admonition-title">Key Expression</p>
<p class="last"><code class="docutils literal"><span class="pre">x*</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> zero or more times.</p>
</div>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="hll">In [15]: phonePattern = re.compile(r&#39;^(\d{3})\D*(\d{3})\D*(\d{4})\D*(\d*)$&#39;)
</span>
In [16]: phonePattern.search(&#39;80055512121234&#39;).groups()
Out[16]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [18]: phonePattern.search(&#39;800.555.1212 x1234&#39;).groups()
Out[18]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [21]: phonePattern.search(&#39;800-555-1212&#39;).groups()
Out[21]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;&#39;)

In [22]: phonePattern.search(&#39;(800)5551212 x1234&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[15]:</dt>
<dd><p class="first"><code class="docutils literal"><span class="pre">*</span></code>:</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">X*</span></code> matches <code class="docutils literal"><span class="pre">x</span></code> zero or more times.</li>
<li>The only change you&#8217;ve made since that last step is changing all the <code class="docutils literal"><span class="pre">+</span></code> to <code class="docutils literal"><span class="pre">*</span></code>.
Instead of <code class="docutils literal"><span class="pre">\D+</span></code> between the parts of the phone number, you now match on <code class="docutils literal"><span class="pre">\D*</span></code>.
It means &#8220;match non-numeric character(s) zero or more times&#8221;.</li>
</ul>
</div></blockquote>
</dd>
<dt>[22]:</dt>
<dd><div class="admonition-problem first last admonition">
<p class="first admonition-title">problem</p>
<p class="last">There&#8217;s an extra character before the area code, but the regular expression assumes that the
area code is the first thing at the beginning of the string.</p>
</div>
</dd>
</dl>
<p>Example 7.14 Handling Leading Characters</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="hll">In [23]: phonePattern = re.compile(r&#39;(\d{3})\D*(\d{3})\D*(\d{4})\D*(\d*)$&#39;)
</span>
In [24]: phonePattern.search(&#39;(800)5551212 ext. 1234&#39;).groups()
Out[24]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [25]: phonePattern.search(&#39;800-555-1212&#39;).groups()
Out[25]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;&#39;)

In [26]: phonePattern.search(&#39;work 1-(800) 555.1212 #1234&#39;).groups()
Out[26]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)
</pre></div>
</div>
<dl class="docutils">
<dt>[23]:</dt>
<dd>Note the lack of <code class="docutils literal"><span class="pre">^</span></code> in this regular expression.
You are not matching the beginning of the string anymore.</dd>
</dl>
<p>Example 7.15 Parsing Phone Numbers (Final Version)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span>In [27]: phonePattern = re.compile(r&#39;&#39;&#39;
    ...:              # don&#39;t match beginning of string, number can start anywhere
    ...: (\d{3})      # area code is 3 digits (e.g. &#39;800&#39;)
    ...: \D*          # optional separator is any number of non-digits
    ...: (\d{3})      # trunk is 3 digits (e.g. &#39;555&#39;)
    ...: \D*          # optional separator
    ...: (\d{4})      # rest of number is 4 digits (e.g. &#39;1212&#39;)
    ...: \D*          # optional separator
    ...: (\d*)        # extension is optional and can be any number of digits
    ...: $            # end of string
    ...: &#39;&#39;&#39;, re.VERBOSE)

In [28]: phonePattern.search(&#39;work 1-(800) 555.1212 #1234&#39;).groups()
Out[28]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;1234&#39;)

In [29]: phonePattern.search(&#39;800-555-1212&#39;).groups()
Out[29]: (&#39;800&#39;, &#39;555&#39;, &#39;1212&#39;, &#39;&#39;)
</pre></div>
</div>
</div>
<div class="section" id="further-reading">
<span id="further-reading7"></span><h2>7.6. Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Regular Expression <a class="reference external" href="http://docs.python.org/2/howto/regex.html">HOWTO</a> teaches about regular expressions and how to use them in Python.</li>
<li><a class="reference external" href="http://www.python.org/doc/current/lib/module-re.html">re</a> module</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="chap13.html" title="Unit Testing"
             >next</a></li>
        <li class="right" >
          <a href="chap6.html" title="Exceptions and File Handling"
             >previous</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../pj.html">projects</a>|&nbsp;</li>
        
        

          <li class="nav-item nav-item-1"><a href="../../../kb.html" >Knowledge Base</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="diveintopython.html" >Dive into Python Study Notes</a> &raquo;</li> 
      </ul>
    </div>
<div class="footer" role="contentinfo">
      &copy; Copyright 2012-2016, Zeyuan Hu.
    Last updated on Apr 29, 2016. 
  <a href="http://www.easycounter.com/">
  <img src="//www.easycounter.com/counter.php?ferrishu3886"
       height="12" border="0" alt="Website Hit Counters">Unique Visitors.<a>
</div>
  </body>
</html>