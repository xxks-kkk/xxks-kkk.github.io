
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>DB2 HowTOs &mdash; Zeyuan Hu&#39;s World</title>
    
    <link rel="stylesheet" href="../../../_static/zeyuan.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="top" title="Zeyuan Hu&#39;s World" href="../../../index.html" />
    <link rel="up" title="Knowledge Base" href="../../../kb.html" />
    <link rel="next" title="Dive into Python Study Notes" href="../../python/diveintopython/diveintopython.html" />
    <link rel="prev" title="Precision vs. Scale" href="p4.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../../index.html"><img src="../../../_static/logo2.png" border="0" alt="Logo of Zeyuan's personal website"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../python/diveintopython/diveintopython.html" title="Dive into Python Study Notes"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="p4.html" title="Precision vs. Scale"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../kb.html">knowledge base</a>|&nbsp;</li>
        <li><a href="../../../pj.html">projects</a>|&nbsp;</li>
        <li><a href="../../../personal.html">about me</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../../kb.html" accesskey="U">Knowledge Base</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">DB2 HowTOs</a><ul>
<li><a class="reference internal" href="#system-catalog">System Catalog</a></li>
<li><a class="reference internal" href="#misc">Misc</a></li>
<li><a class="reference internal" href="#security">Security</a></li>
<li><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
</ul>

    <h3>About this site</h3>
        <ul class="this-page-menu">
            <li><a class="reference external" 
                   href="../../../todo.html" >About</a></li>
        </ul>
<div id="searchbox" style="display: none">
  <h3>search this site</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="db2-howtos">
<span id="db2-howto-rst"></span><h1>DB2 HowTOs<a class="headerlink" href="#db2-howtos" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">I am trying to port those commands, especially the lengthy ones, to
<a class="reference external" href="https://github.com/xxks-kkk/Zeyuan-s-tools/blob/master/db2mun">db2mun - a tool to avoid reptitive typing db2 cmds</a></p>
</div>
<div class="section" id="system-catalog">
<h2>System Catalog<a class="headerlink" href="#system-catalog" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Check the default Federation Server option in system catalog</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 &quot;select char(option,10) OPTION, char(setting,10) SETTING \
     from syscat.serveroptions \
     where servername=&#39;SERVER1&#39;&quot;

OPTION     SETTING
---------- ----------
NODE       hive
DBNAME     default
CODEPAGE   1252

3 record(s) selected.
</pre></div>
</div>
<ul class="simple">
<li>Check the procedures registered with database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 &quot;SELECT char(ROUTINENAME,15) ROUTINENAME, ROUTINESCHEMA FROM SYSCAT.ROUTINES WHERE OWNER=&#39;ZEYUAN HU&#39; AND ROUTINETYPE = &#39;P&#39;&quot;

ROUTINENAME     ROUTINESCHEMA
--------------- -------------------------------------------------------------------------------
BONUS_INCREASE  ZEYUAN HU
CHECK_COMM      ZEYUAN HU

2 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this case, show a list of the procedures created by the authorization ID ZEYUAN HU</p>
</div>
<ul class="simple">
<li>show a list of the user-defined routines existing in the database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 &quot;SELECT char(ROUTINENAME,15) ROUTINENAME, ROUTINESCHEMA FROM SYSCAT.ROUTINES WHERE OWNER=&#39;ZEYUAN HU&#39; AND ROUTINETYPE = &#39;F&#39;&quot;
</pre></div>
</div>
</div>
<div class="section" id="misc">
<h2>Misc<a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Show current available database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 list active databases
</pre></div>
</div>
<ul class="simple">
<li>Show current active schema</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 values current schema
</pre></div>
</div>
<ul class="simple">
<li>List all existing schemas</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>$ db2 &quot;select char(schemaname,20) from syscat.schemata&quot;

1
--------------------
SYSIBM
SYSCAT
SYSFUN
SYSSTAT
SYSPROC
SYSIBMADM
SYSIBMINTERNAL
SYSIBMTS
SYSPUBLIC
NULLID
SQLJ
P0
SYSTOOLS
IIDEV28

14 record(s) selected.
</pre></div>
</div>
<ul class="simple">
<li>Retrieve all table names for a given schema</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>$ db2 list tables for schema p0

Table/View                      Schema          Type  Creation time
------------------------------- --------------- ----- --------------------------
TESTTB                          P0              T     2016-01-10-12.22.45.342023

1 record(s) selected.
</pre></div>
</div>
<ul class="simple">
<li>List all tablespaces for current database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>$ db2 list tablespaces

Tablespaces for Current Database

Tablespace ID                        = 0
Name                                 = SYSCATSPACE
Type                                 = Database managed space
Contents                             = All permanent data. Regular table space.
State                                = 0x0000
  Detailed explanation:
    Normal

Tablespace ID                        = 1
Name                                 = TEMPSPACE1
Type                                 = System managed space
Contents                             = System Temporary data
State                                = 0x0000
  Detailed explanation:
    Normal

Tablespace ID                        = 2
Name                                 = USERSPACE1
Type                                 = Database managed space
Contents                             = All permanent data. Large table space.
State                                = 0x0000
  Detailed explanation:
    Normal

Tablespace ID                        = 3
Name                                 = SYSTOOLSPACE
Type                                 = Database managed space
Contents                             = All permanent data. Large table space.
State                                = 0x0000
  Detailed explanation:
    Normal
</pre></div>
</div>
<ul class="simple">
<li>list all databases in an instance</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>=&gt; db2 list db directory

System Database Directory

Number of entries in the directory = 1

Database 1 entry:

Database alias                       = FED
Database name                        = FED
Local database directory             = /home/iidev20
Database release level               = d.00
Comment                              =
Directory entry type                 = Indirect
Catalog database partition number    = 0
Alternate server hostname            =
Alternate server port number         =
</pre></div>
</div>
</div>
<div class="section" id="security">
<h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p><strong>SYSIBMADM.PRIVILEGES</strong> is a catalog view that holds database object privilege information
for authorization IDs (roles, users) defined in the system catalog table. If the database
was created using <code class="docutils literal"><span class="pre">RESTRICTIVE</span></code> clause, select privilege is not automatically granted to PUBLIC.
If that is the case, one of the following privileges/authorities are needed to query this view:</p>
<ul class="simple">
<li>SELECT privilege on the PRIVILEGES administrative view</li>
<li>CONTROL privilege on the PRIVILEGES administrative view</li>
<li>DATAACCESS authority</li>
<li>DBADM authority</li>
<li>SQLADM authority</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>&gt;db2 select distinct(objecttype) from sysibmadm.privileges

OBJECTTYPE
------------------------
DB2 PACKAGE
FUNCTION
GLOBAL VARIABLE
INDEX
MODULE
PROCEDURE
SCHEMA
TABLE
TABLESPACE
VIEW
WORKLOAD

11 record(s) selected.
</pre></div>
</div>
<ul class="simple">
<li>What privileges have been granted to this object?</li>
</ul>
<p>Given a database object (table/view/alias etc) name &#8220;$OBJECTNAME&#8221; and its schema &#8220;$SCHEMA&#8221;, here is how to
check current privileges that users hold for this table</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT char(authid, 20) AS authid_id, \
        CASE authidtype \
                WHEN &#39;U&#39; THEN &#39;USER&#39; \
                WHEN &#39;G&#39; THEN &#39;GROUP&#39; \
                WHEN &#39;R&#39; THEN &#39;ROLE&#39; \
        END authidtype , \
        privilege \
FROM sysibmadm.privileges \
WHERE objectname = &#39;$OBJECTNAME&#39; \
AND objectschema = &#39;$SCHEMA&#39; \
ORDER BY authid, authidtype, privilege WITH ur;
</pre></div>
</div>
<ul class="simple">
<li>Which privileges have been granted to a role &#8220;$ROLE&#8221;?</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>SELECT char(objectschema,10) AS SCHEMA, \
        char(objectname,65) NAME, \
        char(privilege, 10) PRIVILEGE, \
        objecttype \
FROM sysibmadm.privileges \
WHERE authid=&#39;$ROLE&#39; \
AND authidtype=&#39;R&#39; ORDER BY 1,2,3 WITH UR;
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Example</p>
<div class="highlight-python"><div class="highlight"><pre>db2 SELECT char(objectschema,10) AS SCHEMA, \
db2 (cont.) =&gt;     char(objectname,65) NAME, \
db2 (cont.) =&gt;     char(privilege, 10) PRIVILEGE, \
db2 (cont.) =&gt;     objecttype \
db2 (cont.) =&gt; FROM sysibmadm.privileges \
db2 (cont.) =&gt; WHERE authid=&#39;SALES&#39; \
db2 (cont.) =&gt; AND authidtype=&#39;R&#39; ORDER BY 1,2,3 WITH UR

SCHEMA     NAME                                                              PRIVILEGE  OBJECTTYPE
---------- ----------------------------------------------------------------- ---------- ------------------------
STOREDB    CUSTOMER                                                          INSERT     TABLE
STOREDB    CUSTOMER                                                          SELECT     TABLE
STOREDB    CUSTOMER                                                          UPDATE     TABLE

3 record(s) selected.
</pre></div>
</div>
</div>
<ul class="simple">
<li>Which privileges have been granted to a user?</li>
</ul>
<p>list the privileges granted to a user &#8220;$USER&#8221; which could be an LDAP ID or OS ID</p>
<div class="highlight-python"><div class="highlight"><pre>SELECT char(objectschema,10) AS SCHEMA, \
        char(objectname,65) NAME, \
        char(privilege, 10) PRIVILEGE, \
        objecttype \
FROM sysibmadm.privileges \
WHERE authid=&#39;$USER&#39; \
AND authidtype=&#39;U&#39; ORDER BY 1,2,3 WITH UR;
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">you can make a script to contain the above SQLs to avoid repetitive typing. Don&#8217;t forget to
add script location to your UNIX&#8217;s $PATH</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://db2talk.com/2014/06/09/quick-primer-on-checking-database-object-privileges-in-db2-luw">http://db2talk.com/2014/06/09/quick-primer-on-checking-database-object-privileges-in-db2-luw</a></p>
</div>
<p><a class="reference download internal" href="../../../_downloads/security_cmds.txt"><code class="xref download docutils literal"><span class="pre">security</span> <span class="pre">commands</span></code></a></p>
</div>
<div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="topic">
<p class="topic-title first">lookup db2 error code in system</p>
<p>(<a class="reference external" href="mailto:iidev20&#37;&#52;&#48;maradona">iidev20<span>&#64;</span>maradona</a>) /home/iidev20
$ db2 ? sql901n</p>
<dl class="docutils">
<dt>SQL0901N  The SQL statement failed because of a non-severe system error.</dt>
<dd>Subsequent SQL statements can be processed. (Reason &#8220;&lt;reason&gt;&#8221;.)</dd>
</dl>
<p>Explanation:</p>
<p>An error has occurred which is due to a system error. Processing of the
SQL statement has ended for reason &#8220;&lt;reason&gt;&#8221; (this is in English only
and is useful only to IBM support personnel).</p>
<p>User response:</p>
<p>Record the message number (SQLCODE) and reason &#8220;&lt;reason&gt;&#8221;.</p>
<p>If trace was active, invoke the Independent Trace Facility at the
operating system command prompt. Then contact your technical service
representative with the following information:</p>
<ul class="simple">
<li>Problem description</li>
<li>SQLCODE</li>
<li>reason &#8220;&lt;reason&gt;&#8221;</li>
<li>SQLCA contents if possible</li>
<li>Trace file if possible.</li>
</ul>
<p>Federated system users: isolate the problem to the data source failing
the request (refer to the Troubleshooting Guide to determine which data
source is failing to process the SQL statement) and take the necessary
diagnostic steps for that data source. The problem determination
procedures for data sources vary, so refer to the applicable data source
manuals.</p>
<p>sqlcode: -901</p>
<p>sqlstate: 58004, 5UA0L</p>
</div>
<div class="topic">
<p class="topic-title first">SQL1397N The DB2 service failed to logon</p>
<p>This is usually happened on Windows. This is mainly due to the logon information mismatch in windows service. In order to solve this
you need to go <span class="menuselection">Administrative Tools -&gt; Services</span> Then select &#8220;Properties&#8221; by right clicking on DB2 instance service (ie.
&#8220;DB2-DB2COPY1-DB&#8221; in my case) and under logon tab, change this account password with the correct password you changed through Windows
account management. Of course, you can always change the authorization for thoses services to &#8220;Local system&#8221;.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="http://www.ibm.com/developerworks/data/library/techarticle/dm-0508wasserman/">DB2 UDB security, Part1: Understand how user and group accounts interact with DB2 UDB</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../python/diveintopython/diveintopython.html" title="Dive into Python Study Notes"
             >next</a></li>
        <li class="right" >
          <a href="p4.html" title="Precision vs. Scale"
             >previous</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../kb.html">knowledge base</a>|&nbsp;</li>
        <li><a href="../../../pj.html">projects</a>|&nbsp;</li>
        <li><a href="../../../personal.html">about me</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../../kb.html" >Knowledge Base</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012-2016, Zeyuan Hu.
      Last updated on Mar 12, 2016.
    </div>
  </body>
</html>