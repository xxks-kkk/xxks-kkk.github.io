
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>AWK &mdash; Zeyuan Hu&#39;s World</title>
    
    <link rel="stylesheet" href="../../_static/zeyuan.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/favicon.png"/>
    <link rel="top" title="Zeyuan Hu&#39;s World" href="../../index.html" />
    <link rel="up" title="Knowledge Base" href="../../kb.html" />
    <link rel="next" title="Useful Linux Cmds" href="linux_cmd.html" />
    <link rel="prev" title="All about Emacs" href="../emacs.html" /> 
  </head>
  <body role="document">

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../../index.html"><img src="../../_static/logo2.png" border="0" alt="Logo of Zeyuan's personal website"/></a>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="linux_cmd.html" title="Useful Linux Cmds"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../emacs.html" title="All about Emacs"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../kb.html">knowledge base</a>|&nbsp;</li>
        <li><a href="../../pj.html">projects</a>|&nbsp;</li>
        <li><a href="../../personal.html">about me</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../kb.html" accesskey="U">Knowledge Base</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">AWK</a><ul>
<li><a class="reference internal" href="#case-study">Case Study</a><ul>
<li><a class="reference internal" href="#search-pattern-for-each-line">Search pattern for each line</a></li>
<li><a class="reference internal" href="#pass-shell-variable-as-a-pattern-to-awk">Pass shell variable as a /pattern/ to awk</a></li>
</ul>
</li>
<li><a class="reference internal" href="#howtos">HowTos</a></li>
<li><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
</ul>

    <h3>About this site</h3>
        <ul class="this-page-menu">
            <li><a class="reference external" 
                   href="../../todo.html" >About</a></li>
        </ul>
<div id="searchbox" style="display: none">
  <h3>search this site</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="awk">
<span id="awk-rst"></span><h1>AWK<a class="headerlink" href="#awk" title="Permalink to this headline">¶</a></h1>
<p>Last Update: March 11, 2016</p>
<div class="section" id="case-study">
<h2>Case Study<a class="headerlink" href="#case-study" title="Permalink to this headline">¶</a></h2>
<div class="section" id="search-pattern-for-each-line">
<h3>Search pattern for each line<a class="headerlink" href="#search-pattern-for-each-line" title="Permalink to this headline">¶</a></h3>
<p><strong>GOAL:</strong> Kill all the processes containing keyword &#8220;quicktest&#8221;</p>
<div class="highlight-python"><div class="highlight"><pre>(iidev20@maradona) /home/iidev20
$ ps -ef | grep -i quicktest
iidev20 49814180        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 5 NCLIENT 30 SEED 1452586352
iidev20 49945254        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 15 NCLIENT 30 SEED 1452586362
iidev20 50010822        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 14 NCLIENT 30 SEED 1452586361
iidev20 51124770        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 9 NCLIENT 30 SEED 1452586356
iidev20 51911254        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 26 NCLIENT 30 SEED 1452586373
iidev20 52238890        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 11 NCLIENT 30 SEED 1452586358
iidev20 52501070        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 10 NCLIENT 30 SEED 1452586357
iidev20 54401732        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 20 NCLIENT 30 SEED 1452586367
iidev20 54794868        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 22 NCLIENT 30 SEED 1452586369
iidev20 29825944        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 8 NCLIENT 30 SEED 1452586355
iidev20 35789764        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 19 NCLIENT 30 SEED 1452586366
iidev20 36838170        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 13 NCLIENT 30 SEED 1452586360
iidev20 36903922        1   0   Jan 12      -  0:00 quicktest 55556,671,760.mod OP 2 ITR 3000 CLIENT 24 NCLIENT 30 SEED 1452586371
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Solution</p>
<div class="highlight-python"><div class="highlight"><pre>kill -9 `ps -ef | grep $USER | awk &#39;$9 ~ /quicktest/ {print $2}&#39;`
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">$9</span> <span class="pre">~</span> <span class="pre">/quicktest/</span></code> means that &#8220;looking for &#8216;quicktest&#8217; within $9&#8221;</p>
</div>
</div>
<div class="section" id="pass-shell-variable-as-a-pattern-to-awk">
<h3>Pass shell variable as a /pattern/ to awk<a class="headerlink" href="#pass-shell-variable-as-a-pattern-to-awk" title="Permalink to this headline">¶</a></h3>
<p><strong>GOAL:</strong> Truncate a <a class="reference external" href="http://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.admin.trb.doc/doc/c0020802.html?lang=en">db2trace flow file</a> for a specific range of trace point numbers</p>
<p>Usually, the trace file generated by db2 can be extremely large (can easily get to several gigabytes if you are
not carefully enough), and it is hard to browse in the text editor. During my work, I usually <code class="docutils literal"><span class="pre">grep</span></code> the key
word of certain function calls (of course, you can use mask to format trace file as well), and try to dig through
the call stack in between. Thus, my interest is on part of trace file, and I want to cut the trace file based upon
the trace point numbers located through <code class="docutils literal"><span class="pre">grep</span></code>.</p>
<p>The following is one sample flw file:</p>
<div class="highlight-python"><div class="highlight"><pre>...

pid = 19834 tid = 1 node = 0

846         sqlbPFPrefetcherEntryPoint entry
847         sqlbPFPrefetcherEntryPoint data [probe 0]
848         | sqlbPFInitPrefetcher entry
849         | sqlbPFInitPrefetcher data [probe 0]
850         | | sqlbConnectToSharedMemory entry
851         | | sqlbConnectToSharedMemory exit
852         | | sqlbInitEDU entry
853         | | | sqlbGetBPConfig entry
854         | | | sqlbGetBPConfig data [probe 0]
855         | | | sqlbGetBPConfig exit
856         | | | SqlbFileTbl::SqlbFileTbl entry
857         | | | SqlbFileTbl::SqlbFileTbl exit
858         | | sqlbInitEDU exit
859         | sqlbPFInitPrefetcher exit
860         | sqlbpfRemoveFromQ entry

...
</pre></div>
</div>
<p>The number 846, 847, ... are the trace point number, and the key observation here is that those numbers are unique. Thus,
we can have the following shell script to parse the flow file</p>
<div class="highlight-shell"><div class="highlight"><pre><span class="ch">#!/bin/sh</span>

<span class="nb">printf</span> <span class="s2">&quot;Trace file: %s\n&quot;</span> <span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
<span class="nb">printf</span> <span class="s2">&quot;Trace point number lower bound: %d\n&quot;</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span>
<span class="nb">printf</span> <span class="s2">&quot;Trace point number  upper bound: %d\n&quot;</span> <span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span>

<span class="nv">lowerboundlineno</span><span class="o">=</span><span class="sb">`</span>awk -v <span class="nv">p</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> <span class="s1">&#39;$0 ~ p {print NR}&#39;</span> <span class="nv">$3</span><span class="sb">`</span>
<span class="nb">printf</span> <span class="s2">&quot;Trace point number lower bound line number in </span><span class="nv">$3</span><span class="s2"> : %d\n&quot;</span> <span class="s2">&quot;</span>$<span class="s2">lowerboundlineno&quot;</span>

<span class="nv">upperboundlineno</span><span class="o">=</span><span class="sb">`</span>awk -v <span class="nv">p</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$2</span><span class="s2">&quot;</span> <span class="s1">&#39;$0 ~ p {print NR}&#39;</span> <span class="nv">$3</span><span class="sb">`</span>
<span class="nb">printf</span> <span class="s2">&quot;Trace point number upper bound line number in </span><span class="nv">$3</span><span class="s2"> : %d\n\n&quot;</span> <span class="s2">&quot;</span>$<span class="s2">upperboundlineno&quot;</span>

awk -v <span class="nv">a</span><span class="o">=</span><span class="s2">&quot;</span>$<span class="s2">lowerboundlineno&quot;</span> -v <span class="nv">b</span><span class="o">=</span><span class="s2">&quot;</span>$<span class="s2">upperboundlineno&quot;</span> <span class="s1">&#39;NR&gt;=a &amp;&amp; NR&lt;=b&#39;</span> <span class="s2">&quot;</span><span class="nv">$3</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Keys</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-v</span></code> to pass shell variable to awk. If you want to pass more than one shell variable to awk, you need to use
multiple <code class="docutils literal"><span class="pre">-v</span></code> options (ie. <code class="docutils literal"><span class="pre">awk</span> <span class="pre">-v</span> <span class="pre">var1=2</span> <span class="pre">-v</span> <span class="pre">var2=&quot;HI&quot;</span> <span class="pre">'BEGIN{print</span> <span class="pre">var1;</span> <span class="pre">print</span> <span class="pre">var2}'</span></code>)</li>
<li>Use awk&#8217;s <code class="docutils literal"><span class="pre">~</span></code> operator and not <code class="docutils literal"><span class="pre">\pattern\</span></code>. awk will not work if you use
<code class="docutils literal"><span class="pre">lowerboundlineno=`awk</span> <span class="pre">-v</span> <span class="pre">p=&quot;$1&quot;</span> <span class="pre">'/p/</span> <span class="pre">{print</span> <span class="pre">NR}'</span> <span class="pre">&quot;$3&quot;`</span></code>. For some reason, even though <code class="docutils literal"><span class="pre">p</span></code> is assigned with
value say 856, since it is put inside <code class="docutils literal"><span class="pre">/.../</span></code>, the pattern is <code class="docutils literal"><span class="pre">p</span></code> itself, and awk will match rows containing
<code class="docutils literal"><span class="pre">p</span></code>, not 856. So, <strong>Use ~ for passing shell variable as pattern not /.../</strong></li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Please reference <a class="reference external" href="http://www.ibm.com/developerworks/data/library/techarticle/dm-0409melnyk/index.html">IBM developerWorks tutorial</a> and <a class="reference external" href="http://www.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.db2.luw.admin.trb.doc/com.ibm.db2.luw.admin.trb.doc-gentopic1.html?lang=en">IBM Knowledge center</a> if you want to learn more about db2trace facility.</p>
</div>
</div>
</div>
<div class="section" id="howtos">
<h2>HowTos<a class="headerlink" href="#howtos" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/6256174/how-to-find-if-substring-is-in-a-variable-in-awk">How to find if substring is in a variable in awk</a></li>
</ul>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="http://coolshell.cn/articles/9070.html">AWK short tutorial</a></li>
<li><a class="reference external" href="http://www.math.utah.edu/docs/info/gawk_toc.html">AWK Language Programming for Utah.edu</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="linux_cmd.html" title="Useful Linux Cmds"
             >next</a></li>
        <li class="right" >
          <a href="../emacs.html" title="All about Emacs"
             >previous</a> |</li>
        <li><a href="../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../kb.html">knowledge base</a>|&nbsp;</li>
        <li><a href="../../pj.html">projects</a>|&nbsp;</li>
        <li><a href="../../personal.html">about me</a>|&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../../kb.html" >Knowledge Base</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2012-2016, Zeyuan Hu.
      Last updated on Mar 11, 2016.
    </div>
  </body>
</html>