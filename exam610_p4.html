<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Exam 610 Part 4: Working with DB2 Data using SQL &mdash; HZY</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.4/readable/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="HZY" href="index.html" />
    <link rel="up" title="Knowledge Base" href="kb.html" />
    <link rel="prev" title="Knowledge Base" href="kb.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">
  
  <a href="https://github.com/xxks-kkk/xxks-kkk.github.io.source"
     class="visible-desktop hidden-xs"><img
     id="gh-banner"
     style="position: absolute; top: 50px; right: 0; border: 0;"
     src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
     alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
 </script>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Zeyuan&#39;s World</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="kb.html">Examples</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="blog.html">Random Articles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release.html">Elvënsense 96 is released</a></li>
<li class="toctree-l2"><a class="reference internal" href="welcome.html">Welcome!!!</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="kb.html">Knowledge Base</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Exam 610 Part 4: Working with DB2 Data using SQL</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">TOC <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Exam 610 Part 4: Working with DB2 Data using SQL</a><ul>
<li><a class="reference internal" href="#db2-syntax-diagram-conventions">DB2 Syntax Diagram Conventions</a></li>
<li><a class="reference internal" href="#relational-algebra">Relational Algebra</a></li>
<li><a class="reference internal" href="#objectives">Objectives</a></li>
<li><a class="reference internal" href="#structured-query-language">Structured Query Language</a></li>
<li><a class="reference internal" href="#sql-data-manipulation-language-dml-statements">SQL Data Manipulation Language (DML) Statements</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#the-insert-statement">The INSERT Statement</a><ul>
<li><a class="reference internal" href="#syntax">syntax</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-update-statement">The UPDATE Statement</a><ul>
<li><a class="reference internal" href="#id1">syntax</a></li>
<li><a class="reference internal" href="#id2">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-delete-statement">The DELETE Statement</a><ul>
<li><a class="reference internal" href="#id3">syntax</a></li>
<li><a class="reference internal" href="#id4">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-truncate-statement">The TRUNCATE statement</a><ul>
<li><a class="reference internal" href="#id5">syntax</a></li>
<li><a class="reference internal" href="#id6">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-sql-procedures">Working with SQL procedures</a></li>
<li><a class="reference internal" href="#working-with-user-defined-functions">Working with user-defined functions</a></li>
<li><a class="reference internal" href="#working-with-temporal-tables">Working with temporal tables</a><ul>
<li><a class="reference internal" href="#system-period-temporal-tables">System-period temporal tables</a></li>
<li><a class="reference internal" href="#application-period-temporal-tables">Application-period temporal tables</a></li>
<li><a class="reference internal" href="#bitemporal-tables">Bitemporal tables</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#references">References</a></li>
<li><a class="reference internal" href="#comments">Comments</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="kb.html" title="Previous Chapter: Knowledge Base"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Knowledge Base</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="exam-610-part-4-working-with-db2-data-using-sql">
<span id="exam610-p4-rst"></span><h1>Exam 610 Part 4: Working with DB2 Data using SQL<a class="headerlink" href="#exam-610-part-4-working-with-db2-data-using-sql" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following content is all about SQL</p>
</div>
<div class="section" id="db2-syntax-diagram-conventions">
<h2>DB2 Syntax Diagram Conventions<a class="headerlink" href="#db2-syntax-diagram-conventions" title="Permalink to this headline">¶</a></h2>
<p>Diagram captured from <em>Understanding DB2: Learning Visually with Examples (2nd Edition)</em>, page 27</p>
</div>
<div class="section" id="relational-algebra">
<h2>Relational Algebra<a class="headerlink" href="#relational-algebra" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Content adapted from <em>Database Management Systems (3rd edition)</em></p>
</div>
<ul class="simple">
<li>Creating example tables</li>
</ul>
<p>20% of the <em>DB2 10.1 Fundamentals</em></p>
</div>
<div class="section" id="objectives">
<h2>Objectives<a class="headerlink" href="#objectives" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Ability to perform <code class="docutils literal"><span class="pre">INSERT</span></code>, <code class="docutils literal"><span class="pre">UPDATE</span></code>, and <code class="docutils literal"><span class="pre">DELETE</span></code> operations against a database</li>
<li>Ability to retrieve and format data using various forms of the <code class="docutils literal"><span class="pre">SELECT</span></code> statement</li>
<li>Ability to sort and group data retrieved by a <code class="docutils literal"><span class="pre">SELECT</span></code> statement</li>
<li>Ability to query system-period, application-period, and bitemporal temporal (time travel) tables</li>
<li>Ability to access Extensible Markup Language (XML) data using XQuery expressions and the built-in SQL/XML functions that are available with DB2</li>
<li>Ability to create and invoke an SQL stored procedure or and SQL user-defined function (UDF)</li>
<li>Knowledge of what transactions are, as well as how transactions are initiated and terminated</li>
</ul>
</div>
<div class="section" id="structured-query-language">
<h2>Structured Query Language<a class="headerlink" href="#structured-query-language" title="Permalink to this headline">¶</a></h2>
<p>SQL statements can be categorized according to the function they have been designed to perform. Consequently, SQL statements typically fall under
one of the following categories:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>Embedded SQL Application Construct statements:</strong></p>
<blockquote>
<div><p>Used for the sole purpose of constructing Embedded SQL applications</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Data Control Language (DCL) statements:</strong></p>
<blockquote>
<div><p>Used to grant and revoke authorities and privileges</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Data Definition Language (DDL) statements:</strong></p>
<blockquote>
<div><p>Used to create, alter, and delete database objects</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Data Manipulation Language (DML) statements:</strong></p>
<blockquote>
<div><p>Used to store data in, manipulate data in, retrieve data from, and remove data from select database objects</p>
</div></blockquote>
</li>
<li><p class="first"><strong>Transaction Management statements:</strong></p>
<blockquote>
<div><p>Used to establish and terminate database connections and transactions</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Embedded SQL Application Construct statements</strong> is not required for exam 610.</p>
</div>
</div>
<div class="section" id="sql-data-manipulation-language-dml-statements">
<h2>SQL Data Manipulation Language (DML) Statements<a class="headerlink" href="#sql-data-manipulation-language-dml-statements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>DML statements are used exclusively to store, modify, and delete data, as well as to retrieve data from tables, views, or both.</p>
<p>Four DML statements are avialable:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">INSERT</span></code></li>
<li><code class="docutils literal"><span class="pre">UPDATE</span></code></li>
<li><code class="docutils literal"><span class="pre">DELETE</span></code></li>
<li><code class="docutils literal"><span class="pre">SELECT</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="the-insert-statement">
<h3>The INSERT Statement<a class="headerlink" href="#the-insert-statement" title="Permalink to this headline">¶</a></h3>
<p>Adding data to tables, nicknames, or views</p>
<div class="section" id="syntax">
<h4>syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="o">&lt;</span><span class="p">([</span><span class="n">ColumnName</span><span class="p">],</span> <span class="p">...)</span><span class="o">&gt;</span>
        <span class="k">VALUES</span> <span class="p">([</span><span class="n">value</span> <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="p">],</span> <span class="p">...)</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="o">&lt;</span><span class="p">([</span><span class="n">ColumnName</span><span class="p">],</span> <span class="p">...)</span><span class="o">&gt;</span>
        <span class="p">[</span><span class="n">SELECTStatement</span><span class="p">]</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p id="department-table">DEPARTMENT table</p>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column Name</th>
<th class="head">Data Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>DEPTNO</td>
<td>CHAR(3)</td>
</tr>
<tr class="row-odd"><td>DEPTNAME</td>
<td>CHAR(20)</td>
</tr>
<tr class="row-even"><td>MGRID</td>
<td>INTEGER</td>
</tr>
</tbody>
</table>
<p><em>Data Stored in the DEPARTMENT table</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="50%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">DEPTNO</th>
<th class="head">DEPTNAME</th>
<th class="head">MGRID</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>A01</td>
<td>ADMINISTRATION</td>
<td>1000</td>
</tr>
<tr class="row-odd"><td>B01</td>
<td>PLANNING</td>
<td>1001</td>
</tr>
<tr class="row-even"><td>C01</td>
<td>DEVELOPMENT</td>
<td>1007</td>
</tr>
<tr class="row-odd"><td>D01</td>
<td>PERSONNEL</td>
<td>1008</td>
</tr>
<tr class="row-even"><td>E01</td>
<td>OPERATIONS</td>
<td>(NULL)</td>
</tr>
<tr class="row-odd"><td>F01</td>
<td>SUPPORT</td>
<td>(NULL)</td>
</tr>
</tbody>
</table>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">department</span>
        <span class="p">(</span><span class="n">deptno</span><span class="p">,</span> <span class="n">deptname</span><span class="p">,</span> <span class="n">mgrid</span><span class="p">)</span>
        <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;A01&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMINISTRATION&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<blockquote class="highlights">
<div><ul class="simple">
<li>number of values provided in the VALUES clause must equal the number of column names identified in the column name list</li>
<li>the values provided will be assined to the specified columns in the order in which they appear</li>
<li>value supplied must be compatible with the data type of the column it is being assigned to</li>
</ul>
</div></blockquote>
<p>If values are provided (using the VALUES clause) for every column found in the table, the column name list can be omitted.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">department</span>
        <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;A01&#39;</span><span class="p">,</span> <span class="s1">&#39;ADMINISTRATION&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>The INSERT statement with SELECT statement performs a type of cut-and-paste operation in which values are retrieved from one base table or
view and copied to another.</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">department</span> <span class="p">(</span><span class="n">deptno</span><span class="p">,</span> <span class="n">deptname</span><span class="p">)</span>
        <span class="k">SELECT</span> <span class="n">deptno</span><span class="p">,</span> <span class="n">deptname</span> <span class="k">FROM</span> <span class="n">organization</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For such an INSERT statement to execute correctly, all columns in the table the record is being inserted into that <em>do not</em> appear
in the column name list must either accept NULL values or have a defaults constraint associated with them. Otherwise, the INSERT statement
will fail and an error will be generated.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="the-update-statement">
<h3>The UPDATE Statement<a class="headerlink" href="#the-update-statement" title="Permalink to this headline">¶</a></h3>
<p>Updating column values in a table or view. In other words, once a table has been created and populated, you can modify any of the data values stored
in it by executing an UPDATE statement.</p>
<div class="section" id="id1">
<h4>syntax<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="k">SET</span> <span class="p">[</span><span class="n">ColumnName</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Value</span> <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="p">],</span> <span class="p">...]</span>
        <span class="o">&lt;</span><span class="k">WHERE</span> <span class="p">[</span><span class="n">Condition</span><span class="p">]</span> <span class="o">|</span> <span class="k">WHERE</span> <span class="k">CURRENT</span> <span class="k">OF</span> <span class="p">[</span><span class="n">CursorName</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="k">SET</span> <span class="p">([</span><span class="n">ColumnName</span><span class="p">],</span> <span class="p">...)</span> <span class="o">=</span> <span class="p">([</span><span class="n">Value</span> <span class="o">|</span> <span class="k">NULL</span> <span class="o">|</span> <span class="k">DEFAULT</span><span class="p">],</span> <span class="p">...)</span>
        <span class="o">&lt;</span><span class="k">WHERE</span> <span class="p">[</span><span class="n">Condition</span><span class="p">]</span> <span class="o">|</span> <span class="k">WHERE</span> <span class="k">CURRENT</span> <span class="k">OF</span> <span class="p">[</span><span class="n">CursorName</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="k">SET</span> <span class="p">([</span><span class="n">ColumnName</span><span class="p">],</span> <span class="p">...)</span> <span class="o">=</span> <span class="p">([</span><span class="n">SELECTStatement</span><span class="p">])</span>
        <span class="o">&lt;</span><span class="k">WHERE</span> <span class="p">[</span><span class="n">Condition</span><span class="p">]</span> <span class="o">|</span> <span class="k">WHERE</span> <span class="k">CURRENT</span> <span class="k">OF</span> <span class="p">[</span><span class="n">CursorName</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<blockquote id="employee-table">
<div><p>EMPLOYEE table</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column Name</th>
<th class="head">Data Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>EMPNO</td>
<td>INTEGER</td>
</tr>
<tr class="row-odd"><td>FNAME</td>
<td>CHAR(10)</td>
</tr>
<tr class="row-even"><td>LNAME</td>
<td>CHAR(10)</td>
</tr>
<tr class="row-odd"><td>SEX</td>
<td>CHAR(1)</td>
</tr>
<tr class="row-even"><td>HIREDATE</td>
<td>DATE</td>
</tr>
<tr class="row-odd"><td>TITLE</td>
<td>CHAR(25)</td>
</tr>
<tr class="row-even"><td>DEPT</td>
<td>CHAR(3)</td>
</tr>
<tr class="row-odd"><td>SALARY</td>
<td>DECIMAL(8,2)</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Salary of every employee who has the title of DATABASE ADMINISTRATOR is increased by 10 percent</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">employee</span> <span class="k">SET</span> <span class="n">salary</span> <span class="o">=</span> <span class="n">salary</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">10</span>
        <span class="k">WHERE</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;DATABASE ADMINISTRATOR&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Delete the values assigned to the DEPT column of every record found in the EMPLOYEE table</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">employee</span> <span class="k">SET</span> <span class="n">dept</span> <span class="o">=</span> <span class="k">NULL</span>
</pre></div>
</div>
<ul class="simple">
<li>Change the value assigned to the DEPT column of each record found in the EMPLOYEE table</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">UPDATE</span> <span class="n">employee</span> <span class="k">SET</span> <span class="p">(</span><span class="n">dept</span><span class="p">)</span> <span class="o">=</span>
        <span class="p">(</span><span class="k">SELECT</span> <span class="n">deptno</span>
           <span class="k">FROM</span> <span class="n">department</span>
           <span class="k">WHERE</span> <span class="n">deptname</span> <span class="o">=</span> <span class="s1">&#39;ADMINISTRATOR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="the-delete-statement">
<h3>The DELETE Statement<a class="headerlink" href="#the-delete-statement" title="Permalink to this headline">¶</a></h3>
<p>To remove one or more rows of data from a table or updatable view</p>
<div class="section" id="id3">
<h4>syntax<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="o">&lt;</span><span class="k">WHERE</span> <span class="p">[</span><span class="n">Condition</span><span class="p">]</span> <span class="o">|</span> <span class="k">WHERE</span> <span class="k">CURRENT</span> <span class="k">OF</span> <span class="p">[</span><span class="n">CursorName</span><span class="p">]</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">TableName</span> <span class="o">|</span> <span class="n">ViewName</span><span class="p">]</span>
        <span class="o">&lt;</span><span class="k">WHERE</span> <span class="p">([</span><span class="n">ColumnName</span><span class="p">],</span> <span class="p">...)</span> <span class="k">IN</span> <span class="p">([</span><span class="n">SELECTStatement</span><span class="p">])</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Example<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p id="sales-table">SALES table</p>
<table border="1" class="docutils">
<colgroup>
<col width="61%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column Name</th>
<th class="head">Data Type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ORDERNO</td>
<td>CHAR(10)</td>
</tr>
<tr class="row-odd"><td>COMPANY</td>
<td>CHAR(20)</td>
</tr>
<tr class="row-even"><td>PURCHASEDATE</td>
<td>DATE</td>
</tr>
<tr class="row-odd"><td>SALESPERSON</td>
<td>INTEGER</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Remove every record for company ACME,INC from SALES table</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">sales</span>
        <span class="k">WHERE</span> <span class="n">company</span> <span class="o">=</span> <span class="s1">&#39;ACME, INC.&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Remove every record from SALES table for which no salesperson has been assigned</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">sales</span>
        <span class="k">WHERE</span> <span class="n">salesperson</span> <span class="k">IS</span> <span class="k">NULL</span>
</pre></div>
</div>
<ul class="simple">
<li>Delete every record whose company starts with &#8216;J&#8217;</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">sales</span> <span class="k">WHERE</span> <span class="n">company</span> <span class="k">LIKE</span> <span class="s1">&#39;J%&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Delete employees from EMPLOYEE table who happen to be make sales in 1971</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">employee</span> <span class="k">WHERE</span> <span class="n">empno</span>
        <span class="k">IN</span> <span class="p">(</span><span class="k">SELECT</span> <span class="n">salesperson</span> <span class="k">FROM</span> <span class="n">sales</span> <span class="k">WHERE</span> <span class="k">YEAR</span><span class="p">(</span><span class="n">purchasedate</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1971</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Remove all rows in SALES table</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">sales</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="the-truncate-statement">
<h3>The TRUNCATE statement<a class="headerlink" href="#the-truncate-statement" title="Permalink to this headline">¶</a></h3>
<p>A better alternative to using the DELETE statement to empty a table of its contents
is to use the TRUNCATE statement instead.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Why TRUNCATE?</p>
<ul class="last simple">
<li>TRUNCATE operations do not generate transaction log records.</li>
<li>Give more control over any DELETE triggers that may have been defined.</li>
</ul>
</div>
<div class="section" id="id5">
<h4>syntax<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">TRUNCATE</span> <span class="o">&lt;</span><span class="k">TABLE</span><span class="o">&gt;</span> <span class="p">[</span><span class="n">TableName</span><span class="p">]</span>
        <span class="o">&lt;</span><span class="p">[</span><span class="k">DROP</span> <span class="o">|</span> <span class="n">REUSE</span><span class="p">]</span> <span class="k">STORAGE</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="k">IGNORE</span> <span class="k">DELETE</span> <span class="n">TRIGGERS</span> <span class="o">|</span> <span class="k">RESTRICT</span> <span class="k">WHEN</span> <span class="k">DELETE</span> <span class="n">TRIGGERS</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If <code class="docutils literal"><span class="pre">DROP</span> <span class="pre">STORAGE</span></code> clause is specified with the truncate statement used,
storage space that has been allocated for the table will be released and
make available to the operating system.</li>
<li>If <code class="docutils literal"><span class="pre">REUSE</span> <span class="pre">STORAGE</span></code> clause is used instead, storage space for the table is
merely emptied, and the space remains available for the table&#8217;s future needs.</li>
<li>If <code class="docutils literal"><span class="pre">IGNORE</span> <span class="pre">DELETE</span> <span class="pre">TRIGGERS</span></code> clause is specified, DELETE triggers defined on
the table will not fire as the data in the table is being deleted.</li>
<li>If <code class="docutils literal"><span class="pre">RESTRICT</span> <span class="pre">WHEN</span> <span class="pre">DELETE</span> <span class="pre">TRIGGERS</span></code> clause is used, the system catalog will be
examined to determine whether DELETE triggers on the table have been created.
And if one or more triggers are found, the truncate operation will end and an
error will be returned. (In this case, the table&#8217;s storage remains intact and its
records are left untouched.)</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h4>Example<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><ul class="simple">
<li>Remove every record from SALES table without firing any DELETE triggers</li>
</ul>
<div class="highlight-sql"><div class="highlight"><pre><span class="k">TRUNCATE</span> <span class="k">FROM</span> <span class="n">sales</span>
        <span class="k">IGNORE</span> <span class="k">DELETE</span> <span class="n">TRIGGERS</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="working-with-sql-procedures">
<h3>Working with SQL procedures<a class="headerlink" href="#working-with-sql-procedures" title="Permalink to this headline">¶</a></h3>
<p><strong>Example 1</strong>:</p>
<ul class="simple">
<li>Creating the check_comm procedure</li>
</ul>
<p>Create a SQL procedure to report the name of staff members, their departments, and their salaries for
employees who received more than a given commission: (save as check_comm.clp)</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE OR REPLACE PROCEDURE check_comm (IN v_comm SMALLINT, OUT v_sqlstatus CHAR(5))
SPECIFIC check_comm
DYNAMIC RESULT SETS 1
LANGUAGE SQL
BEGIN
        DECLARE SQLSTATE CHAR(5);
        DECLARE chn_cur CURSOR WITH RETURN FOR
        SELECT name, dept, job, salary FROM staff WHERE comm &gt; v_comm;
        OPEN chn_cur;
        SET v_sqlstatus = SQLSTATE;
END@
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Syntax explanation</p>
<ul class="simple">
<li>the <code class="docutils literal"><span class="pre">SPECIFIC</span></code> clause provides a unique name to identify the SQL procedure.</li>
<li>the <code class="docutils literal"><span class="pre">DYNAMIC</span> <span class="pre">RESULT</span> <span class="pre">SETS</span></code> clause indicates <code class="docutils literal"><span class="pre">1</span></code> as the maximum number of result sets.</li>
<li>the <code class="docutils literal"><span class="pre">LANGUAGE</span> <span class="pre">SQL</span></code> clause indicates that this is an SQL stored procedure.</li>
<li>the SQL procedure body is enclosed by the <code class="docutils literal"><span class="pre">BEGIN</span></code> and <code class="docutils literal"><span class="pre">END</span></code> keywords. It contains a declaration of a
variable and a cursor, setting of the output parameter, and returning a result set by opening the cursor.</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>result set associated with cursor <code class="docutils literal"><span class="pre">chn_cur</span></code> once we <code class="docutils literal"><span class="pre">OPEN</span> <span class="pre">chn_cur</span></code></li>
<li>the <code class="docutils literal"><span class="pre">v_comm</span></code> input parameter indicates the comission value. The <code class="docutils literal"><span class="pre">v_sqlstatus</span></code> output parameter
returns the status for the last SQL statement. If the execution of the SQL procedure is successful,
the value of <code class="docutils literal"><span class="pre">v_sqlstatus</span></code> is 0. Otherwise, it sets to the standardized error code.</li>
<li>if you have mutliple inputs, then specify like: <code class="docutils literal"><span class="pre">IN</span> <span class="pre">a</span> <span class="pre">SMALLINT,</span> <span class="pre">IN</span> <span class="pre">c</span> <span class="pre">char(5),</span> <span class="pre">...</span></code></li>
</ul>
</div>
<ul class="simple">
<li>Register the SQL procedure to database server:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 -td@ -vf check_comm.clp
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">-td</span></code> parameter specifies the &#64; character as the end of statement character. Avoid using the ;
character because it is used as the end of statements in the procedure body.</li>
<li><code class="docutils literal"><span class="pre">-v</span></code> parameter displays the current command in the standard output</li>
<li><code class="docutils literal"><span class="pre">-f</span></code> parameter indicates the input command file</li>
</ul>
</div>
<ul class="simple">
<li>Calling SQL procedure:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 &quot;CALL check_comm(1000,?)&quot;
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">?</span></code> is the place holder for the <code class="docutils literal"><span class="pre">v_sqlstatus</span></code> output parameter that returns the latest <code class="docutils literal"><span class="pre">SQLSTATE</span></code> value.</li>
</ul>
</div>
<p>The return result shows the name and value of the output parameter and the result set from the open cursor with
a list of staff members that have a commission greater than $1000.00.</p>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 &quot;CALL CHECK_COMM(1000,?)&quot;

Value of output parameters
--------------------------
Parameter Name  : V_SQLSTATUS
Parameter Value : 00000


Result set 1
--------------

NAME      DEPT   JOB   SALARY
--------- ------ ----- ---------
Rothman       15 Sales  76502.83
Koonitz       42 Sales  38001.75
Edwards       84 Sales  67844.00

3 record(s) selected.

Return Status = 0
</pre></div>
</div>
<p><strong>Example 2:</strong></p>
<ul class="simple">
<li>Creating <code class="docutils literal"><span class="pre">FIND_SALARY</span></code> procedure:</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>CREATE OR REPLACE PROCEDURE FIND_SALARY
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
        DECLARE EOF INT DEFAULT 0;
        DECLARE STMT VARCHAR(200);
        DECLARE R_EMPNO CHAR(6);
        DECLARE R_SALARY DEC(9,2);
        DECLARE C1 CURSOR WITH RETURN FOR
                SELECT EMPNO, SALARY FROM EMPLOYEE
                WHERE SALARY &lt;= 50000;

        DECLARE CONTINUE HANDLER FOR NOT FOUND
                SET EOF=1;

        SET STMT = &#39;INSERT INTO T_RESULTS VALUES (?,?)&#39;;
        PREPARE S1 FROM STMT;
        OPEN C1;
        WHILE EOF = 0 DO
                FETCH FROM C1 INTO R_EMPNO, R_SALARY;
                EXECUTE S1 USING R_EMPNO, R_SALARY;
        END WHILE;
        CLOSE C1;
END@
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Synatx Explanation</p>
<ul class="simple">
<li>a <code class="docutils literal"><span class="pre">CONTINUE</span></code> handler will continue execution at the statement following the one that raised the exception</li>
<li>handler here used to return a value for EOF to indicate that the end of records has been reached.</li>
<li><code class="docutils literal"><span class="pre">PREPARE</span></code> statement is used by application programs to dynamically prepare an SQL statement</li>
</ul>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li>Exception handling <a class="reference external" href="ftp://ftp.software.ibm.com/software/dw/dm/db2/sqlplbook/ch05.pdf">ftp://ftp.software.ibm.com/software/dw/dm/db2/sqlplbook/ch05.pdf</a></li>
</ul>
</div>
<ul class="simple">
<li>Register the procedure to database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 -td@ -vf find_salary.clp
CREATE OR REPLACE PROCEDURE FIND_SALARY
LANGUAGE SQL
DYNAMIC RESULT SETS 1
BEGIN
        DECLARE EOF INT DEFAULT 0;
        DECLARE STMT VARCHAR(200);
        DECLARE R_EMPNO CHAR(6);
        DECLARE R_SALARY DEC(9,2);
        DECLARE C1 CURSOR WITH RETURN FOR
                SELECT EMPNO, SALARY FROM EMPLOYEE
                WHERE SALARY &lt;= 50000;

        DECLARE CONTINUE HANDLER FOR NOT FOUND
                SET EOF=1;

        SET STMT = &#39;INSERT INTO T_RESULTS VALUES (?,?)&#39;;
        PREPARE S1 FROM STMT;
        OPEN C1;
        WHILE EOF = 0 DO
                FETCH FROM C1 INTO R_EMPNO, R_SALARY;
                EXECUTE S1 USING R_EMPNO, R_SALARY;
        END WHILE;
        CLOSE C1;
END
DB20000I  The SQL command completed successfully.
</pre></div>
</div>
<ul class="simple">
<li>Calling the procedure</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 &quot;call FIND_SALARY&quot;

Return Status = 0
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>before executing procedure, need to create T_RESULTS table first</p>
<div class="last highlight-python"><div class="highlight"><pre>create table db2admin.t_results (employno char(6), salary dec(9,2))
</pre></div>
</div>
</div>
<ul class="simple">
<li>Check result</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 &quot;select * from T_RESULTS fetch first 5 rows only&quot;

EMPLOYNO SALARY
-------- -----------
000120      49250.00
000170      44680.00
000220      49840.00
000230      42180.00
000240      48760.00

5 record(s) selected.
</pre></div>
</div>
</div>
<div class="section" id="working-with-user-defined-functions">
<h3>Working with user-defined functions<a class="headerlink" href="#working-with-user-defined-functions" title="Permalink to this headline">¶</a></h3>
<p><strong>Example 1: scalar UDF function</strong></p>
<ul class="simple">
<li>Create a scalar function that calculates the tangent for a given argument</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>CREATE OR REPLACE FUNCTION TAN (X DOUBLE)
RETURNS DOUBLE
LANGUAGE SQL
CONTAINS SQL
NO EXTERNAL ACTION
DETERMINISTIC
RETURN SIN(X)/COS(X);
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>You can either run it as db2 commands or save it to a clp file</li>
<li><code class="docutils literal"><span class="pre">NO</span> <span class="pre">EXTERNAL</span> <span class="pre">ACTION</span></code> clause specifies that the function does not perform an action that
changes the state of an object that the database manager does not manage.</li>
<li><code class="docutils literal"><span class="pre">DETERMINISTIC</span></code> clause indicates to the database manager to always return the same results for given
argument values.</li>
</ul>
</div>
<ul class="simple">
<li>(Optional) Register it to database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 -tvf tan.clp
CREATE OR REPLACE FUNCTION TAN (X DOUBLE)
RETURNS DOUBLE
LANGUAGE SQL
CONTAINS SQL
NO EXTERNAL ACTION
DETERMINISTIC
RETURN SIN(X)/COS(X)
DB20000I  The SQL command completed successfully.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>If you run previous step as db2 command, then this step is no needed.</li>
</ul>
</div>
<ul class="simple">
<li>Calling user-defined functions</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 &quot;select tan(10) from sysibm.sysdummy1&quot;

 1
 ------------------------
 +6.48360827459087E-001

 1 record(s) selected.
</pre></div>
</div>
<p><strong>Example 2: UDF table function</strong></p>
<ul class="simple">
<li>Creating a UDF table function</li>
</ul>
<p>You can use a table function to return EMPNO, LASTNAME, FIRSTNAME, and DEPARTMENT_NAME for all the employees of a
given department number.</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE OR REPLACE FUNCTION employee_same_dept_name (deptno CHAR(3))
RETURNS TABLE (empno     CHAR(6),
               lastname  VARCHAR(15),
               firstname VARCHAR(12),
               department_name VARCHAR(30))
LANGUAGE SQL
READS SQL DATA
NO EXTERNAL ACTION
DETERMINISTIC
RETURN
        SELECT empno, lastname, firstnme, deptname
                FROM employee, department
                WHERE employee.workdept = employee_same_dept_name.deptno
                        AND employee.workdept = department.deptno;
</pre></div>
</div>
<ul class="simple">
<li>(Optional) Register it with database</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 -tvf employee.clp
CREATE OR REPLACE FUNCTION employee_same_dept_name (deptno CHAR(3))
        RETURNS TABLE (empno     CHAR(6),
                       lastname  VARCHAR(15),
                       firstname VARCHAR(12),
                       department_name VARCHAR(30))
LANGUAGE SQL
READS SQL DATA
NO EXTERNAL ACTION
DETERMINISTIC
RETURN
        SELECT empno, lastname, firstnme, deptname
                FROM employee, department
                WHERE employee.workdept = employee_same_dept_name.deptno
                        AND employee.workdept = department.deptno
DB20000I  The SQL command completed successfully.
</pre></div>
</div>
<ul class="simple">
<li>Execute it</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 &quot;select * from table(employee_same_dept_name(&#39;A00&#39;)) AS emp_same_dpt&quot;

 EMPNO  LASTNAME        FIRSTNAME    DEPARTMENT_NAME
 ------ --------------- ------------ ------------------------------
 000010 HAAS            CHRISTINE    SPIFFY COMPUTER SERVICE DIV.
 000110 LUCCHESSI       VINCENZO     SPIFFY COMPUTER SERVICE DIV.
 000120 O&#39;CONNELL       SEAN         SPIFFY COMPUTER SERVICE DIV.
 200010 HEMMINGER       DIAN         SPIFFY COMPUTER SERVICE DIV.
 200120 ORLANDO         GREG         SPIFFY COMPUTER SERVICE DIV.

 5 record(s) selected.
</pre></div>
</div>
</div>
<div class="section" id="working-with-temporal-tables">
<h3>Working with temporal tables<a class="headerlink" href="#working-with-temporal-tables" title="Permalink to this headline">¶</a></h3>
<div class="section" id="system-period-temporal-tables">
<h4>System-period temporal tables<a class="headerlink" href="#system-period-temporal-tables" title="Permalink to this headline">¶</a></h4>
<p><code class="xref download docutils literal"><span class="pre">system-period</span> <span class="pre">temporal</span> <span class="pre">table</span> <span class="pre">sql</span></code></p>
<ul class="simple">
<li>Creating system-period temporal table</li>
</ul>
<p>To create a product table for a retail store as a system-period temporal table</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE product_info
( sku_no      VARCHAR(15) NOT NULL,
  store_id    VARCHAR(19) NOT NULL,
  amt         INT NOT NULL,
  sys_start   TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW BEGIN,
  sys_end     TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS ROW END,
  ts_id       TIMESTAMP(12) NOT NULL GENERATED ALWAYS AS TRANSACTION START ID,
  PERIOD SYSTEM_TIME (sys_start, sys_end)
);
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">sku_no</span></code> column stores the product unique number for a particular store and <code class="docutils literal"><span class="pre">amt</span></code> is its cost. The
<code class="docutils literal"><span class="pre">sys_start</span></code> and <code class="docutils literal"><span class="pre">sys_end</span></code> columns indicate when the product information in each row becomes active or inactive.
The <code class="docutils literal"><span class="pre">ts_id</span></code> column indicates the start time of a transaction that affects the row.</p>
<ul class="simple">
<li>Create associated history table</li>
</ul>
<p><strong>Method 1:</strong></p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE hist_product_info
( sku_no       VARCHAR(15) NOT NULL,
  store_id     VARCHAR(19) NOT NULL,
  amt          INT NOT NULL,
  sys_start    TIMESTAMP(12) NOT NULL,
  sys_end      TIMESTAMP(12) NOT NULL,
  ts_id        TIMESTAMP(12) NOT NULL
);
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>the history table should have the same columns as the system-period temporal table.</li>
<li>the columns to indicate the period and the transaction_id should not have the <code class="docutils literal"><span class="pre">GENERATED</span> <span class="pre">ALWAYS</span></code> clause
in the create statement.</li>
</ul>
</div>
<p><strong>Method 2 (prefer):</strong></p>
<p>You can also create the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table by using the CREATE TABLE statement with the LIKE clause.</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE hist_product_info LIKE product_info;
</pre></div>
</div>
<ul class="simple">
<li>Linking system-period temporal table with its associated history table</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>ALTER TABLE product_info ADD VERSIONING USE HISTORY TABLE hist_product_info;
</pre></div>
</div>
<ul class="simple">
<li>Inserting data into system-period temporal tables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>INSERT INTO product_info (sku_no, store_id, amt) VALUES (&#39;CHR_00001&#39;, &#39;NJ001&#39;, 5.99);
INSERT INTO product_info (sku_no, store_id, amt) VALUES (&#39;CHR_00002&#39;, &#39;NJ011&#39;, 7.99);
INSERT INTO product_info (sku_no, store_id, amt) VALUES (&#39;CHR_00002&#39;, &#39;NJ019&#39;, 9.99);
INSERT INTO product_info (sku_no, store_id, amt) VALUES (&#39;CHR_00005&#39;, &#39;NJ019&#39;, 8.99);


C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM product_info

SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
--------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
CHR_00001       NJ001                         5 2016-01-19-23.21.20.926357000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.20.926357000000
CHR_00002       NJ011                         7 2016-01-19-23.21.35.013245000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.35.013245000000
CHR_00002       NJ019                         9 2016-01-19-23.21.48.624776000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.48.624776000000
CHR_00005       NJ019                         8 2016-01-19-23.22.00.278829000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.22.00.278829000000

4 record(s) selected.


C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM hist_product_info

SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
--------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------

0 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Data is added to the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table only when you <em>delete</em> or <em>update</em> data into system-period
temporal tables.</p>
</div>
<ul class="simple">
<li>Updating data into system-period temporal tables</li>
</ul>
<p>Increase the price of the product with <code class="docutils literal"><span class="pre">sku_no</span> <span class="pre">=</span> <span class="pre">'CHR_00001</span></code> from 5.99 to 6.99</p>
<div class="highlight-python"><div class="highlight"><pre>UPDATE product_info SET amt = 6.99 WHERE sku_no = &#39;CHR_00001&#39;;

C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM hist_product_info

SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
--------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
CHR_00001       NJ001                         5 2016-01-19-23.21.20.926357000000 2016-01-19-23.24.04.788596000000 2016-01-19-23.21.20.926357000000

1 record(s) selected.


C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM product_info

SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
--------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
CHR_00001       NJ001                         6 2016-01-19-23.24.04.788596000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.24.04.788596000000
CHR_00002       NJ011                         7 2016-01-19-23.21.35.013245000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.35.013245000000
CHR_00002       NJ019                         9 2016-01-19-23.21.48.624776000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.48.624776000000
CHR_00005       NJ019                         8 2016-01-19-23.22.00.278829000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.22.00.278829000000

4 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>When update, data is automatically added to the associated history table</li>
<li>This update in the <code class="docutils literal"><span class="pre">product_info</span></code> table inserts a row in the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table to indicate
the time when the inserted values were active</li>
<li>The sys_start column in the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table has the same value as the sys_start column in the
<code class="docutils literal"><span class="pre">product_info</span></code> after the insert.</li>
<li>The sys_end column of the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table has the same values as the <code class="docutils literal"><span class="pre">sys_start</span></code> column
in the updated row of the <code class="docutils literal"><span class="pre">product_info</span></code> table.</li>
</ul>
</div>
<ul class="simple">
<li>Deleting data from system-period temporal tables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>DELETE FROM product_info WHERE sku_no = &#39;CHR_00005&#39;;

 C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM product_info

 SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
 --------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
 CHR_00001       NJ001                         6 2016-01-19-23.24.04.788596000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.24.04.788596000000
 CHR_00002       NJ011                         7 2016-01-19-23.21.35.013245000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.35.013245000000
 CHR_00002       NJ019                         9 2016-01-19-23.21.48.624776000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.21.48.624776000000

 3 record(s) selected.


 C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM hist_product_info

 SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
 --------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
 CHR_00001       NJ001                         5 2016-01-19-23.21.20.926357000000 2016-01-19-23.24.04.788596000000 2016-01-19-23.21.20.926357000000
 CHR_00005       NJ019                         8 2016-01-19-23.22.00.278829000000 2016-01-19-23.27.37.934517000000 2016-01-19-23.22.00.278829000000

 2 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The DELETE statement leads to insertion of a row in the <code class="docutils literal"><span class="pre">hist_product_info</span></code> table where the sys_start
column has the same value as the sys_start column in the <code class="docutils literal"><span class="pre">product_info</span></code> table and the <code class="docutils literal"><span class="pre">sys_end</span></code>
column has the time of the delete.</p>
</div>
<ul>
<li><p class="first">Querying system-period temporal tables</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">FOR</span> <span class="pre">SYSTEM_TIME</span> <span class="pre">AS</span> <span class="pre">OF</span></code> <em>value1</em> to include all the rows with a time period that
begins before or on <em>value1</em> and ends after <em>value1</em> from both the system-period temporal and history tables:</p>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT sku_no, store_id, amt FROM product_info FOR SYSTEM_TIME AS OF &#39;2015-01-19-11.19.00.000000000000&#39;

SKU_NO          STORE_ID            AMT
--------------- ------------------- -----------

0 record(s) selected.
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">FOR</span> <span class="pre">SYSTEM_TIME</span> <span class="pre">FROM</span></code> <em>value1</em> <code class="docutils literal"><span class="pre">TO</span></code> <em>value2</em> to include all the rows with a time period that begins
before or on <em>value1</em> and ends before <em>value2</em> from both the system-period temporal and history tables:</p>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT sku_no, store_id, amt FROM product_info FOR SYSTEM_TIME FROM &#39;0001-01-01-00.00.00.000000&#39; TO &#39;9999-12-30-00.00.00.000000&#39; WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          STORE_ID            AMT
-------- ------- ------------------- -----------
CHR_00001       NJ001                         5
CHR_00001       NJ001                         6

2 record(s) selected.
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">FOR</span> <span class="pre">SYSTEM_TIME</span> <span class="pre">BETWEEN</span></code> <em>value1</em> <code class="docutils literal"><span class="pre">AND</span></code> <em>value2</em> to include all the rows with a time period that
overlaps any point in time between <em>value1</em> and <em>value2</em> from both the system-period temporal and history
tables</p>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT * FROM product_info FOR SYSTEM_TIME BETWEEN &#39;0001-01-01-00.00.00.000000&#39; AND &#39;9999-12-30-00.00.00.000000&#39; WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          STORE_ID            AMT         SYS_START                        SYS_END                          TS_ID
--------------- ------------------- ----------- -------------------------------- -------------------------------- --------------------------------
CHR_00001       NJ001                         5 2016-01-19-23.21.20.926357000000 2016-01-19-23.24.04.788596000000 2016-01-19-23.21.20.926357000000
CHR_00001       NJ001                         6 2016-01-19-23.24.04.788596000000 9999-12-30-00.00.00.000000000000 2016-01-19-23.24.04.788596000000

2 record(s) selected.
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>If issuing a query without specifying a time period, it returns only rows in the system-period temporal table</p>
<div class="highlight-python"><div class="highlight"><pre>C:\Users\IBM_ADMIN\Documents&gt;db2 SELECT sku_no, store_id, amt FROM product_info WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          STORE_ID            AMT
--------------- ------------------- -----------
CHR_00001       NJ001                         6

1 record(s) selected.
</pre></div>
</div>
</div>
<div class="section" id="application-period-temporal-tables">
<h4>Application-period temporal tables<a class="headerlink" href="#application-period-temporal-tables" title="Permalink to this headline">¶</a></h4>
<p><code class="xref download docutils literal"><span class="pre">application-period</span> <span class="pre">temporal</span> <span class="pre">table</span> <span class="pre">sql</span></code></p>
<ul class="simple">
<li>Creating application-period temporal tables</li>
</ul>
<p><strong>Method 1:</strong>
create a product table for a retail store as an application-period temporarl table:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE TABLE product_info
( sku_no                VARCHAR(15) NOT NULL,
  store_id              VARCHAR(19) NOT NULL,
  amt                   DECIMAL(10,2) NOT NULL,
  bus_start             DATE NOT NULL,
  bus_end               DATE NOT NULL,
  PERIOD BUSINESS_TIME  (bus_start, bus_end)
);
</pre></div>
</div>
<p>To prevent overlapping business_time periods, create a unique index:</p>
<div class="highlight-python"><div class="highlight"><pre>CREATE UNIQUE INDEX ix_product_info ON product_info (sku_no, store_id, BUSINESS_TIME WITHOUT OVERLAPS);
</pre></div>
</div>
<p><strong>Method 2:</strong></p>
<p>Alter existing table:</p>
<div class="highlight-python"><div class="highlight"><pre>ALTER TABLE product_info ADD COLUMN bus_start DATE NOT NULL;
ALTER TABLE product_info ADD COLUMN bus_end DATE NOT NULL;
ALTER TABLE product_info ADD COLUMN PERIOD BUSINESS_TIME(bus_start, bus_end);
ALTER TABLE product_info ADD CONSTRAINT u-index UNIQUE (sku_no, store_id, BUSINESS_TIME WITHOUT OVERLAPS);
</pre></div>
</div>
<ul class="simple">
<li>Inserting data into application-period temporal tables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>INSERT INTO product_info VALUES(&#39;CHR_00001&#39;, &#39;NJ01&#39;, 9.99, &#39;2013-01-01&#39;, &#39;2013-07-01&#39;);
INSERT INTO product_info VALUES(&#39;CHR_00001&#39;, &#39;NJ01&#39;, 10.99, &#39;2013-07-01&#39;, &#39;2014-01-01&#39;);
INSERT INTO product_info VALUES(&#39;CHR_00001&#39;, &#39;NJ01&#39;, 11.99, &#39;2013-06-01&#39;, &#39;2013-08-01&#39;);
INSERT INTO product_info VALUES(&#39;CHR_00005&#39;, &#39;NJ01&#39;, 8.99, &#39;2013-01-01&#39;, &#39;2014-01-01&#39;);
INSERT INTO product_info VALUES(&#39;CHR_00007&#39;, &#39;NJ01&#39;, 25.99, &#39;2013-01-01&#39;, &#39;2014-01-01&#39;);
SELECT * FROM product_info;

db2 =&gt; SELECT * FROM product_info

SKU_NO          STORE_ID            AMT          BUS_START  BUS_END
--------------- ------------------- ------------ ---------- ----------
CHR_00001       NJ01                        9.99 01/01/2013 07/01/2013
CHR_00001       NJ01                       10.99 07/01/2013 01/01/2014
CHR_00005       NJ01                        8.99 01/01/2013 01/01/2014
CHR_00007       NJ01                       25.99 01/01/2013 01/01/2014

4 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The 3rd INSERT statement for &#8220;CHR_00001&#8221; fails because it indicates a period that overlaps with the
specified period in the 2nd INSERT statement.</p>
</div>
<ul class="simple">
<li>Updating application-period temporal tables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 =&gt; UPDATE product_info FOR PORTION OF BUSINESS_TIME FROM &#39;2013-06-01&#39; TO &#39;2013-08-01&#39; \
db2 (cont.) =&gt; SET amt = 14.99 WHERE sku_no = &#39;CHR_00001&#39;
DB20000I  The SQL command completed successfully.
db2 =&gt; SELECT * FROM product_info

SKU_NO          STORE_ID            AMT          BUS_START  BUS_END
--------------- ------------------- ------------ ---------- ----------
CHR_00001       NJ01                       14.99 06/01/2013 07/01/2013
CHR_00001       NJ01                       14.99 07/01/2013 08/01/2013
CHR_00005       NJ01                        8.99 01/01/2013 01/01/2014
CHR_00007       NJ01                       25.99 01/01/2013 01/01/2014
CHR_00001       NJ01                        9.99 01/01/2013 06/01/2013
CHR_00001       NJ01                       10.99 08/01/2013 01/01/2014

6 record(s) selected.
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">UPDATE can cause the spliting of rows and inserting of new rows into the table.
Two existing rows for CHR_00001 are split. These two rows are updated with the new time period and tow new
rows are inserted for CHR_00001 with the price 14.99</p>
</div>
<ul class="simple">
<li>Deleting data from application-period temporal tables</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre>db2 =&gt; DELETE FROM product_info FOR PORTION OF BUSINESS_TIME FROM &#39;2013-06-15&#39; TO &#39;2013-08-15&#39; WHERE sku_no = &#39;CHR_00001&#39;
DB20000I  The SQL command completed successfully.
db2 =&gt; SELECT * FROM product_info

SKU_NO          STORE_ID            AMT          BUS_START  BUS_END
--------------- ------------------- ------------ ---------- ----------
CHR_00001       NJ01                       14.99 06/01/2013 06/15/2013
CHR_00001       NJ01                       10.99 08/15/2013 01/01/2014
CHR_00005       NJ01                        8.99 01/01/2013 01/01/2014
CHR_00007       NJ01                       25.99 01/01/2013 01/01/2014
CHR_00001       NJ01                        9.99 01/01/2013 06/01/2013

5 record(s) selected.
</pre></div>
</div>
<ul class="simple">
<li>Querying the application-period temporal tables</li>
</ul>
<p>Same as system-period temporal table:</p>
<div class="highlight-python"><div class="highlight"><pre>db2 =&gt; SELECT sku_no, amt, bus_start, bus_end FROM product_info FOR BUSINESS_TIME AS OF &#39;2013-08-15&#39; WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          AMT          BUS_START  BUS_END
--------------- ------------ ---------- ----------
CHR_00001              10.99 08/15/2013 01/01/2014

1 record(s) selected.

db2 =&gt; SELECT sku_no, amt, bus_start, bus_end FROM product_info FOR BUSINESS_TIME FROM &#39;2013-01-01&#39; TO &#39;2013-06-15&#39; WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          AMT          BUS_START  BUS_END
--------------- ------------ ---------- ----------
CHR_00001               9.99 01/01/2013 06/01/2013
CHR_00001              14.99 06/01/2013 06/15/2013

2 record(s) selected.

db2 =&gt; SELECT sku_no, amt, bus_start, bus_end FROM product_info FOR BUSINESS_TIME BETWEEN &#39;0001-01-01&#39; AND &#39;2013-01-01&#39;

SKU_NO          AMT          BUS_START  BUS_END
--------------- ------------ ---------- ----------
CHR_00005               8.99 01/01/2013 01/01/2014
CHR_00007              25.99 01/01/2013 01/01/2014
CHR_00001               9.99 01/01/2013 06/01/2013

3 record(s) selected.

db2 =&gt; SELECT sku_no, amt, bus_start, bus_end FROM product_info WHERE sku_no = &#39;CHR_00001&#39;

SKU_NO          AMT          BUS_START  BUS_END
--------------- ------------ ---------- ----------
CHR_00001               9.99 01/01/2013 06/01/2013
CHR_00001              14.99 06/01/2013 06/15/2013
CHR_00001              10.99 08/15/2013 01/01/2014

3 record(s) selected.
</pre></div>
</div>
</div>
<div class="section" id="bitemporal-tables">
<h4>Bitemporal tables<a class="headerlink" href="#bitemporal-tables" title="Permalink to this headline">¶</a></h4>
<p><code class="xref download docutils literal"><span class="pre">Bitemporal</span> <span class="pre">tables</span> <span class="pre">sql</span></code></p>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><em>Roger E. Sanders</em> DB2 10.1 Fundamentals Certification Study Guide Chapter 5</li>
<li><a class="reference external" href="http://www.ibm.com/developerworks/data/tutorials/db2-cert6104/">DB2 10.1 fundamentals certification exam 610 prep, Part 4: Working with DB2 Data using SQL</a></li>
</ul>
</div>
<div class="section" id="comments">
<h2>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h2>
<div class="feed-disqus">
<div id="disqus_thread"></div>
<script type="text/javascript">
var disqus_shortname = "zeyuan";
var disqus_identifier = "/exam610_p4";

(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div></div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Zeyuan (Jerry) Hu.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>