<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL &mdash; Zeyuan&#39;s IBM Docs</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Zeyuan&#39;s IBM Docs" href="../../index.html" />
    <link rel="up" title="Projects" href="../project.html" />
    <link rel="next" title="MODIFICATION OF db2fedsvrcfg TOOL" href="db2fedsvrcfg_mod.html" />
    <link rel="prev" title="Projects" href="../project.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="db2fedsvrcfg_mod.html" title="MODIFICATION OF db2fedsvrcfg TOOL"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../project.html" title="Projects"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Zeyuan&#39;s IBM Docs</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" accesskey="U">Projects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="incomplete-investigation-report-on-db2fedsvrcfg-tool">
<span id="db2fedsvrcfg-rst"></span><h1>INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL<a class="headerlink" href="#incomplete-investigation-report-on-db2fedsvrcfg-tool" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">February 03, 2016</td>
</tr>
</tbody>
</table>
<div class="topic">
<p class="topic-title first">Background</p>
<div class="line-block">
<div class="line"><a class="reference download internal" href="../../_downloads/FedSvr_Beta_Topic_ODBC_customization.ppt"><code class="xref download docutils literal"><span class="pre">ODBC</span> <span class="pre">Data</span> <span class="pre">Source</span> <span class="pre">Customization</span></code></a></div>
<div class="line"><a class="reference download internal" href="../../_downloads/ODSC_phase2_overview.ppt"><code class="xref download docutils literal"><span class="pre">ODBC</span> <span class="pre">Data</span> <span class="pre">Source</span> <span class="pre">Customization</span> <span class="pre">phase2</span></code></a></div>
<div class="line"><a class="reference download internal" href="../../_downloads/Inside_db2fedsvrcfg.ppt"><code class="xref download docutils literal"><span class="pre">Inside</span> <span class="pre">db2fedsvrcfg</span></code></a></div>
</div>
</div>
<div class="section" id="remarks-after-meeting">
<h2>0. Remarks after meeting<a class="headerlink" href="#remarks-after-meeting" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">&#8220;Performance&#8221; = &#8220;pushdown&#8221;</p>
</li>
<li><p class="first">We don&#8217;t care about <strong>CASE III</strong>, <strong>CASE IV</strong> logic for now</p>
</li>
<li><p class="first">Tool value: check capacity of the remote data source</p>
<blockquote>
<div><p>server option set to <code class="docutils literal"><span class="pre">Y</span></code> doesn&#8217;t necessarily indicate Federation Server can pushdown. But, server option set to <code class="docutils literal"><span class="pre">N</span></code>, Federation Server will definitely <strong>cannot</strong> pushdown.</p>
</div></blockquote>
</li>
<li><p class="first">Tool essential:</p>
<blockquote>
<div><p>It doesn&#8217;t use Federation Server at all. For <strong>case I</strong>, It uses ODBC-API to create test_table remotely, then it issues queries to query remote table that the tool just created, and
compared the <code class="docutils literal"><span class="pre">result_list</span></code> with the expected result_list (by <code class="docutils literal"><span class="pre">judge</span></code>).</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="intro">
<h2>1. Intro<a class="headerlink" href="#intro" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>According to <a class="reference external" href="http://www-01.ibm.com/support/knowledgecenter/SSEPGG_10.5.0/com.ibm.swg.im.iis.found.conn.fw.odb.doc/topics/iiynwodb_cftut.html">knowledge center</a> ,
&#8220;db2fedsvrcfg&#8221; asserts only for &#8220;Optimize performance&#8221;, and it is really unclear to me that what is the measure for &#8220;performance&#8221;?
How to judge whether &#8220;performance&#8221; is optimized or not?
Whether this tool is worth to modify or not still depends on the relationship between &#8220;pushdown&#8221; and &#8220;performance&#8221;.
Based upon my limited understanding, this tool doesn&#8217;t give a clear indication on whether it tests &#8220;pushdown&#8221; or not.
Based upon <code class="docutils literal"><span class="pre">db2odbct_analyze</span></code> function, it might test &#8220;pushdown&#8221; b/c it implements strict test against <code class="docutils literal"><span class="pre">rc</span> <span class="pre">=</span> <span class="pre">operation-&gt;query()</span></code> result. This can tell from <code class="docutils literal"><span class="pre">judge</span></code> function.
Strict in the sense that even a query with certain server option can be pushdown, the query result should match exactly with the expected query return in order to be <code class="docutils literal"><span class="pre">Y</span></code>.</p>
<p>The following example demonstrates what I mean for &#8220;strict&#8221;, in <em>db2odbct_analyze.C</em>, function <code class="docutils literal"><span class="pre">analyze</span></code></p>
<div class="highlight-c++"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">case</span> <span class="nl">SQLQG_SERVER_CHAR_BLANKPADDED_COMPARISON_OPTION_ID</span><span class="p">:</span>
<span class="p">{</span>
        <span class="c1">// Issue the analyze statement.</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">operation</span><span class="o">-&gt;</span><span class="n">query</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_OK</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="c1">// skip some code</span>
                <span class="n">judge</span> <span class="o">=</span> <span class="n">judge_result</span><span class="p">(</span><span class="n">a_option</span><span class="p">,</span> <span class="n">result_list</span><span class="p">);</span>
                <span class="c1">// skip some code</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">judge</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
                <span class="p">{</span>
<span class="hll">                        <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span>
</span>                        <span class="n">analysis_completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_NO_DATA_FOUND</span><span class="p">)</span>
        <span class="p">{</span>
<span class="hll">                <span class="c1">// No data returned is assumed as the data source did not process</span>
</span><span class="hll">                <span class="c1">// the WHERE clause portion with blank padded comparison.</span>
</span>                <span class="n">rc</span> <span class="o">=</span> <span class="n">RC_OK</span><span class="p">;</span>
<span class="hll">                <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span><span class="p">;</span>
</span>                <span class="c1">// skip some code</span>
        <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<dl class="docutils">
<dt>[12, 18-19]:</dt>
<dd>Essentially, this block indicates that when <code class="docutils literal"><span class="pre">DB2_CHAR_BLANKPADDED_COMPARISON</span></code> (represented by <code class="docutils literal"><span class="pre">SQLQG_SERVER_CHAR_BLANKPADDED_COMPARISON_OPTION_ID</span></code>)
is set to <code class="docutils literal"><span class="pre">Y</span></code>, remote data source cannot process it (b/c <code class="docutils literal"><span class="pre">rc</span> <span class="pre">==</span> <span class="pre">RC_NO_DATA_FOUND</span></code>). This indicates that this server option doesn&#8217;t really affect pushdown.
However, this message cannot convey to user b/c when <code class="docutils literal"><span class="pre">judge</span></code> is <code class="docutils literal"><span class="pre">false</span></code>, <code class="docutils literal"><span class="pre">optimized_value</span></code> will also be set to <code class="docutils literal"><span class="pre">N</span></code>. This implies that
<code class="docutils literal"><span class="pre">rc</span> <span class="pre">=</span> <span class="pre">operation-&gt;query()</span></code> can issue to remote data source and there is <code class="docutils literal"><span class="pre">result_list</span></code> returned. But <code class="docutils literal"><span class="pre">result_list</span></code> doesn&#8217;t match the predefined return data type,
data value, or number of data. This makes interpretation of <code class="docutils literal"><span class="pre">N</span></code> for <code class="docutils literal"><span class="pre">optimized_value</span></code> hard because one cannot determine whether it is due to <em>cannot pushdown</em> or
<em>can pushdown but return result invalid</em></dd>
</dl>
<p>In order to clarify the concept of &#8220;optimized&#8221;, I think one need to carefully examine <code class="docutils literal"><span class="pre">judge_result</span></code> function in <code class="docutils literal"><span class="pre">db2odbct_analyze</span></code> and other <code class="docutils literal"><span class="pre">optimized_value</span></code> determination
logic as well.</p>
<p>Maybe certain server option has directly link with &#8220;optimized performance&#8221;, and that server option set to &#8220;Y&#8221; will imply the improve in &#8220;performance&#8221;, which verified by code that are
not well encaptured inside the tool?</p>
</div></blockquote>
</div>
<div class="section" id="important-code-flow">
<h2>2. Important code flow<a class="headerlink" href="#important-code-flow" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="docutils">
<dt><em>db2fedsvrcfg.C</em> (main)</dt>
<dd><ul class="first last simple">
<li></li>
<li>&lt;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- <code class="docutils literal"><span class="pre">LoadTuningLibrary(...)</span></code></li>
<li></li>
</ul>
</dd>
<dt><em>db2odbct.C</em></dt>
<dd><ul class="first last simple">
<li></li>
<li>&lt;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;- <code class="docutils literal"><span class="pre">analyze_data_source(...)</span></code></li>
<li></li>
</ul>
</dd>
<dt><em>db2odbct.C</em> {<em>db2odbct_elements</em> <span class="classifier-delimiter">:</span> <span class="classifier">server option manipulation, tuning_table_info manipulation, result_list manipulation</span></dt>
<dd><ul class="first last simple">
<li><em>db2odbct_common</em>   : server option definition, tuning_table definition</li>
<li><em>db2odbct_statment</em> : DDL generation}</li>
<li><em>db2odbct_operation</em>: DDL operation}</li>
<li></li>
<li>&lt;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211; <code class="docutils literal"><span class="pre">rc</span> <span class="pre">=</span> <span class="pre">analyzer-&gt;analyze(option)</span></code></li>
</ul>
</dd>
</dl>
<p><em>db2odbct_analyze.C</em></p>
</div></blockquote>
</div>
<div class="section" id="analyze-logic">
<span id="id1"></span><h2>3. Analyze logic<a class="headerlink" href="#analyze-logic" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Encoded in <code class="docutils literal"><span class="pre">analyze</span></code> function in <em>db2odbct_analyze.C</em>. There are four types of logic corresponding to different set of server options.</p>
<p><strong>CASE I</strong></p>
<blockquote>
<div><dl class="docutils">
<dt># include:</dt>
<dd><div class="first last line-block">
<div class="line">case SQLQG_SERVER_VARCHAR_BLANKPADDED_COMPARISON_OPTION_ID</div>
<div class="line">case SQLQG_SERVER_CHAR_BLANKPADDED_COMPARISON_OPTION_ID</div>
</div>
</dd>
</dl>
<p># structure:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="literal-block-wrapper first container" id="construct-tuning-analyze-stmt-generator">
<div class="code-block-caption"><span class="caption-text">Construct Tuning_ANALYZE_Stmt_Generator</span><a class="headerlink" href="#construct-tuning-analyze-stmt-generator" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        Tuning_ANALYZE_Stmt_Generator *generator =
                        new Tuning_ANALYZE_Stmt_Generator(m_connection, m_table_list, option_id);`
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="analyze-sql-statement-generate">
<div class="code-block-caption"><span class="caption-text">Analyze SQL statement generate</span><a class="headerlink" href="#analyze-sql-statement-generate" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">TString</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">generator</span><span class="o">-&gt;</span><span class="n">generate</span><span class="p">();</span> <span class="p">[</span><span class="n">detail</span> <span class="n">see</span> <span class="n">db2odbct_statement</span><span class="p">]</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="create-operation">
<div class="code-block-caption"><span class="caption-text">Create Operation</span><a class="headerlink" href="#create-operation" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">Tuning_Query_Operation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span> <span class="n">m_connection</span><span class="o">-&gt;</span><span class="n">create_query_operation</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">stmt</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="issue-the-analyze-statement">
<div class="code-block-caption"><span class="caption-text">Issue the analyze statement</span><a class="headerlink" href="#issue-the-analyze-statement" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">rc</span> <span class="o">=</span> <span class="n">operation</span><span class="o">-&gt;</span><span class="n">query</span><span class="p">();</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="retrieve-result-for-judgement">
<div class="code-block-caption"><span class="caption-text">Retrieve result for judgement</span><a class="headerlink" href="#retrieve-result-for-judgement" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">rc</span> <span class="o">=</span> <span class="n">operation</span><span class="o">-&gt;</span><span class="n">fetch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">result_list</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="judge-result">
<div class="code-block-caption"><span class="caption-text">Judge result</span><a class="headerlink" href="#judge-result" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">judge</span> <span class="o">=</span> <span class="n">judge_result</span><span class="p">(</span><span class="n">a_option</span><span class="p">,</span> <span class="n">result_list</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="based-upon-judge-valeset-optimized-value">
<div class="code-block-caption"><span class="caption-text">Based upon &#8220;judge&#8221; valeSet optimized value</span><a class="headerlink" href="#based-upon-judge-valeset-optimized-value" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_OK</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">result_list</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">judge</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
                <span class="p">{</span>
                        <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">;</span>
                        <span class="n">analysis_completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">judge</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
                <span class="p">{</span>
                        <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span><span class="p">;</span>
                        <span class="n">analysis_completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_NO_DATA_FOUND</span><span class="p">)</span>
                <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;N&quot;</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div></blockquote>
</div></blockquote>
<p><strong>CASE II</strong></p>
<blockquote>
<div><dl class="docutils">
<dt># include:</dt>
<dd><div class="first last line-block">
<div class="line">case SQLQG_SERVER_COLFUNC_EXPR_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_FUNCTION_IN_COUNT_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_COUNT_NON_DISTINCT_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_OUTER_JOINS_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_NESTED_TAB_EXPR_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_ORDER_BY_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_SELECT_DISTINCT_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_COLFUNC_DISTINCT_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_GROUP_BY_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_BASIC_PRED_RHS_SCALAR_SQ_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_UNION_ALL_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_COLFUNC_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_EXISTS_PRED_OPTION_ID:</div>
</div>
</dd>
</dl>
<p># structure:</p>
<blockquote>
<div><p>step 1 - 4 are the same case as <strong>CASE I</strong></p>
<ol class="arabic" start="5">
<li><div class="first highlight-c++"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_OK</span><span class="p">)</span>
        <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div></blockquote>
<p><strong>CASE III</strong></p>
<blockquote>
<div><dl class="docutils">
<dt># include:</dt>
<dd><div class="first last line-block">
<div class="line">case SQLQG_SERVER_MAX_SEL_SIZE_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_MAX_OB_SIZE_OPTION_ID:</div>
<div class="line">case SQLQG_SERVER_MAX_GB_SIZE_OPTION_ID:</div>
</div>
</dd>
</dl>
<p># structure:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">uses three values: <code class="docutils literal"><span class="pre">min_value</span></code>, <code class="docutils literal"><span class="pre">max_value</span></code>, <code class="docutils literal"><span class="pre">default_value</span></code></p>
<blockquote>
<div></div></blockquote>
</li>
<li><p class="first">start loop:</p>
<div class="line-block">
<div class="line">2.1 then <code class="docutils literal"><span class="pre">new_value</span></code>, <code class="docutils literal"><span class="pre">old_value</span></code> to search</div>
</div>
<blockquote>
<div><div class="literal-block-wrapper container" id="initialization">
<div class="code-block-caption"><span class="caption-text">initialization:</span><a class="headerlink" href="#initialization" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">new_value</span> <span class="o">=</span> <span class="n">default_value</span><span class="p">;</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="n">min_value</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper container" id="when-the-previous-statement-failed-try-with-smaller-value">
<div class="code-block-caption"><span class="caption-text">When the previous statement failed try with smaller value</span><a class="headerlink" href="#when-the-previous-statement-failed-try-with-smaller-value" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">new_value</span> <span class="o">=</span> <span class="n">old_value</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_value</span> <span class="o">-</span> <span class="n">old_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper container" id="when-the-previous-statement-succeeded-try-with-larger-value">
<div class="code-block-caption"><span class="caption-text">When the previous statement succeeded, try with larger value.</span><a class="headerlink" href="#when-the-previous-statement-succeeded-try-with-larger-value" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">new_value</span> <span class="o">=</span> <span class="n">new_value</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_value</span> <span class="o">-</span> <span class="n">old_value</span><span class="p">);</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="n">old_value</span> <span class="o">+</span> <span class="p">(</span><span class="n">new_value</span> <span class="o">-</span> <span class="n">old_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>2.2 then set the new value to generate a new statement</p>
<dl class="docutils">
<dt>2.3 then issue the analysis statement with new value</dt>
<dd><div class="first last highlight-c++"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">==</span> <span class="n">RC_OK</span><span class="p">)</span>
        <span class="c1">//then we find the ideal value, which is new_value</span>
<span class="k">else</span>
        <span class="c1">// Store the rc as the information for making a decision of generation</span>
        <span class="c1">// of the next analysis statement.</span>
        <span class="n">prev_rc</span> <span class="o">=</span> <span class="n">rc</span><span class="p">;</span>
</pre></div>
</div>
</dd>
<dt>2.4 loop will terminate when</dt>
<dd><div class="first last highlight-c++"><div class="highlight"><pre><span class="c1">// Terminate the analysis if the statement succeeds and the difference becomes</span>
<span class="c1">// smaller than the threshold.</span>
<span class="k">if</span> <span class="p">((</span><span class="n">stmt_generation_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="p">((</span><span class="n">abs</span><span class="p">(</span><span class="n">old_value</span> <span class="o">-</span> <span class="n">new_value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">||</span><span class="p">(</span><span class="n">new_value</span> <span class="o">==</span> <span class="n">max_value</span><span class="p">)))</span>
<span class="p">{</span>
        <span class="n">analysis_completed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
</div></blockquote>
<p><strong>CASE IV</strong></p>
<blockquote>
<div><dl class="docutils">
<dt># include:</dt>
<dd>case SQLQG_SERVER_UPD_SET_DEFAULT_OPTION_ID:</dd>
</dl>
<p># structure:</p>
<blockquote>
<div><ol class="arabic">
<li><div class="literal-block-wrapper first container" id="id2">
<div class="code-block-caption"><span class="caption-text">Construct Tuning_ANALYZE_Stmt_Generator</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>                        <span class="n">Tuning_ANALYZE_Stmt_Generator</span> <span class="o">*</span><span class="n">generator</span> <span class="o">=</span>
                                <span class="k">new</span> <span class="n">Tuning_ANALYZE_Stmt_Generator</span><span class="p">(</span><span class="n">m_connection</span><span class="p">,</span> <span class="n">m_table_list</span><span class="p">,</span> <span class="n">option_id</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="id3">
<div class="code-block-caption"><span class="caption-text">Analyze SQL statement generate</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>                        <span class="n">TString</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">generator</span><span class="o">-&gt;</span><span class="n">generate</span><span class="p">();</span> <span class="p">[</span><span class="n">detail</span> <span class="n">see</span> <span class="n">db2odbct_statement</span><span class="p">]</span>
</pre></div>
</div>
</div>
</li>
<li><div class="literal-block-wrapper first container" id="create-operation-here-is-diff-create-iud-operation">
<div class="code-block-caption"><span class="caption-text">Create Operation (here is diff: create_IUD_operation )</span><a class="headerlink" href="#create-operation-here-is-diff-create-iud-operation" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>                        <span class="n">Tuning_IUD_Operation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span>
                                <span class="n">m_connection</span><span class="o">-&gt;</span><span class="n">create_IUD_operation</span><span class="p">((</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">stmt</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
<li><div class="first highlight-c++"><div class="highlight"><pre><span class="kt">int</span> <span class="n">row_updated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">rc</span> <span class="o">=</span> <span class="n">operation</span><span class="o">-&gt;</span><span class="n">iud_row</span><span class="p">(</span><span class="o">&amp;</span><span class="n">row_updated</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><div class="first highlight-c++"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="n">row_updated</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">judge</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">optimized_value</span> <span class="o">=</span> <span class="s">&quot;Y&quot;</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div></blockquote>
<p><strong>Remarks on CASE I</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">judge</span></code> function</p>
<blockquote>
<div><p>The following server options will be checked and invoke <code class="docutils literal"><span class="pre">check_existance_int</span></code></p>
<blockquote>
<div><div class="line-block">
<div class="line">SQLQG_SERVER_VARCHAR_BLANKPADDED_COMPARISON_OPTION_ID</div>
<div class="line">SQLQG_SERVER_CHAR_BLANKPADDED_COMPARISON_OPTION_ID</div>
<div class="line">SQLQG_SERVER_COLFUNC_EXPR_OPTION_ID</div>
<div class="line">SQLQG_SERVER_FUNCTION_IN_COUNT_OPTION_ID</div>
<div class="line">SQLQG_SERVER_COUNT_NON_DISTINCT_OPTION_ID</div>
</div>
</div></blockquote>
<p>The following server options will not be checked and return <code class="docutils literal"><span class="pre">true</span></code></p>
<blockquote>
<div><div class="line-block">
<div class="line">SQLQG_SERVER_BASIC_PRED_RHS_SCALAR_SQ_OPTION_ID</div>
<div class="line">SQLQG_SERVER_COLFUNC_DISTINCT_OPTION_ID</div>
<div class="line">SQLQG_SERVER_COLFUNC_OPTION_ID</div>
<div class="line">SQLQG_SERVER_EXISTS_PRED_OPTION_ID</div>
<div class="line">SQLQG_SERVER_GROUP_BY_OPTION_ID</div>
<div class="line">SQLQG_SERVER_MAX_GB_SIZE_OPTION_ID</div>
<div class="line">SQLQG_SERVER_MAX_OB_SIZE_OPTION_ID</div>
<div class="line">SQLQG_SERVER_MAX_SEL_SIZE_OPTION_ID</div>
<div class="line">SQLQG_SERVER_NESTED_TAB_EXPR_OPTION_ID</div>
<div class="line">SQLQG_SERVER_ORDER_BY_OPTION_ID</div>
<div class="line">SQLQG_SERVER_OUTER_JOINS_OPTION_ID</div>
<div class="line">SQLQG_SERVER_SELECT_DISTINCT_OPTION_ID</div>
<div class="line">SQLQG_SERVER_UNION_ALL_OPTION_ID</div>
<div class="line">SQLQG_SERVER_UPD_SET_DEFAULT_OPTION_ID</div>
</div>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">check_existance_int</span></code> function</p>
<blockquote>
<div><dl class="docutils">
<dt>Logic:</dt>
<dd><p class="first">It will compare <code class="docutils literal"><span class="pre">a_result_data</span></code> one by one</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">Tuning_Result_Data</span> <span class="o">*</span><span class="n">a_result_data</span> <span class="o">=</span> <span class="n">result_list</span><span class="o">-&gt;</span><span class="n">get_first_result_data</span><span class="p">();</span>
<span class="n">a_result_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tuning_Result_Data</span> <span class="o">*</span><span class="p">)</span><span class="n">a_result_data</span><span class="o">-&gt;</span><span class="n">get_next_result_data</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
<p>Then, compare <code class="docutils literal"><span class="pre">a_result_data</span></code> data type (<code class="docutils literal"><span class="pre">a_result_data-&gt;get_data_type()</span></code>),
data value (<code class="docutils literal"><span class="pre">a_result_data-&gt;get_int_value()</span></code>)
with the predefined value: <code class="docutils literal"><span class="pre">rsdt_int</span></code> &amp; <code class="docutils literal"><span class="pre">value</span></code></p>
<p class="last">If <code class="docutils literal"><span class="pre">a_result_data</span></code> valid, then <code class="docutils literal"><span class="pre">foundNum++</span></code>, if <code class="docutils literal"><span class="pre">foundNum</span> <span class="pre">==</span> <span class="pre">count</span></code>, then return <code class="docutils literal"><span class="pre">true</span></code></p>
</dd>
</dl>
<p>Example:</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre> <span class="k">case</span> <span class="nl">SQLQG_SERVER_CHAR_BLANKPADDED_COMPARISON_OPTION_ID</span><span class="p">:</span>
<span class="p">{</span>
        <span class="c1">// Check if &#39;blank-padded comparison&#39; is executed correctly.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">check_existance_int</span><span class="p">(</span><span class="n">result_list</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="literal-block-wrapper container" id="analyze-statement">
<div class="code-block-caption"><span class="caption-text">Analyze statement</span><a class="headerlink" href="#analyze-statement" title="Permalink to this code">¶</a></div>
<div class="highlight-sql"><div class="highlight"><pre>       <span class="k">SELECT</span> <span class="n">IT1C1</span> <span class="k">FROM</span> <span class="n">IITEST1</span> <span class="k">WHERE</span> <span class="n">IT1C4</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
</pre></div>
</div>
</div>
<p>See IITEST1 table: from <em>db2odbct_common.h</em>, <code class="docutils literal"><span class="pre">56</span></code> matches expected result from analyze statement.</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="more-info">
<h2>4. More info<a class="headerlink" href="#more-info" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>YaQiong&#8217;s <em>db2fedsvrcfg tool investigation</em> report</li>
<li>Zeyuan&#8217;s detailed version of <a class="reference external" href="../../_static/db2fedsvrcfg/db2fedsvrcfg.txt">db2fedsvrcfg study note</a></li>
<li>Zhi Tong &amp; Huang Xue&#8217;s <a class="reference external" href="../../_static/db2fedsvrcfg/db2fedsvrcfg_enhancement_(2015-11-09_Rev1_modified_by_hx).xls">server attributes summary</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL</a><ul>
<li><a class="reference internal" href="#remarks-after-meeting">0. Remarks after meeting</a></li>
<li><a class="reference internal" href="#intro">1. Intro</a></li>
<li><a class="reference internal" href="#important-code-flow">2. Important code flow</a></li>
<li><a class="reference internal" href="#analyze-logic">3. Analyze logic</a></li>
<li><a class="reference internal" href="#more-info">4. More info</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../project.html"
                        title="previous chapter">Projects</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="db2fedsvrcfg_mod.html"
                        title="next chapter">MODIFICATION OF db2fedsvrcfg TOOL</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="db2fedsvrcfg_mod.html" title="MODIFICATION OF db2fedsvrcfg TOOL"
             >next</a> |</li>
        <li class="right" >
          <a href="../project.html" title="Projects"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Zeyuan&#39;s IBM Docs</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Projects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Zeyuan Hu.
      Last updated on Feb 03, 2016.
    </div>
  </body>
</html>