<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>MODIFICATION OF db2fedsvrcfg TOOL &mdash; Zeyuan&#39;s IBM Docs</title>
    
    <link rel="stylesheet" href="../../_static/traditional.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Zeyuan&#39;s IBM Docs" href="../../index.html" />
    <link rel="up" title="Projects" href="../project.html" />
    <link rel="next" title="db2fedsvrcfg TOOL &amp; hive" href="db2fedsvrcfg_hive.html" />
    <link rel="prev" title="INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL" href="db2fedsvrcfg.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="db2fedsvrcfg_hive.html" title="db2fedsvrcfg TOOL &amp; hive"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="db2fedsvrcfg.html" title="INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Zeyuan&#39;s IBM Docs</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" accesskey="U">Projects</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="modification-of-db2fedsvrcfg-tool">
<span id="db2fedsvrcfg-mod-rst"></span><h1>MODIFICATION OF db2fedsvrcfg TOOL<a class="headerlink" href="#modification-of-db2fedsvrcfg-tool" title="Permalink to this headline">¶</a></h1>
<p>Date: February 03, 2016</p>
<p>This doc intends to work as a record of how &#8220;db2fedsvrcfg&#8221; tool is being modified in
order to adjust tool to meet &#8220;Add DB2 Federation Server capacity to NoSQL data source&#8221; project needs.</p>
<div class="section" id="code-change-summary">
<h2>0. Code Change summary<a class="headerlink" href="#code-change-summary" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul>
<li><p class="first">build info:</p>
<div class="highlight-sql"><div class="highlight"><pre><span class="n">The</span> <span class="n">branch</span> <span class="n">name</span> <span class="n">got</span> <span class="k">is</span><span class="p">:</span> <span class="n">temp_iidev20_bigsql_main_hzy</span>

<span class="o">/</span><span class="n">vbs</span><span class="o">/</span><span class="n">engn</span><span class="o">/</span><span class="n">sqqg_odbc</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="p">.</span><span class="k">C</span><span class="o">@@/</span><span class="n">main</span><span class="o">/</span><span class="n">temp_iidev20_bigsql_main_hzy</span><span class="o">/</span><span class="mi">1</span>
<span class="o">/</span><span class="n">vbs</span><span class="o">/</span><span class="n">engn</span><span class="o">/</span><span class="n">sqqg_odbc</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="o">/</span><span class="n">db2odbct_analyze</span><span class="p">.</span><span class="k">C</span><span class="o">@@/</span><span class="n">main</span><span class="o">/</span><span class="n">temp_iidev20_bigsql_main_hzy</span><span class="o">/</span><span class="mi">5</span>
<span class="o">/</span><span class="n">vbs</span><span class="o">/</span><span class="n">engn</span><span class="o">/</span><span class="n">sqqg_odbc</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="o">/</span><span class="n">db2odbct_statement</span><span class="p">.</span><span class="k">C</span><span class="o">@@/</span><span class="n">main</span><span class="o">/</span><span class="n">temp_iidev20_bigsql_main_hzy</span><span class="o">/</span><span class="mi">4</span>
<span class="o">/</span><span class="n">vbs</span><span class="o">/</span><span class="n">engn</span><span class="o">/</span><span class="n">sqqg_odbc</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="o">/</span><span class="n">inc</span><span class="o">/</span><span class="n">db2odbct_common</span><span class="p">.</span><span class="n">h</span><span class="o">@@/</span><span class="n">main</span><span class="o">/</span><span class="n">temp_iidev20_bigsql_main_hzy</span><span class="o">/</span><span class="mi">8</span>
<span class="o">/</span><span class="n">vbs</span><span class="o">/</span><span class="n">engn</span><span class="o">/</span><span class="n">sqqg_odbc</span><span class="o">/</span><span class="n">db2fedsvrcfg</span><span class="o">/</span><span class="n">inc</span><span class="o">/</span><span class="n">db2odbct_statement</span><span class="p">.</span><span class="n">h</span><span class="o">@@/</span><span class="n">main</span><span class="o">/</span><span class="n">temp_iidev20_bigsql_main_hzy</span><span class="o">/</span><span class="mi">6</span>
</pre></div>
</div>
</li>
<li><p class="first">Add server attribute templates: (example: NULL_IN_SELECT)</p>
<blockquote>
<div><ul class="simple">
<li>code change for <strong>db2fedsvrcfg.C</strong> <a class="reference internal" href="#db2fedsvrcfg-c"><span>link</span></a></li>
<li>code change for <strong>db2odbct_common.h</strong> <a class="reference internal" href="#db2odbct-common-h"><span>link</span></a></li>
<li>code change for <strong>db2odbct_analyze.C</strong> <a class="reference internal" href="#db2odbct-analyze-c"><span>link</span></a></li>
<li>code change for <strong>db2odbct_statement.h</strong> <a class="reference internal" href="#db2odbct-statement-h"><span>link</span></a></li>
<li>code change for <strong>db2odbct_statement_C</strong> <a class="reference internal" href="#db2odbct-statement-c"><span>link</span></a></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Server attributes added:</p>
<blockquote>
<div><p>See <a class="reference internal" href="db2fedsvrcfg.html#db2fedsvrcfg-rst"><span>INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL</span></a> Zhi Tong&#8217;s doc. Added highlighted in green.</p>
</div></blockquote>
</li>
<li><p class="first">enable db2odbct trace <a class="reference internal" href="#db2odbct-trace"><span>link</span></a></p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="analyze-statement-generation">
<h2>1. Analyze statement generation<a class="headerlink" href="#analyze-statement-generation" title="Permalink to this headline">¶</a></h2>
<p>According to <a class="reference internal" href="db2fedsvrcfg.html#analyze-logic"><span>3. Analyze logic</span></a>:</p>
<blockquote>
<div><div class="literal-block-wrapper container" id="analyze-sql-statement-generate">
<div class="code-block-caption"><span class="caption-text">Analyze SQL statement generate</span><a class="headerlink" href="#analyze-sql-statement-generate" title="Permalink to this code">¶</a></div>
<div class="highlight-c++"><div class="highlight"><pre>        <span class="n">TString</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">generator</span><span class="o">-&gt;</span><span class="n">generate</span><span class="p">();</span> <span class="p">[</span><span class="n">detail</span> <span class="n">see</span> <span class="n">db2odbct_statement</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div></blockquote>
<p>Before looking at <code class="docutils literal"><span class="pre">generate()</span></code> function, let&#8217;s first take a look at <code class="docutils literal"><span class="pre">db2odbct_statement.h</span></code> file.</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">Analyze_Statement</span>
<span class="p">{</span>
        <span class="kt">char</span>   <span class="o">*</span><span class="n">option_id</span><span class="p">;</span>
        <span class="kt">char</span>   <span class="o">*</span><span class="n">analyze_stmt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">Analyze_Statement</span><span class="p">;</span>

<span class="k">static</span> <span class="n">Analyze_Statement</span> <span class="n">analyze_stmt</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
        <span class="p">{</span>
                <span class="n">SQLQG_GROUP_BY_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C3 FROM %s GROUP BY IT1C3&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_ORDER_BY_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C3 FROM %s ORDER BY IT1C3&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_COLFUNC_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT MAX(IT1C1) FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_VARCHAR_BLANKPADDED_COMPARISON_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C1 FROM %s WHERE IT1C6 = &#39;12345  &#39;&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_CHAR_BLANKPADDED_COMPARISON_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C1 FROM %s WHERE IT1C4 = &#39;F  &#39;&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_COLFUNC_EXPR_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT MAX(IT1C1+IT1C2) FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_FUNCTION_IN_COUNT_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT COUNT(IT1C1+IT1C2) FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_COUNT_NON_DISTINCT_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT COUNT(IT1C1) FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_MAX_SEL_SIZE_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT %s FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_MAX_OB_SIZE_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT3C1 FROM %s ORDER BY %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_MAX_GB_SIZE_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT3C1 FROM %s GROUP BY %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_OUTER_JOINS_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C3 FROM %s LEFT OUTER JOIN %s ON IT1C1 = IT2C2&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_NESTED_TAB_EXPR_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT NTE.IT1C1 FROM (SELECT IT1C1, IT1C2 FROM %s) NTE&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_UPD_SET_DEFAULT_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;UPDATE %s SET IT2C3 = DEFAULT WHERE IT2C2 = 56&quot;</span>
        <span class="p">},</span>
                <span class="c1">// &quot;SELECT IT1C2 FROM IITEST1</span>
                <span class="c1">//    WHERE IT1C1 = (SELECT IT2C2 FROM IITEST2 WHERE IT2C1=2)&quot;</span>
        <span class="p">{</span>
                <span class="n">SQLQG_BASIC_PRED_RHS_SCALAR_SQ_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C2 FROM %s WHERE IT1C1 = (SELECT IT2C2 FROM %s WHERE IT2C1=2)&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_UNION_ALL_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C1 FROM %s UNION ALL SELECT IT2C1 FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_COLFUNC_DISTINCT_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT SUM(DISTINCT IT1C1) FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_SELECT_DISTINCT_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT DISTINCT IT1C3 FROM %s&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
                <span class="n">SQLQG_EXISTS_PRED_SERVER_OPTION</span><span class="p">,</span>
                <span class="s">&quot;SELECT IT1C3 FROM %s WHERE EXISTS (SELECT * FROM %s)&quot;</span>
        <span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="last arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">Analyze_Statement</span></code> is a struct, which contains <code class="docutils literal"><span class="pre">char</span> <span class="pre">*analyze_stmt</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">analyze_stmt[]</span></code> is an array of struct (<code class="docutils literal"><span class="pre">Analyze_Statement</span></code>), which can be used like</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="k">case</span> <span class="nl">SQLQG_SERVER_EXISTS_PRED_OPTION_ID</span><span class="p">:</span>
<span class="p">{</span>
        <span class="n">SQL_statement</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">analyze_stmt</span><span class="p">[</span><span class="n">m_option_id</span><span class="p">].</span><span class="n">analyze_stmt</span><span class="p">,</span>
                                                <span class="n">table_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                <span class="n">table_name</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in <code class="docutils literal"><span class="pre">db2odbct_statement.C</span></code></p>
</div></blockquote>
</li>
<li><p class="first">Note that in <code class="docutils literal"><span class="pre">analyze_stmt[]</span></code>, pre-defined query statement uses <code class="docutils literal"><span class="pre">printf</span></code> format. The placeholder <code class="docutils literal"><span class="pre">%s</span></code> can
be substituted for table name.</p>
</li>
</ol>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">tool checks 19 attributes. All have been added into <code class="docutils literal"><span class="pre">Tuning_Server_Option_List</span></code> through <code class="docutils literal"><span class="pre">build_server_option_list</span></code> function
in &#8220;db2odbct2.C&#8221; file</p>
</li>
<li><div class="first admonition note">
<p class="first admonition-title">Note</p>
<p>go to &#8220;vbs/engn/include&#8221; to find the official name for server attributes</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#define SQLQG_SERVER_NULL_IN_SELECT                     &quot;NULL_IN_SELECT&quot;</span>
</pre></div>
</div>
<p>Then in the final display, add &#8220;DB2_&#8221; for internal server attributes</p>
<div class="last highlight-bash"><div class="highlight"><pre>ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_NULL_IN_SELECT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</div>
</li>
</ol>
</div></blockquote>
<p>11/12/15:</p>
<blockquote id="analysis">
<div><ol class="arabic">
<li><p class="first">Goal: Need to figure out where <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">&quot;IITEST1&quot;</span></code> get generated and aim to remove quotation marks first.</p>
</li>
<li><p class="first">Investigations:</p>
<blockquote>
<div><p>2.1 In <code class="docutils literal"><span class="pre">db2odbct.C</span></code>, line 00118:</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="k">if</span><span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;DB2ODBCT_DEBUG&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
<p>2.2</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
<blockquote id="db2odbct-trace">
<div><blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To access debug trace file of this tool, run <code class="docutils literal"><span class="pre">export</span> <span class="pre">DB2ODBCT_DEBUG=1</span></code>, then re-run the tool
the trace file called <code class="docutils literal"><span class="pre">db2fedsvrcfg.trc</span></code> will be found under the current working directory.</p>
</div>
</div></blockquote>
<dl class="docutils">
<dt>2.3 Based on trace, table name created when calling <code class="docutils literal"><span class="pre">prepare_data_source</span></code>, which is located under</dt>
<dd><p class="first"><strong>db2odbct2.C</strong>, then the statement is created in line 00259:</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">TString</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">generator</span><span class="o">-&gt;</span><span class="n">generate</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">generate</span></code> function is located under <strong>db2odbct_statement.C</strong>. Then table name (with quotation marks)
get assigned in line 00131:</p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">TString</span> <span class="n">id_quote_str</span> <span class="o">=</span> <span class="n">TString</span><span class="p">(</span><span class="n">m_connection</span><span class="o">-&gt;</span><span class="n">get_id_quote_char</span><span class="p">());</span>
</pre></div>
</div>
</div></blockquote>
<p>get appended to <code class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> in line 00152:</p>
<blockquote class="last">
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">SQL_statement</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_quote_str</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</dd>
</dl>
<p>2.4 <strong>SUSCIPIOUS</strong> There is</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="cp">#define MAX_SERVER_OPTIONS 11 </span><span class="cm">/*!&lt; Max number of server options */</span><span class="cp"></span>
</pre></div>
</div>
</div></blockquote>
<p>Probably we need to modify this value later on?</p>
</div></blockquote>
<p>2.5  Turns out that</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">SQL_statement</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">id_quote_str</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<p>adding the single quotation mark</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="modification-log">
<h2>2. Modification log<a class="headerlink" href="#modification-log" title="Permalink to this headline">¶</a></h2>
<p>10/27/15:</p>
<blockquote>
<div><ul class="simple">
<li>Start modification: bigsql_main</li>
<li>checkout source code</li>
</ul>
</div></blockquote>
<p>10/28/15:</p>
<blockquote>
<div><ul class="simple" id="db2fedsvrcfg-c">
<li>let <em>db2fedsvrcfg.C</em> print out all the server option as long as <em>not</em> <code class="docutils literal"><span class="pre">Tuning_Server_Option_Info::Tuning_Failure</span></code></li>
</ul>
<img alt="../../_images/db2fedsvrcfg_C_0.PNG" src="../../_images/db2fedsvrcfg_C_0.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2fedsvrcfg_C_diff_0.PNG" src="../../_images/db2fedsvrcfg_C_diff_0.PNG" />
<p>Now the test result is:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">=</span>&gt; db2fedsvrcfg -s SERVER1 -m /opt/oemclient/odbc60/64/lib/VMmsss24.so -dsn mssql2005csdl1 -u j15user1 -p j15user1

-- This CLP file was created using <span class="s2">&quot;db2fedsvrcfg&quot;</span> Version <span class="s2">&quot;10.6.0.3&quot;</span>.
-- Timestamp: 2015/10/28 15:00:30
-- Server Name: SERVER1
-- ODBC Driver Manager: /opt/oemclient/odbc60/64/lib/VMmsss24.so
-- DSN Name: mssql2005csdl1
-- Remote Database Name:
-- Remote User Name: j15user1
-- Remote Table Names: IITEST<span class="o">[</span><span class="c">#]</span>
-- Remote Data Source Codepage:
-- Preparation: YES
-- Verbose: NO


-- Generating ALTER SERVER statement...

-- --------------------------------------------------
--  ALTER SERVER statements <span class="k">for</span> server <span class="s2">&quot;SERVER1&quot;</span>
-- --------------------------------------------------
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD PUSHDOWN <span class="s1">&#39;Y&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_GROUP_BY <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_ORDER_BY <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_COLFUNC <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_VARCHAR_BLANKPADDED_COMPARISON <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_CHAR_BLANKPADDED_COMPARISON <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_COLFUNC_EXPR <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_FUNCTION_IN_COUNT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_COUNT_NON_DISTINCT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_MAX_SEL_SIZE <span class="s1">&#39;4005&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_MAX_OB_SIZE <span class="s1">&#39;256&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_MAX_GB_SIZE <span class="s1">&#39;256&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_OUTER_JOINS <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_NESTED_TAB_EXPR <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_UPD_SET_DEFAULT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_BASIC_PRED_RHS_SCALAR_SQ <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_UNION_ALL <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_COLFUNC_DISTINCT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_SELECT_DISTINCT <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>
ALTER SERVER <span class="s2">&quot;SERVER1&quot;</span> OPTIONS <span class="o">(</span>ADD DB2_EXISTS_PRED <span class="s1">&#39;N&#39;</span><span class="o">)</span><span class="p">;</span>

The db2fedsvrcfg <span class="nb">command </span>completed successfully.
</pre></div>
</div>
</div></blockquote>
<ul class="simple" id="db2odbct-common-h">
<li>Add one more server attribute &#8220;SQLQG_SERVER_NULL_IN_SELECT&#8221; into <em>db2odbct_common.h</em></li>
</ul>
<img alt="../../_images/db2odbct_common_h_0.PNG" src="../../_images/db2odbct_common_h_0.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_common_h_1.PNG" src="../../_images/db2odbct_common_h_1.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_common_h_diff.PNG" src="../../_images/db2odbct_common_h_diff.PNG" />
<ul class="simple" id="db2odbct-analyze-c">
<li>Add <code class="docutils literal"><span class="pre">case</span> <span class="pre">SQLQG_SERVER_NULL_IN_SELECT_OPTION_ID:</span></code> in <em>db2odbct_analyze</em></li>
</ul>
<img alt="../../_images/db2odbct_analyze_C_0.PNG" src="../../_images/db2odbct_analyze_C_0.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_analyze_C_diff_0.PNG" src="../../_images/db2odbct_analyze_C_diff_0.PNG" />
<ul class="simple" id="db2odbct-statement-h">
<li>Add analyze statement query in <em>db2odbct_statement.h</em></li>
</ul>
<img alt="../../_images/db2odbct_statement_h_0.PNG" src="../../_images/db2odbct_statement_h_0.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_statement_h_diff_0.PNG" src="../../_images/db2odbct_statement_h_diff_0.PNG" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Here, instead of using <code class="docutils literal"><span class="pre">fprintf</span></code> style statement like previous options in the tool (namely Option ID: 0 - 18),
I directly encode the table name into the query.</p>
</div>
<ul class="simple" id="db2odbct-statement-c">
<li>Add <code class="docutils literal"><span class="pre">case</span> <span class="pre">SQLQG_SERVER_NULL_IN_DISTINCT_OPTION_ID</span></code> in &#8220;db2odbct_statement.C&#8221;</li>
</ul>
<img alt="../../_images/db2odbct_statement_C_0.PNG" src="../../_images/db2odbct_statement_C_0.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_statement_C_diff_0.PNG" src="../../_images/db2odbct_statement_C_diff_0.PNG" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since in the analyze statement already contains hardcode table_name, and thus we don&#8217;t need to do anything here (i.e. to replace
%s with actual table_name like previous statements in tool)</p>
</div>
<ul class="simple">
<li>checkin &#8220;db2odbct_statement.C&#8221;, &#8220;db2odbct_statement.h&#8221;, &#8220;db2odbct_analyze.C&#8221;, &#8220;db2odbct_common.h&#8221;, &#8220;db2fedsvrcfg.C&#8221;</li>
</ul>
</div></blockquote>
<p>11/10/15:</p>
<blockquote>
<div><ul class="simple">
<li>Finish adding server attributes (see Zhitong &amp; Xue&#8217;s doc <a class="reference internal" href="db2fedsvrcfg.html#db2fedsvrcfg-rst"><span>INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL</span></a>)</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>11/12/15:</dt>
<dd><ul class="first last">
<li><p class="first">Based upon 11/12/15 <a class="reference internal" href="#analysis"><span>analysis</span></a>, remove quotation marks around
&#8220;IITEST1&#8221; in <strong>db2odbct_common.h</strong>:</p>
<p><strong>DOESN&#8217;T WORK</strong></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Table definition has to fit into <code class="docutils literal"><span class="pre">typedef</span> <span class="pre">struct</span> <span class="pre">Table_Definition</span></code>.
In it, <code class="docutils literal"><span class="pre">char</span> <span class="pre">*table_name</span></code> - a string. The quotation mark is added somewhere else.</p>
</div>
<img alt="../../_images/db2odbct_common_h_2.PNG" src="../../_images/db2odbct_common_h_2.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_common_h_2_error.PNG" src="../../_images/db2odbct_common_h_2_error.PNG" />
</li>
<li><p class="first">Also try to erase quotation marks around <code class="docutils literal"><span class="pre">id_quote_str</span></code> in <strong>db2odbct_statement.C</strong></p>
<p><strong>DOESN&#8217;T WORK</strong></p>
<img alt="../../_images/db2odbct_common_h_3.PNG" src="../../_images/db2odbct_common_h_3.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_common_h_3_error.PNG" src="../../_images/db2odbct_common_h_3_error.PNG" />
</li>
<li><p class="first"><strong>FIND HOW QUOTATION MARKS ADDED</strong> modified <code class="docutils literal"><span class="pre">db2odbct_statement.C</span></code></p>
<img alt="../../_images/db2odbct_statement_C_1.PNG" src="../../_images/db2odbct_statement_C_1.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/db2odbct_statement_C_1_diff.PNG" src="../../_images/db2odbct_statement_C_1_diff.PNG" />
</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="test">
<h2>3. test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sanity-check">
<h3>Sanity check:<a class="headerlink" href="#sanity-check" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ol class="loweralpha">
<li><p class="first">[odbc] has to be the top of odbc.ini</p>
<blockquote>
<div><img alt="../../_images/sanity_check_01.PNG" src="../../_images/sanity_check_01.PNG" />
</div></blockquote>
</li>
<li><p class="first">make sure the [dsn] Driver is loadable</p>
<blockquote>
<div><img alt="../../_images/sanity_check_02.PNG" src="../../_images/sanity_check_02.PNG" />
</div></blockquote>
</li>
<li><p class="first">if (b) is doing correctly, run <code class="docutils literal"><span class="pre">ldd</span> <span class="pre">/opt/oemclient/odbc60/64/lib/libodbc.so</span></code> to verify library is loadable (i.e. no &#8220;not found&#8221;)</p>
</li>
<li><p class="first">verify <code class="docutils literal"><span class="pre">LD_LIBRARY_PATH</span></code> environment is properly setup. If you see nothing, probably you&#8217;re in bash. You need to use <strong>ksh</strong>.</p>
</li>
<li><p class="first">run <code class="docutils literal"><span class="pre">db2fedsvrcfg</span> <span class="pre">-s</span> <span class="pre">SERVER1</span> <span class="pre">-m</span> <span class="pre">/opt/oemclient/odbc60/64/lib/libodbc.so</span> <span class="pre">-dsn</span> <span class="pre">mssql2005csdl1</span> <span class="pre">-u</span> <span class="pre">j15user1</span> <span class="pre">-p</span> <span class="pre">j15user1</span></code></p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="test-method-mssql2005csdl1">
<h3>3.0 test method [mssql2005csdl1]<a class="headerlink" href="#test-method-mssql2005csdl1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>3.0.1 run <code class="docutils literal"><span class="pre">db2fedsvrcfg</span> <span class="pre">-s</span> <span class="pre">SERVER1</span> <span class="pre">-m</span> <span class="pre">/opt/oemclient/odbc60/64/lib/libodbc.so</span> <span class="pre">-dsn</span> <span class="pre">mssql2005csdl1</span> <span class="pre">-u</span> <span class="pre">j15user1</span> <span class="pre">-p</span> <span class="pre">j15user1</span></code> :</p>
<blockquote>
<div><a class="reference external" href="../../_static/db2fedsvrcfg/mssql2005.txt">mssql2005 test result</a></div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">DB2_NULL_EQUALITY</span></code> and <code class="docutils literal"><span class="pre">DB2_VARCHAR_NO_TRAILING_BLANKS</span></code> will give out warning no matter how default values are set</p>
</div>
</div></blockquote>
</div>
<div class="section" id="test-method-hive">
<h3>3.1 test method [hive]<a class="headerlink" href="#test-method-hive" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<div class="last line-block">
<div class="line">9.181.139.171</div>
<div class="line">root/hadoop</div>
</div>
</div>
<p>run <code class="docutils literal"><span class="pre">db2fedsvrcfg</span> <span class="pre">-s</span> <span class="pre">SERVER1</span> <span class="pre">-m</span> <span class="pre">/opt/oemclient/odbc71/64/lib/libodbc.so</span> <span class="pre">-dsn</span> <span class="pre">hive</span> <span class="pre">-u</span> <span class="pre">root</span> <span class="pre">-p</span> <span class="pre">hadoop</span></code></p>
<img alt="../../_images/hive_error.PNG" src="../../_images/hive_error.PNG" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<img alt="../../_images/hive_error2.PNG" src="../../_images/hive_error2.PNG" />
<p><strong>UPDATE: 11/11/15</strong></p>
<img alt="../../_images/hive_error3.PNG" src="../../_images/hive_error3.PNG" />
<p>reason: hiveserver2 on 9.181.139.171 takes all the memory (access by <code class="docutils literal"><span class="pre">top</span></code>), which cannot take in any other connection.</p>
<p>fix:    try to reboot the VM on 9.181.139.171</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">shutdown</span> <span class="pre">-r</span> <span class="pre">now</span></code>  this tells system to reboot NOW</p>
<blockquote>
<div><p>if this doesn&#8217;t work, try following command:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">ps</span> <span class="pre">-ef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">java</span> <span class="pre">|</span> <span class="pre">more</span></code></li>
<li><code class="docutils literal"><span class="pre">ps</span> <span class="pre">-ef</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">java</span> <span class="pre">|</span> <span class="pre">awk</span> <span class="pre">'{print</span> <span class="pre">$2}'</span> <span class="pre">|</span> <span class="pre">xargs</span> <span class="pre">kill</span> <span class="pre">-9</span></code></li>
</ul>
</div></blockquote>
<p>then retry <code class="docutils literal"><span class="pre">shutdown</span> <span class="pre">-r</span> <span class="pre">now</span></code></p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>verify: try either <code class="docutils literal"><span class="pre">netstat</span> <span class="pre">-apn</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">10000</span></code> on 9.181.139.171 or</dt>
<dd><p class="first"><code class="docutils literal"><span class="pre">telnet</span> <span class="pre">9.181.139.171</span> <span class="pre">10000</span></code> on 9.112.250.80</p>
<p class="last">or try <code class="docutils literal"><span class="pre">demoodbc</span> <span class="pre">-uid</span> <span class="pre">root</span> <span class="pre">-pwd</span> <span class="pre">hadoop</span> <span class="pre">-xml</span> <span class="pre">hive</span></code> on 9.112.250.80</p>
</dd>
</dl>
<p><strong>UPDATE: 11/12/15</strong></p>
<img alt="../../_images/hive_error4.PNG" src="../../_images/hive_error4.PNG" />
<p>Statement generated before the error:</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IITEST1</span> <span class="p">(</span> <span class="n">IT1C1</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">IT1C2</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">IT1C3</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">IT1C4</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">IT1C5</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">IT1C6</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">IT1C7</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>Correct statement that can be created in hive directly:</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">IITEST1</span> <span class="p">(</span> <span class="n">IT1C1</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IT1C2</span> <span class="nb">int</span><span class="p">,</span> <span class="n">IT1C3</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">IT1C4</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">IT1C5</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">IT1C6</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">IT1C7</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
<img alt="../../_images/hive_correct.PNG" src="../../_images/hive_correct.PNG" />
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="test-method-impala">
<h3>3.2 test method [Impala]<a class="headerlink" href="#test-method-impala" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Using impala shell directly:</p>
<div class="last line-block">
<div class="line">9.123.111.142</div>
<div class="line">cloudera/cloudera</div>
<div class="line">run <code class="docutils literal"><span class="pre">impala-shell</span></code></div>
</div>
</div>
<p>use 9.112.250.80</p>
<ol class="arabic">
<li><p class="first">run <code class="docutils literal"><span class="pre">autohive</span> <span class="pre">-if</span></code> to config. You need to update <code class="docutils literal"><span class="pre">[odbc]</span></code> and <code class="docutils literal"><span class="pre">[Impala_test1]</span></code> manually in &#8220;odbc.ini&#8221;</p>
<blockquote>
<div><p>Here is an example from <code class="docutils literal"><span class="pre">autohive</span> <span class="pre">-if</span></code> output:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>ODBC<span class="o">]</span>
<span class="nv">IANAAppCodePage</span><span class="o">=</span>4
<span class="nv">InstallDir</span><span class="o">=</span>/opt/oemclient/odbc71/64
<span class="nv">TraceDll</span><span class="o">=</span>
<span class="nv">TraceFile</span><span class="o">=</span>odbctrace.out
<span class="nv">UseCursorLib</span><span class="o">=</span>0

<span class="o">[</span>Impala_test1<span class="o">]</span>
<span class="nv">Driver</span><span class="o">=</span>/opt/oemclient/odbc71/64/lib/VMimpala00.so
<span class="nv">Description</span><span class="o">=</span>DataDirect 7.1 Impala Wire Protocol
<span class="nv">ArraySize</span><span class="o">=</span>1024
<span class="nv">Database</span><span class="o">=</span>default
<span class="nv">DefaultLongDataBuffLen</span><span class="o">=</span>1024
<span class="nv">DefaultOrderByLimit</span><span class="o">=</span>-1
<span class="nv">EnableDescribeParam</span><span class="o">=</span>0
<span class="nv">HostName</span><span class="o">=</span>9.123.111.142
<span class="nv">LoginTimeout</span><span class="o">=</span>30
<span class="nv">LogonID</span><span class="o">=</span>cloudera
<span class="nv">MaxVarcharSize</span><span class="o">=</span>2147483647
<span class="nv">Password</span><span class="o">=</span>
<span class="nv">PortNumber</span><span class="o">=</span>21050
<span class="nv">RemoveColumnQualifiers</span><span class="o">=</span>0
<span class="nv">ServicePrincipalName</span><span class="o">=</span>
<span class="nv">StringDescribeType</span><span class="o">=</span>-9
<span class="nv">TransactionMode</span><span class="o">=</span>0
<span class="nv">UseCurrentSchema</span><span class="o">=</span>0
<span class="nv">Trace</span><span class="o">=</span>0
<span class="nv">TraceDll</span><span class="o">=</span>/opt/oemclient/odbc71/64/lib/VMtrc00.so
<span class="nv">TraceFile</span><span class="o">=</span>odbctrace.out
<span class="nv">QEWSD</span><span class="o">=</span>2457260
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Again, [ODBC] has to stay top of odbc.ini</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Restart db through <code class="docutils literal"><span class="pre">db2stop</span> <span class="pre">force;</span> <span class="pre">db2start</span></code></p>
</li>
<li><p class="first">compose a clp file to see if the connection to impala works as expected:</p>
<blockquote>
<div><div class="highlight-sql"><div class="highlight"><pre><span class="k">connect</span> <span class="k">to</span> <span class="n">testdb</span><span class="p">;</span>
<span class="k">drop</span> <span class="n">wrapper</span> <span class="n">odbc</span><span class="p">;</span>

<span class="k">drop</span> <span class="n">server</span> <span class="n">SERVER1</span><span class="p">;</span>

<span class="k">create</span> <span class="n">wrapper</span> <span class="n">odbc</span> <span class="k">options</span><span class="p">(</span><span class="n">MODULE</span> <span class="s1">&#39;/home/iidev20/branded_odbc/lib/libodbc.so&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="n">server</span> <span class="ss">&quot;SERVER1&quot;</span> <span class="k">type</span> <span class="n">odbc</span> <span class="k">version</span> <span class="mi">7</span><span class="p">.</span><span class="mi">1</span> <span class="n">wrapper</span> <span class="n">odbc</span> <span class="k">authorization</span>
                <span class="ss">&quot;cloudera&quot;</span> <span class="n">password</span> <span class="ss">&quot;cloudera&quot;</span> <span class="k">OPTIONS</span><span class="p">(</span><span class="n">node</span> <span class="s1">&#39;Impala_test1&#39;</span><span class="p">,</span><span class="n">dbname</span>
                <span class="s1">&#39;default&#39;</span><span class="p">,</span><span class="n">CODEPAGE</span> <span class="s1">&#39;1252&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="k">user</span> <span class="n">mapping</span> <span class="k">for</span> <span class="k">user</span> <span class="n">server</span> <span class="ss">&quot;SERVER1&quot;</span> <span class="k">options</span><span class="p">(</span><span class="n">REMOTE_AUTHID</span>
                <span class="s1">&#39;cloudera&#39;</span><span class="p">,</span><span class="n">REMOTE_PASSWORD</span> <span class="s1">&#39;cloudera&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="n">nickname</span> <span class="n">nick1</span> <span class="k">for</span> <span class="ss">&quot;SERVER1&quot;</span><span class="p">.</span><span class="ss">&quot;default&quot;</span><span class="p">.</span><span class="ss">&quot;tab1&quot;</span><span class="p">;</span>

<span class="k">create</span> <span class="n">nickname</span> <span class="n">nick2</span> <span class="k">for</span> <span class="ss">&quot;SERVER1&quot;</span><span class="p">.</span><span class="ss">&quot;default&quot;</span><span class="p">.</span><span class="ss">&quot;tab2&quot;</span><span class="p">;</span>

<span class="k">describe</span> <span class="k">table</span> <span class="n">nick1</span><span class="p">;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">check output of clp file:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">=</span>&gt; db2 -tvf impala.clp
connect to testdb

Database Connection Information

Database <span class="nv">server</span>        <span class="o">=</span> DB2/LINUXX8664 10.1.5
SQL authorization <span class="nv">ID</span>   <span class="o">=</span> IIDEV20
Local database <span class="nb">alias</span>   <span class="o">=</span> TESTDB


drop wrapper odbc
DB20000I  The SQL <span class="nb">command </span>completed successfully.

drop server SERVER1
DB21034E  The <span class="nb">command </span>was processed as an SQL statement because it was not a
valid Command Line Processor command.  During SQL processing it returned:
SQL0204N  <span class="s2">&quot;SERVER1&quot;</span> is an undefined name.  <span class="nv">SQLSTATE</span><span class="o">=</span>42704

create wrapper odbc options<span class="o">(</span>MODULE <span class="s1">&#39;/home/iidev20/branded_odbc/lib/libodbc.so&#39;</span><span class="o">)</span>
DB20000I  The SQL <span class="nb">command </span>completed successfully.

create server <span class="s2">&quot;SERVER1&quot;</span> <span class="nb">type </span>odbc version 7.1 wrapper odbc authorization <span class="s2">&quot;cloudera&quot;</span> password <span class="s2">&quot;cloudera&quot;</span> OPTIONS<span class="o">(</span>node <span class="s1">&#39;Impala_test1&#39;</span>,dbname <span class="s1">&#39;default&#39;</span>,CODEPAGE <span class="s1">&#39;1252&#39;</span><span class="o">)</span>
DB20000I  The SQL <span class="nb">command </span>completed successfully.

create user mapping <span class="k">for</span> user server <span class="s2">&quot;SERVER1&quot;</span> options<span class="o">(</span>REMOTE_AUTHID <span class="s1">&#39;cloudera&#39;</span>,REMOTE_PASSWORD <span class="s1">&#39;cloudera&#39;</span><span class="o">)</span>
DB20000I  The SQL <span class="nb">command </span>completed successfully.

create nickname nick1 <span class="k">for</span> <span class="s2">&quot;SERVER1&quot;</span>.<span class="s2">&quot;default&quot;</span>.<span class="s2">&quot;tab1&quot;</span>
DB20000I  The SQL <span class="nb">command </span>completed successfully.

create nickname nick2 <span class="k">for</span> <span class="s2">&quot;SERVER1&quot;</span>.<span class="s2">&quot;default&quot;</span>.<span class="s2">&quot;tab2&quot;</span>
DB20000I  The SQL <span class="nb">command </span>completed successfully.

describe table nick1

                                                                Data <span class="nb">type                     </span>Column
Column name                     schema    Data <span class="nb">type </span>name      Length     Scale Nulls
------------------------------- --------- ------------------- ---------- ----- ------
ID                              SYSIBM    INTEGER                      <span class="m">4</span>     <span class="m">0</span> Yes
COL_1                           SYSIBM    SMALLINT                     <span class="m">2</span>     <span class="m">0</span> Yes
COL_2                           SYSIBM    DOUBLE                       <span class="m">8</span>     <span class="m">0</span> Yes
COL_3                           SYSIBM    TIMESTAMP                   <span class="m">10</span>     <span class="m">6</span> Yes

<span class="m">4</span> record<span class="o">(</span>s<span class="o">)</span> selected.
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">run <code class="docutils literal"><span class="pre">db2fedsvrcfg</span> <span class="pre">-s</span> <span class="pre">SERVER1</span> <span class="pre">-m</span> <span class="pre">/opt/oemclient/odbc71/64/lib/libodbc.so</span> <span class="pre">-dsn</span> <span class="pre">Impala_test1</span> <span class="pre">-u</span> <span class="pre">cloudera</span> <span class="pre">-p</span> <span class="pre">cloudera</span></code></p>
<blockquote>
<div><img alt="../../_images/impala_error.PNG" src="../../_images/impala_error.PNG" />
</div></blockquote>
</li>
</ol>
<p><strong>UPDATE 11/12/15:</strong></p>
<blockquote>
<div><img alt="../../_images/impala_error2.PNG" src="../../_images/impala_error2.PNG" />
</div></blockquote>
<p><strong>UPDATE 11/13/15:</strong></p>
<blockquote>
<div><img alt="../../_images/impala_error3.PNG" src="../../_images/impala_error3.PNG" />
</div></blockquote>
<ol class="arabic" start="6">
<li><p class="first">run <code class="docutils literal"><span class="pre">db2fedsvrcfg</span> <span class="pre">-s</span> <span class="pre">SERVER1</span> <span class="pre">-m</span> <span class="pre">/opt/oemclient/odbc71/64/lib/libodbc.so</span> <span class="pre">-dsn</span> <span class="pre">Impala_test1</span> <span class="pre">-u</span> <span class="pre">cloudera</span> <span class="pre">-p</span> <span class="pre">cloudera</span> <span class="pre">-noprep</span></code> instead.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal"><span class="pre">-noprep</span></code> means to skip remote creating table phase. Jump directly to the test query execution.
Doing this avoid modifying db2fedsvrcfg tool heavily. In other words, <strong>when user deal with Impala, hive data source,
they should use ``-noprep`` and create test tables remotely before using the tool</strong></p>
</div>
</div></blockquote>
</li>
</ol>
<p><strong>UPDATE 11/13/15:</strong></p>
<blockquote>
<div><p><a class="reference external" href="../../_static/db2fedsvrcfg/impala_error4.txt">impala test result error4</a></p>
<img alt="../../_images/impala_error4.PNG" src="../../_images/impala_error4.PNG" />
<p><a class="reference external" href="../../_static/db2fedsvrcfg/db2fedsvrcfg1113.trc">db2fedsvrcfg.trc 11/13/15</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The reason for the incorrect analysis result is that <code class="docutils literal"><span class="pre">Tuning_Server_Option_Analyzer::validate_table</span></code> failed.
Clearly <code class="docutils literal"><span class="pre">&quot;IITEST1&quot;</span></code> doesn&#8217;t match with <code class="docutils literal"><span class="pre">IITEST1</span></code>. In other words, in table validation phase, quotation marks
still matter.</p>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p>Two potential paths to fix:</p>
<blockquote class="last">
<div><ol class="arabic simple">
<li>Eliminate quotation marks around <code class="docutils literal"><span class="pre">IITEST1</span></code> during table validation phase, and see if analyzer can proceed.</li>
<li>When <code class="docutils literal"><span class="pre">-noprep</span></code> set, bypass table validation phase and directly to execute the test queries.</li>
</ol>
</div></blockquote>
</div>
</div></blockquote>
<p><strong>UPDATE 11/22/15:</strong></p>
<blockquote>
<div><p>Detailed analysis of the error message found on <strong>UPDATE 11/13/15</strong>:</p>
<p>Detailed Error trace analysis:</p>
<ol class="arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">Tuning_Server_Option_Analyzer::validate</span></code></p>
<blockquote>
<div><p><em>The analysis failed for the following reason: Reason: &#8220;IITEST1&#8221; could not be found.</em></p>
<p>This error message is generated in function <code class="docutils literal"><span class="pre">describe_table</span></code> of <code class="docutils literal"><span class="pre">db2odbct_operation.C</span></code> when <code class="docutils literal"><span class="pre">rc</span> <span class="pre">==</span> <span class="pre">RC_NO_DATA_FOUND</span></code>, which is <code class="docutils literal"><span class="pre">2</span></code>.
The <code class="docutils literal"><span class="pre">2</span></code> also appears in the trace that several lines above saying <em>Return code: 2</em></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">Tuning_Statement::</span> <span class="pre">fetch</span></code></p>
<blockquote>
<div><p><em>Failure in the fetch of describe_table</em></p>
<p>This error happens when <code class="docutils literal"><span class="pre">fetch</span></code> function of <code class="docutils literal"><span class="pre">db2odbct_statement.C</span></code> called in <code class="docutils literal"><span class="pre">describe_table</span></code> of <code class="docutils literal"><span class="pre">db2odbct_statement.C</span></code>, and the return code
is not equal to <code class="docutils literal"><span class="pre">RC_OK</span></code></p>
</div></blockquote>
</li>
</ol>
<p>Detailed Call stack:</p>
<ol class="arabic">
<li><p class="first"><code class="docutils literal"><span class="pre">db2odbct_operation.C</span></code> <code class="docutils literal"><span class="pre">describe_table</span></code></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">rc</span> <span class="pre">=</span> <span class="pre">m_statement-&gt;describe_table(m_table_info,</span> <span class="pre">a_rs_list);</span></code></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">db2odbct_statement.C</span></code> <code class="docutils literal"><span class="pre">describe_table</span></code></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">rc</span> <span class="pre">=</span> <span class="pre">fetch(&amp;rs_list);</span></code></p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>iitest1 table structure</p>
<img alt="../../_images/iitest1_struct.png" class="last" src="../../_images/iitest1_struct.png" />
</div>
<p>Perform <strong>mssql2005</strong> and <strong>impala</strong> test using <code class="docutils literal"><span class="pre">-noprep</span></code> at the same time, and compare the trace file:</p>
<p>Namely,</p>
<p><strong>mssql:</strong></p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">db2fedsvrcfg</span> <span class="o">-</span><span class="n">s</span> <span class="n">SERVER1</span> <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oemclient</span><span class="o">/</span><span class="n">odbc60</span><span class="o">/</span><span class="mi">64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libodbc</span><span class="p">.</span><span class="n">so</span> <span class="o">-</span><span class="n">dsn</span> <span class="n">mssql2005csdl1</span> <span class="o">-</span><span class="n">u</span> <span class="n">j15user1</span> <span class="o">-</span><span class="n">p</span> <span class="n">j15user1</span> <span class="o">-</span><span class="n">noprep</span>
</pre></div>
</div>
</div></blockquote>
<p><strong>Impala:</strong></p>
<blockquote>
<div><div class="highlight-c++"><div class="highlight"><pre><span class="n">db2fedsvrcfg</span> <span class="o">-</span><span class="n">s</span> <span class="n">SERVER1</span> <span class="o">-</span><span class="n">m</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">oemclient</span><span class="o">/</span><span class="n">odbc71</span><span class="o">/</span><span class="mi">64</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">libodbc</span><span class="p">.</span><span class="n">so</span> <span class="o">-</span><span class="n">dsn</span> <span class="n">Impala_test1</span> <span class="o">-</span><span class="n">u</span> <span class="n">cloudera</span> <span class="o">-</span><span class="n">p</span> <span class="n">cloudera</span> <span class="o">-</span><span class="n">noprep</span>
</pre></div>
</div>
</div></blockquote>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Tuning_Connection::get_remote_attributes</span></code> is executed and found in mssql trace but not in impala</li>
</ul>
<p><strong>Investigation:</strong></p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">get_remote_attributes</span></code> is found in <code class="docutils literal"><span class="pre">db2odbct_connection.C</span></code>. Here is the header info about
this function:</p>
<div class="highlight-c++"><div class="highlight"><pre>Name  = Tuning_Connection::get_remote_attributes
***********************************************************************/
/**
 *  \brief Get ODBC information by calling SQLGetInfo.
 *
 *  In this function, the following are got from the ODBC driver or
 *  data source:
 *    - SQL_ODBC_VER
 *    - SQL_DRIVER_ODBC_VER
 *    - SQL_DRIVER_NAME
 *    - SQL_IDENTIFIER_QUOTE_CHAR
 *  If it fails to get the SQL_IDENTIFIER_QUOTE_CHAR value, the double
 *  quote(&quot;) is used. The SQL_IDENTIFIER_QUOTE_CHAR will be used when
 *  creating a remote SQL statement. The others will be used just as
 *  debug info.
 *
 *  \note We don&#39;t case of any ODBC errors returned from SQLGetInfo,
 *        because they are not a fatal error.
 *
</pre></div>
</div>
</div></blockquote>
<p><strong>Update: 11/24/15</strong></p>
<blockquote>
<div><p>Known issue:</p>
<ul class="simple">
<li>code page issue. <code class="docutils literal"><span class="pre">Tuning_Utilities::get_codepage</span></code> get called, and <code class="docutils literal"><span class="pre">SQL_CP_UNKNOWN</span></code>
is returned, which cause <em>Failed in getting codepage</em> error message.</li>
<li><code class="docutils literal"><span class="pre">fetch</span></code> function return <code class="docutils literal"><span class="pre">SQL_NO_DATA_FOUND</span></code> (see <a class="reference external" href="../../_static/db2fedsvrcfg/112415.txt">code analysis</a>)</li>
</ul>
</div></blockquote>
<p><strong>Update: 12/01/15</strong></p>
<blockquote>
<div><a class="reference external" href="../../_static/db2fedsvrcfg/impala_result.txt">Impala final result</a></div></blockquote>
<p><strong>Update: 12/02/15</strong></p>
<blockquote>
<div><a class="reference download internal" href="../../_downloads/db2fedsvrcfg-debug-log-impala.html"><code class="xref download docutils literal"><span class="pre">Impala</span> <span class="pre">debug</span> <span class="pre">log</span></code></a></div></blockquote>
</div></blockquote>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">MODIFICATION OF db2fedsvrcfg TOOL</a><ul>
<li><a class="reference internal" href="#code-change-summary">0. Code Change summary</a></li>
<li><a class="reference internal" href="#analyze-statement-generation">1. Analyze statement generation</a></li>
<li><a class="reference internal" href="#modification-log">2. Modification log</a></li>
<li><a class="reference internal" href="#test">3. test</a><ul>
<li><a class="reference internal" href="#sanity-check">Sanity check:</a></li>
<li><a class="reference internal" href="#test-method-mssql2005csdl1">3.0 test method [mssql2005csdl1]</a></li>
<li><a class="reference internal" href="#test-method-hive">3.1 test method [hive]</a></li>
<li><a class="reference internal" href="#test-method-impala">3.2 test method [Impala]</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="db2fedsvrcfg.html"
                        title="previous chapter">INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="db2fedsvrcfg_hive.html"
                        title="next chapter">db2fedsvrcfg TOOL &amp; hive</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="db2fedsvrcfg_hive.html" title="db2fedsvrcfg TOOL &amp; hive"
             >next</a> |</li>
        <li class="right" >
          <a href="db2fedsvrcfg.html" title="INCOMPLETE INVESTIGATION REPORT ON db2fedsvrcfg TOOL"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Zeyuan&#39;s IBM Docs</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../project.html" >Projects</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Zeyuan Hu.
      Last updated on Feb 03, 2016.
    </div>
  </body>
</html>