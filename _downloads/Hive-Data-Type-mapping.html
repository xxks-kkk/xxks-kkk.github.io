<html xmlns:tomboy="http://beatniksoftware.com/tomboy" xmlns:size="http://beatniksoftware.com/tomboy/size" xmlns:link="http://beatniksoftware.com/tomboy/link"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Hive Data Type mapping</title><style type="text/css">
	body {  }
	h1 { font-size: xx-large;
     	     font-weight: bold;
     	     border-bottom: 1px solid black; }
	div.note {
		   position: relative;
		   display: block;
		   padding: 5pt;
		   margin: 5pt; 
		   white-space: -moz-pre-wrap; /* Mozilla */
 	      	   white-space: -pre-wrap;     /* Opera 4 - 6 */
 	      	   white-space: -o-pre-wrap;   /* Opera 7 */
 	      	   white-space: pre-wrap;      /* CSS3 */
 	      	   word-wrap: break-word;      /* IE 5.5+ */ }
	</style></head><body><div class="note" id="Hive Data Type mapping"><a name="hive%20data%20type%20mapping"></a><h1>Hive Data Type mapping</h1>
hadoop fs -mkdir ./datatype
hadoop fs -put datatype1.csv ./datatype/datatype1.csv

<b><span style="background:yellow">Data type mapping</span></b>

hive&gt; <b>CREATE TABLE test1 ( c_tint TINYINT, c_sint SMALLINT, c_int INT, c_bint BIGINT, c_fl FLOAT, c_dou DOUBLE, c_dec DECIMAL(38,38), c_ts TIMESTAMP, c_date DATE, c_str STRING, c_vchar VARCHAR(5), c_char CHAR(5), c_bool BOOLEAN, c_b BINARY) row format delimited fields terminated by ',' stored as textfile;</b>
OK
Time taken: 77.903 seconds

hive&gt; <b>LOAD DATA INPATH './datatype/datatype1.csv' OVERWRITE INTO TABLE test1;</b>
Loading data to table default.test1
Table default.test1 stats: [numFiles=1, numRows=0, totalSize=148, rawDataSize=0]
OK
Time taken: 23.679 seconds

++++++++++++++++++++++++++++++++++++
+	Note on Binary:
+
+	Hive is designed to work with big data. Often in such cases, a row in a data might be very wide with hundreds of columns. <i>Sometimes, user is just interested +      in  few of those columns and doesn't want to bother about exact type information for rest of columns. In such cases, he may just declare the types of those 
+      columns as binary and Hive will not try to interpret those columns.</i> One important thing to note is this <i>binary type is not modeled after blob type as it exists in
</i><i>+      other systems</i>.
+	<a style="color:#3465A4" href="https://cwiki.apache.org/confluence/display/Hive/Binary+DataType+Proposal">https://cwiki.apache.org/confluence/display/Hive/Binary+DataType+Proposal</a>
++++++++++++++++++++++++++++++++++++

hive&gt; select * from test1;
OK
127	-32768	2147483647	9223372036854775807	3.402E38	-2.22E-307	0.0000000000000000000000000000000000001	2012-03-21 12:32:23.436543444	1992-03-15	"cccccc"	hzy	hzy  	true	ï¿½]
Time taken: 8.204 seconds, Fetched: 1 row(s)

<b>hive_datatype.clp</b>  

create nickname TEST1 for "SERVER1"."default"."test1"
DB21034E  The command was processed as an SQL statement because it was not a 
valid Command Line Processor command.  During SQL processing it returned:
SQL3324N  Column "c_str" has a type of "string" which is not recognized.

|| create table "test2" without string column

hive&gt; <b>CREATE TABLE test2 ( c_tint TINYINT, c_sint SMALLINT, c_int INT, c_bint BIGINT, c_fl FLOAT, c_dou DOUBLE, c_dec DECIMAL(38,38), c_ts TIMESTAMP, c_date DATE, c_vchar VARCHAR(5), c_char CHAR(5), c_bool BOOLEAN, c_b BINARY) row format delimited fields terminated by ',' stored as textfile;</b>
OK
Time taken: 8.652 seconds

hive&gt; <b>LOAD DATA INPATH './datatype/datatype2.csv' OVERWRITE INTO TABLE test2;</b>
Loading data to table default.test2
Table default.test2 stats: [numFiles=1, numRows=0, totalSize=148, rawDataSize=0]
OK
Time taken: 7.028 seconds

create nickname TEST2 for "SERVER1"."default"."test2"
DB21034E  The command was processed as an SQL statement because it was not a 
valid Command Line Processor command.  During SQL processing it returned:
SQL3324N  Column "c_b" has a type of "binary" which is not recognized.

|| create table "test3" without string &amp; binary column

hive&gt; <b>CREATE TABLE test3 ( c_tint TINYINT, c_sint SMALLINT, c_int INT, c_bint BIGINT, c_fl FLOAT, c_dou DOUBLE, c_dec DECIMAL(38,38), c_ts TIMESTAMP, c_date DATE, c_vchar VARCHAR(5), c_char CHAR(5), c_bool BOOLEAN) row format delimited fields terminated by ',' stored as textfile;</b>
OK
Time taken: 8.047 seconds

hive&gt; <b>LOAD DATA INPATH './datatype/datatype3.csv' OVERWRITE INTO TABLE test3;</b>
Loading data to table default.test3
Table default.test3 stats: [numFiles=1, numRows=0, totalSize=123, rawDataSize=0]
OK
Time taken: 7.203 seconds

create nickname TEST3 for "SERVER1"."default"."test3"
DB20000I  The SQL command completed successfully.


$ db2 "describe table test3"

                                Data type                     Column
Column name                     schema    Data type name      Length   Scale  Nulls
------------------------------- --------- -------------------             ---------- -----    ------
C_TINT                            SYSIBM    SMALLINT                     2            0    Yes   
C_SINT                            SYSIBM    SMALLINT                     2            0    Yes   
C_INT                              SYSIBM    INTEGER                      4            0    Yes   
C_BINT                            SYSIBM    BIGINT                          8           0     Yes   
C_FL                                SYSIBM    REAL                           4            0     Yes   
C_DOU                            SYSIBM    DOUBLE                       8           0     Yes   
C_DEC                            SYSIBM    DOUBLE                       8           0     Yes   
C_TS                               SYSIBM    TIMESTAMP                 10          6     Yes   
C_DATE                           SYSIBM    DATE                           4           0     Yes   
C_VCHAR                        SYSIBM    VARCHAR                     5          0     Yes   
C_CHAR                          SYSIBM    CHARACTER                 5         0     Yes   
C_BOOL                          SYSIBM    SMALLINT                     2          0     Yes   

  12 record(s) selected.

$ db2 "select * from test3"

C_TINT C_SINT C_INT       C_BINT               C_FL                     C_DOU                    C_DEC                    C_TS                       C_DATE     C_VCHAR C_CHAR C_BOOL
------ ------ ----------- -------------------- ------------------------ ------------------------ ------------------------ -------------------------- ---------- ------- ------ ------
   127 -32768  2147483647  9223372036854775807            +3.40200E+038   -2.22000000000000E-307   +1.00000000000000E-037 2012-03-21-12.32.23.436543 03/15/1992 hzy     hzy         1

  1 record(s) selected.

[root@sandbox ~]# cat datatype3.csv
127,-32768,2147483647,9223372036854775807,3.402E+38,-2.22E-307,1E-37,2012-03-21 12:32:23.436543444,1992-03-15,hzy,hzy,true

|| create table "test4" only with binary data type (<b>01/18/16</b>)

hive&gt; CREATE TABLE test4 (c_b BINARY) row format delimited fields terminated by ',' stored as textfile;
OK
Time taken: 66.753 seconds

hive&gt; LOAD DATA INPATH './datatype/datatype4.csv' OVERWRITE INTO TABLE test4;
Loading data to table default.test4
Table default.test4 stats: [numFiles=1, numRows=0, totalSize=13, rawDataSize=0]
OK
Time taken: 14.316 seconds

|| create table "test5" only with string data type <b>(01/22/16)</b>

hive&gt; CREATE TABLE test5 (c_str STRING) row format delimited fields terminated by ',' stored as textfile;
OK
Time taken: 32.246 seconds

hive&gt; LOAD DATA INPATH './datatype/datatype5.csv' OVERWRITE INTO TABLE test5;
Loading data to table default.test5
Table default.test5 stats: [numFiles=1, numRows=0, totalSize=9, rawDataSize=0]
OK
Time taken: 18.079 seconds

hive&gt; select * from test5;
OK
"cccccc"
Time taken: 6.933 seconds, Fetched: 1 row(s)

hive&gt; describe test5;
OK
c_str               	string              	                    
Time taken: 1.108 seconds, Fetched: 1 row(s)


<b><span style="font-size:xx-large">01/18/16:</span></b><span style="font-size:xx-large"> Handle binary mapping</span>


Binary mapping that the following debug activities based upon:

<span style="background:yellow">--------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

  47 static Default_Local_Type
  48   SQLQG_hive_local_type_defaults[SQLQG_Hive_NUM_DEFAULT_LOCAL_TYPE_MAPPINGS] =
  49 
  50 { ////////////////////////////////////////////////////////////////////
  51   // timestamp, local_schema, local_type, 
  52   // local_length, local_length_null,
  53   // local_scale,   local_scale_null, local_bit_data, local_bit_data_null,
  54   // remote_schema, remote_type, remote_upper_length, remote_upper_length_null,
  55   // remote_lower_length, remote_lower_length_null, remote_upper_scale, remote_upper_scale_null, 
  56   // remote_lower_scale, remote_lower_scale_null, remote_oprs, remote_oprs_null, 
  57   // remote_bit_data, remote_bit_data_null,
  58   ////////////////////////////////////////////////////////////////////
  59     {    "0001-01-01-01.01.01.000003", (UCHAR *)"SYSIBM",  (UCHAR *)"VARCHAR",
  60           0,            TRUE,
  61           0,            TRUE,             'Y',            FALSE,
  62           NULL,  (UCHAR *)"SQL_VARBINARY", 32672,          FALSE,
  63           1,             FALSE,            0,             TRUE,
  64           0,             TRUE,           "\0",            TRUE,
  65           ' ',           TRUE}
  66 };

<span style="background:yellow">-------------------------------------------------------------------------------------------------------------------------------------------------------------</span>


create nickname TEST2 for "SERVER1"."default"."test2"
DB21034E  The command was processed as an SQL statement because it was not a 
valid Command Line Processor command.  During SQL processing it returned:
SQL3324N  Column "c_b" has a type of "binary" which is not recognized.

Examine procedure: 

1. vi <b>hive.fmt</b>,  search for "-3324" and get the following:

394423 <span style="background:yellow">39380</span>   data DB2 UDB oper system services sqlofica cei (3.3.15.740.2.10)
394424     pid 15775 tid 140351624963840 cpid 4938 node 0 probe 10
394425     bytes 144
394426 
394427     Data1   (PD_DB2_TYPE_SQLCA,136) SQLCA:
394428  sqlcaid : SQLCA     sqlcabc: 136   sqlcode: -3324   sqlerrml: 10
394429  sqlerrmc: c_b binary
394430  sqlerrp : SQLQO05C
394431  sqlerrd : (1) 0x8026006D      (2) 0x00000000      (3) 0x00000000
394432            (4) 0x00000000      (5) 0x00000000      (6) 0x00000000
394433  sqlwarn : (1)      (2)      (3)      (4)        (5)       (6)
394434            (7)      (8)      (9)      (10)        (11)
394435  sqlstate:

2. sft2 39380 hive.flw

--------------------------
<i>sft2  This is a tool to generate the call stack for a given function call in a db2trc flow file</i>
--------------------------

$ sft2 39380 hive.flw  
The hitting line is: 39380       | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | sqlofica data [probe 10]


The stack depth for this row is: 30 

86          sqljsParse entry [eduid 405 eduname db2agent]
96          | sqljsParseRdbAccessed entry [eduid 405 eduname db2agent]
97          | | sqljs_ddm_excsqlimm entry [eduid 405 eduname db2agent]
114         | | | sqlrr_execimmd entry [eduid 405 eduname db2agent]
274         | | | | sqlrr_execute_immed entry [eduid 405 eduname db2agent]
7865        | | | | | sqlriSectInvoke entry [eduid 405 eduname db2agent]
7866        | | | | | | sqlri_djx_rddl entry [eduid 405 eduname db2agent]
7867        | | | | | | | sqlri_ddl_common entry [eduid 405 eduname db2agent]
7893        | | | | | | | | sqlri_ddl_get_section entry [eduid 405 eduname db2agent]
7901        | | | | | | | | | sqlra_get_var entry [eduid 405 eduname db2agent]
7934        | | | | | | | | | | sqlra_find_var entry [eduid 405 eduname db2agent]
8122        | | | | | | | | | | | sqlra_compile_var data [probe 15200]
8125        | | | | | | | | | | | | sqlnn_cmpl entry [eduid 405 eduname db2agent]
9111        | | | | | | | | | | | | | sqlnp_main_id entry [eduid 405 eduname db2agent]
9463        | | | | | | | | | | | | | | sqlnp_parser entry [eduid 405 eduname db2agent]
14253       | | | | | | | | | | | | | | | sqlnp_smactn mbt [Marker:PD_SQNP_REDUCTION ]
14254       | | | | | | | | | | | | | | | | sqlnq_create_nickname_stmt entry [eduid 405 eduname db2agent]
14598       | | | | | | | | | | | | | | | | | sqlnq_create_nickname_one entry [eduid 405 eduname db2agent]
16590       | | | | | | | | | | | | | | | | | | sqlqgRegisterNickname entry [eduid 405 eduname db2agent]
16603       | | | | | | | | | | | | | | | | | | | sqlqgCreateNickInfo entry [eduid 405 eduname db2agent]
22813       | | | | | | | | | | | | | | | | | | | | sqlqg_Call_FMP_Thread entry [eduid 405 eduname db2agent]
22814       | | | | | | | | | | | | | | | | | | | | | sqlqgRouter entry [eduid 405 eduname db2agent]
22858       | | | | | | | | | | | | | | | | | | | | | | sqlqg_FMP_CreateNickInfo entry [eduid 405 eduname db2agent]
22905       | | | | | | | | | | | | | | | | | | | | | | | Nickname::register_nickname entry [eduid 405 eduname db2agent]
22906       | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Nickname::verify_register_nickname_info entry [eduid 405 eduname db2agent]
22925       | | | | | | | | | | | | | | | | | | | | | | | | | Nickname::verify_register_nickname_info entry [eduid 405 eduname db2agent]
22926       | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::verify_my_register_nickname_info entry [eduid 405 eduname db2agent]
39260       | | | | | | | | | | | | | | | | | | | | | | | | | | | <span style="background:yellow">FencedOdbc_Nickname::get_column_info data [probe 826]</span>
39346       | | | | | | | | | | | | | | | | | | | | | | | | | | | | sqlqgError entry [eduid 405 eduname db2agent]
39351       | | | | | | | | | | | | | | | | | | | | | | | | | | | | | sqlqgError data [probe 40]
39380       | | | | | | | | | | | | | | | | | | | | | | | | | | | | | | sqlofica data [probe 10]

<ul><li dir="ltr">find out where SQL3324N raised</li></ul>

	In "/engn/sqqg_odbc/sqlqg_fenced_odbc_nickname.C" 

1136       // If no local data type has been found, then throw an error.
1137       if (local_type == NULL)
1138       {
1139         rc = sqlqgError(SQLT_SQLQG_ODBC, FUNCTION_TRACE_ID, -3324, 2,
1140                         colnameLen, colname,
1141                         typeNameLen, typeName);
1142         goto exit;                                                 //@d267473rgm
1143       }
1144 

rc = <span style="background:yellow">m_server-&gt;get_local_type</span> (NULL,
1119                                           (sqluint8 * )key,
1120                                           (sqlint32 )  remotePrecision,
1121                                           (unsigned int)0,
1122                                           (sqlint16)   scale,
1123                                           (unsigned int)0,
1124                                           (sqluint8)    forBitData,
1125                                           (unsigned int)bitDataNull,
1126                                           (unsigned int)FALSE,
1127                                           &amp;local_type);

use <span style="background:yellow">FencedRelational_Server::get_local_type()</span> to do the mapping


     <span style="background:yellow"> // dataType represents the SQL data type mapped to the remote data type                                                
      // specific to the remote datasource. This data type mapping is done by                                                
      // the ODBC driver. </span>                                                                                                   
   <span style="background:yellow">   // Now we want to map the SQL data type to a local data type...   </span>                                                     

      //pdTraceData1(FUNCTION_TRACE_ID, __LINE__, PD_SINT(dataType));                                                        
      pdTraceData1(FUNCTION_TRACE_ID, 1991, PD_STRING((const char *)typeName));
      pdTraceData1(FUNCTION_TRACE_ID, 1992, PD_SINT(dataType));


<span style="background:yellow">====================================================================
</span>

Binary --------------------------&gt; SQL_VARBINARY ------------------------------------&gt; BLOB
           ODBC driver                                               called in "FencedOdbc_Nickname::get_column_info", done by "m_server-&gt;get_local_type()"


<span style="background:yellow">====================================================================</span>

620414 76220   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1991)
620415     pid 29417 tid 140331395835648 cpid 2115 node 0 probe 1991
620416     bytes 14
620417 
620418     Data1   (PD_TYPE_STRING,6) String:
620419     binary
620420 
620421 76221   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1992)
620422     pid 29417 tid 140331395835648 cpid 2115 node 0 probe 1992
620423     bytes 10
620424 
620425     Data1   (PD_TYPE_SINT,2) signed integer:
620426     <span style="background:yellow">-3</span>


<b><span style="background:yellow">-3 corresponds to #define SQL_VARBINARY  (-3)
</span></b>


 39524       | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::get_column_info data [probe 1991      ] --&gt; Data1   (PD_TYPE_STRING,6) String:
																					 binary
39525       | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::get_column_info data [probe 1992      ] --&gt;  Data1   (PD_TYPE_SINT,2) signed integer:
                                                                                                                                                                         -3
39526       | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::get_column_info data [probe 1994      ]
39541       | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::get_column_info data [probe 1995      ] --&gt; We try to get_local_type by <b>key</b>
39558       | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedOdbc_Nickname::get_column_info data [probe 1993      ] --&gt; no local_type is found, and thus throw an error

---------------
How "key" is calculated

         case(SQL_VARBINARY):
1005         {
1006           pdTraceData1(FUNCTION_TRACE_ID, 1998, PD_STRING("confirm key here"));
1007           forBitData = 'Y';
1008           ossStrNCopy((char*)key, "SQL_VARBINARY", keyLen);
1009           break;
1010         }


387120 39567   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1998)
387121     pid 25748 tid 140661114267392 cpid 25936 node 0 probe 1998
387122     bytes 24
387123 
387124     Data1   (PD_TYPE_STRING,16) String:
387125     confirm key here

Confirmed: "Key" truly calculated from "SQL_VARBINARY" case
--------------

420157 44666   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1996)
420158     pid 20141 tid 140501432919808 cpid 5626 node 0 probe 1996
420159     bytes 55
420160 
420161     Data1   (PD_TYPE_STRINGN,6) String with size:
420162     <span style="background:yellow">binary</span>    <b>&lt;-------- typeName</b>
420163     Data2   (PD_TYPE_SINT,4) signed integer:
420164     <span style="background:yellow">2147483647</span> <b>&lt;----- remotePrecision</b>
420165     Data3   (PD_TYPE_SINT,2) signed integer:
420166     <span style="background:yellow">0</span> <b>&lt;----- scale</b>
420167     Data4   (PD_TYPE_SINT,1) signed integer:
420168     <span style="background:yellow">89</span> <b>&lt;----- forBitData</b>
420169     Data5   (PD_TYPE_UINT,2) unsigned integer:
420170     <span style="background:yellow">0</span> <b>&lt;---- bitDataNull</b>


1097      pdTraceData5(FUNCTION_TRACE_ID, 1996,
1098          PD_STRINGN(typeName, DJ_Wrapper_Utilities::get_adjusted_length(typeNameLen)),
1099          PD_SINT(remotePrecision),
1100          PD_SINT(scale),
1101          PD_SINT(forBitData),
1102          PD_UINT(bitDataNull)
1103       );

<b><span style="background:yellow">Map remote data source dependent data type to local type (int -&gt; integer)</span></b>
1110       rc = m_server-&gt;get_local_type (NULL,
1111                                         (sqluint8 * )typeName,
1112                                         (sqlint32 )  remotePrecision,
1113                                         (unsigned int)0,
1114                                         (sqlint16)   scale,
1115                                         (unsigned int)0,
1116                                         (sqluint8)    forBitData,
1117                                         (unsigned int)bitDataNull,
1118                                         (unsigned int)FALSE,
1119                                         &amp;local_type);

<b><span style="background:yellow">If failed above, map ODBC data type to local type  (SQL_INTEGER -&gt; integer)</span></b>

1131         rc = m_server-&gt;get_local_type (NULL,
1132                                           (sqluint8 * )key,
1133                                           (sqlint32 )  remotePrecision,
1134                                           (unsigned int)0,
1135                                           (sqlint16)   scale,
1136                                           (unsigned int)0,
1137                                           (sqluint8)    forBitData,
1138                                           (unsigned int)bitDataNull,
1139                                           (unsigned int)FALSE,
1140                                           &amp;local_type);

pdTraceData5(FUNCTION_TRACE_ID, 1997,
1129          PD_SINT(key),
1130          PD_SINT(remotePrecision),
1131          PD_SINT(scale),
1132          PD_UINT(forBitData),
1133          PD_UINT(bitDataNull)
1134       );

358764 35514   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1997)
358765     pid 12877 tid 140516888930048 cpid 12800 node 0 probe 1997
358766     bytes 57
358767 
358768     Data1   (PD_TYPE_SINT,8) signed integer:
358769     <span style="background:yellow">SQL_VARBINARY</span> <b>&lt;----- key</b>     ( UCHAR  *key = NULL; // key for local_types hash table)
358770     Data2   (PD_TYPE_SINT,4) signed integer:
358771     <span style="background:yellow">2147483647</span>  <b>&lt;---- remotePrecision</b>
358772     Data3   (PD_TYPE_SINT,2) signed integer:
358773     <span style="background:yellow">0</span>  <b>&lt;----- scale</b>
358774     Data4   (PD_TYPE_UINT,1) unsigned integer:
358775     <span style="background:yellow">89</span>  <b>&lt;---- forBitData</b>
358776     Data5   (PD_TYPE_UINT,2) unsigned integer:
358777     <span style="background:yellow">0</span>  <b>&lt;----- bitDataNull</b>



533 sqlint32 FencedRelational_Server::get_local_type(sqluint8* remote_schema_name,
534                          sqluint8 *remote_type_name,
535                          sqlint32 remote_length,
536                          unsigned int remote_length_null,
537                          sqlint16 remote_scale,
538                          unsigned int remote_scale_null,
539                          sqluint8 remote_bit_data,
540                          unsigned int remote_bit_data_null,
541                          unsigned int directionality,
542                          Local_Type** local_type)

<b><span style="background:yellow">If failed above, map ODBC data type to local type  (SQL_INTEGER -&gt; integer)</span></b> (<b><span style="background:yellow">Actual passed in values)</span></b>

533 sqlint32 FencedRelational_Server::get_local_type(
				sqluint8* remote_schema_name, &lt;-------------------------------- NULL
534                          sqluint8 *remote_type_name,  &lt;----------------------------------- key   (<span style="background:yellow">SQL_VARBINARY</span>)
535                          sqlint32 remote_length,  &lt;------------------------------------------ remotePrecision (<span style="background:yellow">2147483647</span>)
536                          unsigned int remote_length_null,  &lt;------------------------------- 0
537                          sqlint16 remote_scale, &lt;-------------------------------------------- scale (<span style="background:yellow">0</span>)
538                          unsigned int remote_scale_null, &lt;--------------------------------- 0
539                          sqluint8 remote_bit_data,  &lt;--------------------------------------- forBitData  (<span style="background:yellow">89</span>)
540                          unsigned int remote_bit_data_null, &lt;----------------------------- bitDataNull (<span style="background:yellow">0</span>)
541                          unsigned int directionality,  &lt;-------------------------------------- FALSE
542                          Local_Type** local_type)


586   pdTraceData1(FUNCTION_TRACE_ID, 2001, PD_STRING((const char*) remote_schema_type));


369175 37118   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2001)
369176     pid 32718 tid 140398433396480 cpid 471 node 0 probe 2001
369177     bytes 14
369178 
369179     Data1   (PD_TYPE_STRING,6) String:
369180     binary

++++++++++++++++++++++++++++++++++++++

<span style="background:yellow">Note: this is the 2nd appearance of 2001</span>
369358 37136   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2001)  
369359     pid 32718 tid 140398433396480 cpid 471 node 0 probe 2001
369360     bytes 21
369361 
369362     Data1   (PD_TYPE_STRING,13) String:
369363     SQL_VARBINARY

++++++++++++++++++++++++++++++++++++++

579   // Look the schema and type name up in the hash table.  These names
580   // together are not unique, so we will have to compare each type
581   // that we get back with the information passed in by the user.

585   local_types.get_first_value(remote_schema_type, &amp;value, &amp;state);

590   pdTraceData1(FUNCTION_TRACE_ID, 2002, PD_SINT(value));
591   pdTraceData1(FUNCTION_TRACE_ID, 2003, PD_SINT(state)


<span style="background:yellow">Note: this is the 2nd appearance of 2002</span>
391948 40253   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2002)
391949     pid 18837 tid 139695518377728 cpid 18860 node 0 probe 2002
391950     bytes 16
391951 
391952     Data1   (PD_TYPE_SINT,8) signed integer:
391953     139695197037504

<span style="background:yellow">Note: this is the 2nd appearance of 2003</span>
366250 36639   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2003)
366251     pid 22372 tid 140053539972864 cpid 22422 node 0 probe 2003
366252     bytes 16
366253 
366254     Data1   (PD_TYPE_SINT,8) signed integer:
366255     140052239137512

598       pdTraceData1(FUNCTION_TRACE_ID, 2004, PD_STRING("We finally get inside loop"));

366257 36640   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2004)
366258     pid 22372 tid 140053539972864 cpid 22422 node 0 probe 2004
366259     bytes 34
366260 
366261     Data1   (PD_TYPE_STRING,26) String:
366262     We finally get inside loop



606       pdTraceData2(FUNCTION_TRACE_ID, 2006,
607               PD_SINT(dir),
608               PD_SINT(directionality));
609 
610       pdTraceData8(FUNCTION_TRACE_ID, 2007,
611               PD_SINT(remote_schema_name),
612               PD_STRING((const char *) remote_type_name),
613               PD_SINT(remote_length),
614               PD_SINT(remote_length_null),
615               PD_SINT(remote_scale),
616               PD_SINT(remote_scale_null),
617               PD_SINT(remote_bit_data),
618               PD_SINT(remote_bit_data_null));


364422 36260   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2006)
364423     pid 26284 tid 140105247352576 cpid 26308 node 0 probe 2006
364424     bytes 22
364425 
364426     Data1   (PD_TYPE_SINT,2) signed integer:
364427     0                                                                 &lt;---- <span style="background:yellow">dir</span>
364428     Data2   (PD_TYPE_SINT,4) signed integer:
364429     0      				                            &lt;---- <span style="background:yellow">directionality</span>
364430 
364431 36261   data DB2 UDB Query Gateway FencedRelational_Server::get_local_type fnc (3.3.38.342.0.2007)
364432     pid 26284 tid 140105247352576 cpid 26308 node 0 probe 2007
364433     bytes 104
364434 
364435     Data1   (PD_TYPE_SINT,8) signed integer:
364436     0                                                               &lt;---------  <span style="background:yellow">remote_schema_name</span>
364437     Data2   (PD_TYPE_STRING,13) String:
364438     SQL_VARBINARY                                      &lt;---------  <span style="background:yellow">remote_type_name</span>
364439     Data3   (PD_TYPE_SINT,4) signed integer:
364440     2147483647                                              &lt;--------  <span style="background:yellow">remote_length</span>
364441     Data4   (PD_TYPE_SINT,4) signed integer: 
364442     0                                                               &lt;---------  <span style="background:yellow">remote_length_null</span>
364443     Data5   (PD_TYPE_SINT,2) signed integer:
364444     0                                                               &lt;--------- <span style="background:yellow">remote_scale</span>
364445     Data6   (PD_TYPE_SINT,4) signed integer:
364446     0                                                               &lt;--------  <span style="background:yellow">remote_scale_null</span>
364447     Data7   (PD_TYPE_SINT,1) signed integer:
364448     89                                                             &lt;--------- <span style="background:yellow">remote_bit_data</span>
364449     Data8   (PD_TYPE_SINT,4) signed integer:
364450     0                                                               &lt;--------- <span style="background:yellow">remote_bit_data_null</span>

 if ((dir == directionality) &amp;&amp;
          (next_type-&gt;matches(remote_schema_name, remote_type_name,
                              remote_length, remote_length_null,
                              remote_scale, remote_scale_null,
                              remote_bit_data, remote_bit_data_null)))

pdTraceData4(SQLT_SQLQG_LOCAL_TYPE_MATCH, 2008,
               PD_SINT(remote_schema_name_len),
               PD_SINT(remote_type_name_len),
               PD_SINT(remote_type_len),
               PD_SINT(remote_schema_len));


644875 80091   data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2008)
644876     pid 20110 tid 140690478589696 cpid 20142 node 0 probe 2008
644877     bytes 40
644878 
644879     Data1   (PD_TYPE_SINT,2) signed integer:
644880     0                                                                       &lt;------- <span style="background:yellow">remote_schema_name_len</span>
644881     Data2   (PD_TYPE_SINT,2) signed integer: 
644882     13                                                                     &lt;-------- <span style="background:yellow">remote_type_name_len (SQL_VARBINARY)</span>
644883     Data3   (PD_TYPE_SINT,2) signed integer:
644884     13                                                                     &lt;-------- <span style="background:yellow">remote_type_len </span>
644885     Data4   (PD_TYPE_SINT,2) signed integer:
644886     0                                                                       &lt;-------- <span style="background:yellow">remote_schema_len</span>



$ grep -i SQLQG_hive_local_type_defaults *.C
sqlqg_odbc_connection.C:                       sizeof(SQLQG_hive_local_type_defaults) /
sqlqg_odbc_connection.C:                       SQLQG_hive_local_type_defaults);
sqlqg_unfenced_odbc_server.C:                      sizeof(SQLQG_hive_local_type_defaults) /
sqlqg_unfenced_odbc_server.C:                      SQLQG_hive_local_type_defaults);

 //Add the Hive type mapping
1149   else if (sqlqg_hive == my_server-&gt;m_server_version)
1150   {
1151     pdTraceData1(FUNCTION_TRACE_ID, 2010, PD_STRING("Come here"));
1152     // Add the Hive type mappings
1153     rc = my_server-&gt;create_default_type_mappings(
1154                        sizeof(SQLQG_hive_local_type_defaults) /
1155                                          sizeof(Default_Local_Type),
1156                        SQLQG_hive_local_type_defaults);


101399      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2001\
]
101400      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2002\
]
101401      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2003\
]
101402      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2004\
]
101403      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2006\
]
101404      | | | | | | | | | | | | | | | | | | | | | | | | | | | | FencedRelational_Server::get_local_type data [probe 2007\
]
101405      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches entry [eduid 21 eduname db2agent]
101406      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches data [probe 2008]
101407      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches data [probe 2010]
101408      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches data [probe 2012]
101409      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches data [probe 2017]
101410      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches exit
101411      | | | | | | | | | | | | | | | | | | | | | | | | | | | | | Local_Type::matches data [probe 2030]

101407  data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2010)
        pid 28319 tid 140307937093376 cpid 28347 node 0 probe 2010
        bytes 12

        Data1   (PD_TYPE_SINT,4) signed integer:
	1

101408  data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2012)
        pid 28319 tid 140307937093376 cpid 28347 node 0 probe 2012
        bytes 12

        Data1   (PD_TYPE_SINT,4) signed integer:
        1

101409  data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2017)
        pid 28319 tid 140307937093376 cpid 28347 node 0 probe 2017
        bytes 12

        Data1   (PD_TYPE_SINT,4) signed integer:
        0

101411  data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2030)
        pid 28319 tid 140307937093376 cpid 28347 node 0 probe 2030
        bytes 12

        Data1   (PD_TYPE_SINT,4) signed integer:
	0



       if ((remote_upper_length_null == FALSE) &amp;&amp;
           <span style="background:yellow"> (remote_length &gt; remote_upper_length)</span>)
        {
          does_match = FALSE;
          pdTraceData2(SQLT_SQLQG_LOCAL_TYPE_MATCH,2031,
                       PD_UINT(remote_length),
                       PD_UINT(remote_upper_length));
          pdTraceData1(SQLT_SQLQG_LOCAL_TYPE_MATCH,2017, PD_SINT(does_match));
        }



<b><span style="background:yellow">ROOTCAUSE:</span></b>

50533   data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2031)
        pid 25390 tid 140195521357568 cpid 25414 node 0 probe 2031
        bytes 24

	Data1   (PD_TYPE_UINT,4) unsigned integer:
        <span style="background:yellow">2147483647</span>  <b> &lt;----- remote_length</b>
        Data2   (PD_TYPE_UINT,4) unsigned integer:
	<span style="background:yellow">32672</span>    <b>&lt;-------- remote_upper_length</b>

<span style="background:yellow">-------------------------------</span>

<span style="background:yellow"><span style="font-size:large">WORK!!!!!!!!!!!!!!!</span></span>

 {    "0009-01-01-01.01.01.000003", (UCHAR *)"SYSIBM",  (UCHAR *)"BLOB",
          2147483647,   TRUE,
          0,            TRUE,             'Y',            FALSE,
          NULL,  (UCHAR *)"SQL_VARBINARY", 0,             TRUE,
          0,             TRUE,            0,             TRUE,
          0,             TRUE,           "\0",            TRUE,
          ' ',           TRUE}

<span style="background:yellow">-------------------------------</span>


create nickname TEST4 for "SERVER1"."default"."test4"
DB20000I  The SQL command completed successfully.

describe table TEST4

                                Data type                     Column
Column name                     schema    Data type name      Length     Scale Nulls
------------------------------- --------- ------------------- ---------- ----- ------
C_B                             SYSIBM    BLOB                2147483647     0 Yes   

  1 record(s) selected.


<b><span style="font-size:xx-large">01/22/16</span></b><span style="font-size:xx-large">: Handle string mapping</span>

create nickname TEST5 for "SERVER1"."default"."test5"
DB21034E  The command was processed as an SQL statement because it was not a 
valid Command Line Processor command.  During SQL processing it returned:
SQL3324N  Column "c_str" has a type of "string" which is not recognized.


35295   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1992)
        pid 23174 tid 139906990991104 cpid 23215 node 0 probe 1992
        bytes 10

        Data1   (PD_TYPE_SINT,2) signed integer:
        <span style="background:yellow">12</span>

<b><span style="background:yellow">12 corresponds to #define SQL_VARCHAR  (12)</span></b>


1097      pdTraceData5(FUNCTION_TRACE_ID, 1996,
1098          PD_STRINGN(typeName, DJ_Wrapper_Utilities::get_adjusted_length(typeNameLen)),
1099          PD_SINT(remotePrecision),
1100          PD_SINT(scale),
1101          PD_SINT(forBitData),
1102          PD_UINT(bitDataNull)
1103       );


35296   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1996)
        pid 23174 tid 139906990991104 cpid 23215 node 0 probe 1996
        bytes 55

        Data1   (PD_TYPE_STRINGN,6) String with size:
        string                                                                    &lt;------------- <span style="background:yellow">typeName</span>
        Data2   (PD_TYPE_SINT,4) signed integer:
        2147483647                                                         &lt;------------- <span style="background:yellow">remotePrecision</span>
        Data3   (PD_TYPE_SINT,2) signed integer:
        0                                                                          &lt;-------------- <span style="background:yellow">scale</span>
        Data4   (PD_TYPE_UINT,1) unsigned integer:
        78                                                                        &lt;-------------- <span style="background:yellow">forBitData</span>
        Data5   (PD_TYPE_UINT,2) unsigned integer:
        0                                                                          &lt;-------------- <span style="background:yellow">bitDataNull</span>


Binary mapping that the following debug activities based upon:

<span style="background:yellow">--------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

 {    "0001-01-01-01.01.01.000006", (UCHAR *)"SYSIBM",  (UCHAR *)"CLOB",   //@d213936kal                                  

         2147483647,   FALSE,                                                 //@d213936kal                                 
         0,             TRUE,           'N',            FALSE,
         NULL,  (UCHAR *)"SQL_VARCHAR",  32672,         FALSE,          //@d267473rgm                                        
         1,             FALSE,             0,            TRUE,         //@d267473rgm                                         
         0,             TRUE,           "\0",           TRUE,
         ' ',           TRUE}
<span style="background:yellow">--------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

Binary --------------------------&gt; SQL_VARBINARY ------------------------------------&gt; ?
           ODBC driver                                               called in "FencedOdbc_Nickname::get_column_info", done by "m_server-&gt;get_local_type()"


pdTraceData5(FUNCTION_TRACE_ID, 1997,
1129          PD_SINT(key),
1130          PD_SINT(remotePrecision),
1131          PD_SINT(scale),
1132          PD_UINT(forBitData),
1133          PD_UINT(bitDataNull)
1134       );


35757   data DB2 UDB ODBC wrapper FencedOdbc_Nickname::get_column_info fnc (3.3.122.92.0.1997)
	pid 25339 tid 139836426020608 cpid 25362 node 0 probe 1997
        bytes 60

	Data1   (PD_TYPE_STRING,11) String:
        SQL_VARCHAR                                             &lt;------------- <span style="background:yellow">key</span>
	Data2   (PD_TYPE_SINT,4) signed integer:
	2147483647                                                  &lt;------------- <span style="background:yellow">remotePrecision</span>
        Data3   (PD_TYPE_SINT,2) signed integer:
        0                                                                    &lt;------------- <span style="background:yellow">scale</span>
        Data4   (PD_TYPE_UINT,1) unsigned integer:
        78                                                                  &lt;------------- <span style="background:yellow">forBitData</span>
        Data5   (PD_TYPE_UINT,2) unsigned integer:
        0                                                                    &lt;------------- <span style="background:yellow">bitDataNull</span>


 if ((remote_upper_length_null == FALSE) &amp;&amp;
            (remote_length &gt; remote_upper_length))
        {
          does_match = FALSE;
          pdTraceData2(SQLT_SQLQG_LOCAL_TYPE_MATCH,2031,
                       PD_UINT(remote_length),
                       PD_UINT(remote_upper_length));
          pdTraceData1(SQLT_SQLQG_LOCAL_TYPE_MATCH,2017, PD_SINT(does_match));
        }


35777   data DB2 UDB Query Gateway Local_Type::matches fnc (3.3.38.578.0.2031)
        pid 25339 tid 139836426020608 cpid 25362 node 0 probe 2031
        bytes 24

	Data1   (PD_TYPE_UINT,4) unsigned integer:
	2147483647    <span style="background:yellow">-------&gt; remote length</span>
	Data2   (PD_TYPE_UINT,4) unsigned integer:
        32672              <span style="background:yellow">--------&gt;remote upper length</span>

<span style="background:yellow">-------------------</span>
<b><span style="font-size:xx-large">WORK!!!!</span></b>
<span style="background:yellow">-------------------</span>
 {    "0010-01-01-01.01.01.000006", (UCHAR *)"SYSIBM",  (UCHAR *)"CLOB",   //@d213936kal                                  

         0,    TRUE,                                                //@d213936kal                                            
         0,             TRUE,           'N',            FALSE,
         NULL,  (UCHAR *)"SQL_VARCHAR",  65535,         FALSE,          //@d267473rgm                                        
         0,             FALSE,             0,            TRUE,         //@d267473rgm                                         
         0,             TRUE,           "\0",           TRUE,
         ' ',           TRUE}


create nickname TEST5 for "SERVER1"."default"."test5"
DB20000I  The SQL command completed successfully.

describe table TEST5

                                Data type                     Column
Column name                     schema    Data type name      Length     Scale Nulls
------------------------------- --------- ------------------- ---------- ----- ------
C_STR                           SYSIBM    CLOB                2147483647     0 Yes   

  1 record(s) selected.


       if ((remote_upper_length_null == FALSE) &amp;&amp;
            (remote_length &gt; remote_upper_length))
        {
          if (sqlomcpi((char *)remote_type_name, "SQL_VARCHAR", 0) == SQLNLS_SAME_STRING)
            {
              does_match = TRUE;
              remote_length = remote_upper_length; // truncate the string to maximum allow length                            
            }
          else
            {
              does_match = FALSE;
            }
          pdTraceData2(SQLT_SQLQG_LOCAL_TYPE_MATCH,2031,
                       PD_UINT(remote_length),
		       PD_UINT(remote_upper_length));
          pdTraceData1(SQLT_SQLQG_LOCAL_TYPE_MATCH,2017, PD_SINT(does_match));


describe table TEST1

                                Data type                     Column
Column name                     schema    Data type name      Length     Scale Nulls
------------------------------- --------- ------------------- ---------- ----- ------
C_TINT                          SYSIBM    SMALLINT                     2     0 Yes   
C_SINT                          SYSIBM    SMALLINT                     2     0 Yes   
C_INT                           SYSIBM    INTEGER                      4     0 Yes   
C_BINT                          SYSIBM    BIGINT                       8     0 Yes   
C_FL                            SYSIBM    REAL                         4     0 Yes   
C_DOU                           SYSIBM    DOUBLE                       8     0 Yes   
C_DEC                           SYSIBM    DOUBLE                       8     0 Yes   
C_TS                            SYSIBM    TIMESTAMP                   10     6 Yes   
C_DATE                          SYSIBM    DATE                         4     0 Yes   
C_STR                           SYSIBM    CLOB                2147483647     0 Yes   
C_VCHAR                         SYSIBM    VARCHAR                      5     0 Yes   
C_CHAR                          SYSIBM    CHARACTER                    5     0 Yes   
C_BOOL                          SYSIBM    SMALLINT                     2     0 Yes   
C_B                             SYSIBM    BLOB                2147483647     0 Yes   

  14 record(s) selected.

<span style="background:yellow">================================================================</span>

Binary --------------------------&gt; SQL_VARCHAR ------------------------------------&gt; CLOB
           ODBC driver                                               called in "FencedOdbc_Nickname::get_column_info", done by "m_server-&gt;get_local_type()"

<span style="background:yellow">================================================================</span>


**********************************
<b><span style="background:yellow"><span style="font-size:xx-large">LIMITATION!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></span></b>
**********************************

set passhru and select string column from remote hive table encoutering error.


set passthru server1
DB20000I  The SQL command completed successfully.

select * from test5
SQL30020N  Execution of the command or SQL statement failed because of a 
syntax error in the communication data stream that will affect the successful 
execution of subsequent commands and SQL statements:  Reason Code 
"0x220A"("0100")"".  SQLSTATE=58009

set passthru reset
DB21034E  The command was processed as an SQL statement because it was not a 
valid Command Line Processor command.  During SQL processing it returned:
SQL1024N  A database connection does not exist.  SQLSTATE=08003



</div></body></html>
